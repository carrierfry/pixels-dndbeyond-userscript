/*! For license information please see index.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.pixelsWebConnect=t():e.pixelsWebConnect=t()}(this,(()=>(()=>{var e={46:e=>{"use strict";var t,i="object"==typeof Reflect?Reflect:null,r=i&&"function"==typeof i.apply?i.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};t=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(i,r){function n(i){e.removeListener(t,s),r(i)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",n),i([].slice.call(arguments))}y(e,t,s,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&y(e,"error",t,{once:!0})}(e,n)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,i,r){var n,s,o,l;if(a(i),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),o=s[t]),void 0===o)o=s[t]=i,++e._eventsCount;else if("function"==typeof o?o=s[t]=r?[i,o]:[o,i]:r?o.unshift(i):o.push(i),(n=c(e))>0&&o.length>n&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,l=u,console&&console.warn&&console.warn(l)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=u.bind(r);return n.listener=i,r.wrapFn=n,n}function p(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):f(n,n.length)}function h(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function f(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}function y(e,t,i,r){if("function"==typeof e.on)r.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(s){r.once&&e.removeEventListener(t,n),i(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var l=c.length,u=f(c,l);for(i=0;i<l;++i)r(u[i],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},s.prototype.removeListener=function(e,t){var i,r,n,s,o;if(a(t),void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){o=i[s].listener,n=s;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,s=Object.keys(i);for(r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return p(this,e,!0)},s.prototype.rawListeners=function(e){return p(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},s.prototype.listenerCount=h,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},461:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BleSessionError=void 0;const r=i(99),n=i(792);class s extends Error{constructor(e){super(e),this.name="BluetoothError"}}class o extends Error{constructor(e){super(e),this.name="ScanTimeoutError"}}class a extends Error{constructor(e){super(e),this.name="BleSessionError"}}t.BleSessionError=a;class c extends r.PixelSession{constructor(e,t){super(e,t);const i=n.PixelsDevices.getKnownDevice(e);if(!i)throw new a(`No known Bluetooth device with system id: ${e}`);this._device=i,!this.pixelName&&i.name&&this._setName(i.name);const r=()=>{!this.pixelName&&i.name&&this._setName(i.name),this._notifyConnectionEvent("disconnected")};i.addEventListener("gattserverdisconnected",r),this._disposeFunc=()=>{this.setConnectionEventListener(void 0),i.addEventListener("gattserverdisconnected",r)}}dispose(){this._disposeFunc()}async connect(e){var t;const i=this._device.gatt;if(!i)throw new s("Gatt server not available");if(!i.connected){let n=!1;const s=()=>e>0&&setTimeout((()=>{n=!0,this.disconnect().catch((()=>{}))}),e);let a=s();try{this._notifyConnectionEvent("connecting"),await i.connect()}catch(e){let r=e;if(this._device.watchAdvertisements&&(null===(t=null==r?void 0:r.message)||void 0===t?void 0:t.includes("no longer in range")))try{a&&clearTimeout(a),await async function(e){return new Promise(((t,i)=>{const r=setTimeout((()=>{n.abort(),i(new o)}),5e3),n=new AbortController;e.addEventListener("advertisementreceived",(()=>{clearTimeout(r),n.abort(),t()})),e.watchAdvertisements({signal:n.signal}).catch((e=>i(e)))}))}(this._device),a=s(),await i.connect(),r=void 0}catch(e){e instanceof o||(r=e)}if(n&&(r=new Error("Connection timeout")),r)throw this._notifyConnectionEvent("disconnected"),r}finally{a&&clearTimeout(a)}this._notifyConnectionEvent("connected");const c=r.PixelsBluetoothIds.legacyDie,l=await i.getPrimaryService(c.service);this._notify=await l.getCharacteristic(c.notifyCharacteristic),this._write=await l.getCharacteristic(c.writeCharacteristic)}this._notifyConnectionEvent("ready")}async disconnect(){var e;null===(e=this._device.gatt)||void 0===e||e.disconnect()}async subscribe(e){if(!this._notify)throw new a("Not connected");function t(){var t,i;(null===(i=null===(t=this.value)||void 0===t?void 0:t.buffer)||void 0===i?void 0:i.byteLength)&&e(this.value)}const i=this._notify;return i.addEventListener("characteristicvaluechanged",t),await i.startNotifications(),()=>{i.removeEventListener("characteristicvaluechanged",t)}}async writeValue(e,t,i){if(!this._write)throw new a("Not connected");t?await this._write.writeValueWithoutResponse(e):await this._write.writeValueWithResponse(e)}}t.default=c},792:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PixelsDevices=void 0;const r=i(99),n=new Map;t.PixelsDevices={async requestDevice(){var e;if(!(null===(e=null===navigator||void 0===navigator?void 0:navigator.bluetooth)||void 0===e?void 0:e.requestDevice))throw new Error("Bluetooth is not available, check that you're running in a secure environment and that Web Bluetooth is enabled.");const t=await navigator.bluetooth.requestDevice({filters:[{services:[r.PixelsBluetoothIds.legacyDie.service]},{services:[r.PixelsBluetoothIds.die.service]}]});return n.set(t.id,t),t},getKnownDevice:e=>n.get(e),async getDevice(e){var t;let i=n.get(e);return!i&&(null===(t=null===navigator||void 0===navigator?void 0:navigator.bluetooth)||void 0===t?void 0:t.getDevices)&&(i=(await navigator.bluetooth.getDevices()).find((t=>t.id===e)),i&&n.set(i.id,i)),i}}},238:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBluetoothCapabilities=function(){var e,t;return{bluetooth:!!(null===(e=null===navigator||void 0===navigator?void 0:navigator.bluetooth)||void 0===e?void 0:e.requestDevice),persistentPermissions:!!(null===(t=null===navigator||void 0===navigator?void 0:navigator.bluetooth)||void 0===t?void 0:t.getDevices)}}},344:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(99),t),n(i(36),t),n(i(407),t),n(i(238),t)},407:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.requestPixel=async function(){return c(await o.PixelsDevices.requestDevice())},t.getPixel=async function(e){const t=a.get(e);if(t)return t;{const t=await o.PixelsDevices.getDevice(e);return t?c(t):void 0}};const n=i(99),s=r(i(461)),o=i(792),a=new Map;function c(e){let t=a.get(e.id);if(!t){const i=new s.default(e.id);t=new n.Pixel(i),a.set(e.id,t)}return t}},36:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ActionMakeWebRequest:()=>at,ActionPlayAnimation:()=>rt,ActionPlayAudioClip:()=>st,ActionSpeakText:()=>lt,ActionTypeValues:()=>tt,AnimConstants:()=>p,AnimationBits:()=>q,AnimationCategoryValues:()=>l,AnimationCycle:()=>Z,AnimationFlagsValues:()=>c,AnimationGradient:()=>Q,AnimationGradientPattern:()=>ie,AnimationInstance:()=>G,AnimationInstanceGradient:()=>J,AnimationInstanceGradientPattern:()=>ee,AnimationInstanceKeyframed:()=>re,AnimationInstanceNoise:()=>ae,AnimationInstanceNormals:()=>Ee,AnimationInstanceRainbow:()=>ue,AnimationInstanceSequence:()=>ze,AnimationInstanceSimple:()=>he,AnimationKeyframed:()=>se,AnimationNoise:()=>le,AnimationNormals:()=>Fe,AnimationRainbow:()=>pe,AnimationSequence:()=>Re,AnimationSimple:()=>ye,AnimationTypeValues:()=>a,BatteryStateFlagsValues:()=>pt,Color:()=>z,Color32Utils:()=>r,ColorUtils:()=>n,ConditionBatteryState:()=>ht,ConditionConnectionState:()=>mt,ConditionCrooked:()=>kt,ConditionFaceCompare:()=>bt,ConditionHandling:()=>Ct,ConditionHelloGoodbye:()=>_t,ConditionIdle:()=>Ut,ConditionRolled:()=>Mt,ConditionRolling:()=>St,ConditionTypeValues:()=>ut,ConnectionStateFlagsValues:()=>yt,DataSet:()=>Et,DiceUtils:()=>Ge,FaceCompareFlagsValues:()=>vt,GammaUtils:()=>s,HelloGoodbyeFlagsValues:()=>Tt,NoiseColorOverrideTypeValues:()=>u,NormalsColorOverrideTypeValues:()=>d,PixelColorwayValues:()=>Ye,PixelDieTypeValues:()=>Ze,Profile:()=>Xe,RgbKeyframe:()=>je,RgbTrack:()=>Be,Rule:()=>et,SimpleKeyframe:()=>Ne,Track:()=>We,VirtualDie:()=>He,facesMaskToValues:()=>Ue,getActionTypeDisplayName:()=>$t,getAnimationTypeDisplayName:()=>Ot,getConditionTypeDisplayName:()=>It,getFaceCount:()=>ke,getFaceForLEDIndex:()=>Te,getFaceMask:()=>xe,getLEDCount:()=>Ce,getTopFace:()=>_e});var r={};i.r(r),i.d(r,{combineColors:()=>b,faceWheel:()=>C,getBlue:()=>g,getGreen:()=>m,getRed:()=>y,interpolateColors:()=>w,interpolateIntensity:()=>T,modulateColor:()=>_,mulColors:()=>v,rainbowWheel:()=>k,toColor32:()=>f});var n={};i.r(n),i.d(n,{colorBytesToString:()=>P,colorComponentToByte:()=>M,colorToString:()=>O,desaturate:()=>$,hsvToRgb:()=>x,lerp:()=>E,multiply:()=>D,rgbToHsv:()=>U,shiftHue:()=>A,sqrDistance:()=>I});var s={};i.r(s),i.d(s,{gamma:()=>V,gamma32:()=>j,gamma8:()=>R,reverseGamma:()=>N,reverseGamma8:()=>B});var o=i(721);const a={none:(0,o.$9)(0),simple:(0,o.$9)(),rainbow:(0,o.$9)(),keyframed:(0,o.$9)(),gradientPattern:(0,o.$9)(),gradient:(0,o.$9)(),noise:(0,o.$9)(),cycle:(0,o.$9)(),name:(0,o.$9)(),normals:(0,o.$9)(),sequence:(0,o.$9)()},c={none:0,traveling:(0,o.YE)(0),useLedIndices:(0,o.YE)()},l={system:(0,o.$9)(0),uniform:(0,o.$9)(),colorful:(0,o.$9)(),flashy:(0,o.$9)(),animated:(0,o.$9)()},u={none:(0,o.$9)(0),randomFromGradient:(0,o.$9)(),faceToGradient:(0,o.$9)(),faceToRainbowWheel:(0,o.$9)()},d={none:(0,o.$9)(0),faceToGradient:(0,o.$9)(),faceToRainbowWheel:(0,o.$9)()},p={maxLEDsCount:22,paletteColorFromFace:127,paletteColorFromRandom:126,faceMaskAll:4294967295,keyframeTimeResolutionMs:2,currentFaceIndex:-1};function h(e){const t=e%4;return e+(t?4-t:0)}function f(e,t=0,i=0){return"number"!=typeof e&&(t=255*e.g,i=255*e.b,e=255*e.r),e<<16|t<<8|255&i}function y(e){return e>>16&255}function m(e){return e>>8&255}function g(e){return 255&e}function v(e,t){return f(y(e)*y(t)/255,m(e)*m(t)/255,g(e)*g(t)/255)}function b(e,t){return f(Math.max(y(e),y(t)),Math.max(m(e),m(t)),Math.max(g(e),g(t)))}function w(e,t,i,r,n){const s=1024,o=(n-t)*s/(r-t);return f((y(e)*(s-o)+y(i)*o)/s,(m(e)*(s-o)+m(i)*o)/s,(g(e)*(s-o)+g(i)*o)/s)}function T(e,t,i,r,n){const s=1024,o=(n-t)*s/(r-t);return Math.floor((e*(s-o)+i*o)/s)}function _(e,t){return f(y(e)*t/255,m(e)*t/255,g(e)*t/255)}function k(e,t=255){return e<85?f(3*e*t/255,(255-3*e)*t/255,0):e<170?f((255-3*(e-=85))*t/255,0,3*e*t/255):f(0,3*(e-=170)*t/255,(255-3*e)*t/255)}function C(e,t){return k(256*e/t)}function x({h:e,s:t,v:i}){const r=Math.floor(6*e),n=6*e-r,s=i*(1-t),o=i*(1-n*t),a=i*(1-(1-n)*t);switch(r%6){case 0:return{r:i,g:a,b:s};case 1:return{r:o,g:i,b:s};case 2:return{r:s,g:i,b:a};case 3:return{r:s,g:o,b:i};case 4:return{r:a,g:s,b:i};case 5:return{r:i,g:s,b:o};default:return{r:0,g:0,b:0}}}function U({r:e,g:t,b:i}){const r=Math.max(e,t,i),n=r-Math.min(e,t,i);if(0===n)return{h:0,s:0,v:0};{let s=0;switch(r){case e:s=(t-i)/n+(t<i?6:0);break;case t:s=(i-e)/n+2;break;case i:s=(e-t)/n+4}return{h:s/6,s:n/r,v:r}}}function A({r:e,g:t,b:i},r){const n=U({r:e,g:t,b:i});return n.h=(n.h+r)%1,x(n)}function S(e){return e.toString(16).padStart(2,"0")}function P(e,t,i){return"#"+S(e)+S(t)+S(i)}function M(e){return Math.round(255*Math.min(1,Math.max(0,e)))}function O({r:e,g:t,b:i}){return P(M(e),M(t),M(i))}function $(e){return.5*(Math.min(e.r,Math.min(e.g,e.b))+Math.max(e.r,Math.max(e.g,e.b)))}function I(e,t){const i=e.r-t.r,r=e.g-t.g,n=e.b-t.b;return i*i+r*r+n*n}function E(e,t,i){return i=Math.min(1,Math.max(0,i)),{r:e.r+(t.r-e.r)*i,g:e.g+(t.g-e.g)*i,b:e.b+(t.b-e.b)*i}}function D(e,t){return{r:e.r*t,g:e.g*t,b:e.b*t}}class F{get rByte(){return M(this.r)}get gByte(){return M(this.g)}get bByte(){return M(this.b)}constructor(e,t,i){this.r=0,this.g=0,this.b=0,void 0!==e&&("string"==typeof e?this.setWithHex(e):"object"==typeof e?this.set(e.r,e.g,e.b):void 0===t?this.setWithValue(e):this.set(e,t,null!=i?i:0))}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}assign(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}duplicate(){return new F(this.r,this.g,this.b)}desaturate(){return $(this)}serialize(e,t=0){return e.setUint8(t++,this.rByte),e.setUint8(t++,this.gByte),e.setUint8(t++,this.bByte),[e,t]}toString(){return O(this)}toColor32(){return f(this)}set(e,t,i){return this.r=e,this.g=t,this.b=i,this}setWithBytes(e,t,i){return this.r=e/255,this.g=t/255,this.b=i/255,this}setWithValue(e){return this.setWithBytes(y(e),m(e),g(e)),this}setWithHex(e){if(e.length){const t="#"===e[0]?1:0;if(e.length===3+t)this.set(parseInt(e[t],16)/255,parseInt(e[t+1],16)/255,parseInt(e[t+2],16)/255);else{if(e.length!==6+t)throw new Error(`Invalid hexadecimal color: ${e}`);this.setWithValue(parseInt(t?e.slice(t):e,16))}}return this}static fromBytes(e,t,i){return(new F).setWithBytes(e,t,i)}static fromString(e){return(new F).setWithHex(e)}static lerp(e,t,i){return new F(E(e,t,i))}}F.black=Object.freeze(new F(0,0,0)),F.brightRed=Object.freeze(new F(1,0,0)),F.brightGreen=Object.freeze(new F(0,1,0)),F.brightBlue=Object.freeze(new F(0,0,1)),F.brightWhite=Object.freeze(new F(1,1,1)),F.brightCyan=Object.freeze(new F(0,1,1)),F.brightMagenta=Object.freeze(new F(1,0,1)),F.brightYellow=Object.freeze(new F(1,1,0)),F.brightOrange=Object.freeze(new F(1,.647,0)),F.brightPurple=Object.freeze(new F(.5,0,1)),F.red=Object.freeze(new F(.7,0,0)),F.green=Object.freeze(new F(0,.7,0)),F.blue=Object.freeze(new F(0,0,.7)),F.white=Object.freeze(new F(.7,.7,.7)),F.cyan=Object.freeze(new F(0,.7,.7)),F.magenta=Object.freeze(new F(.7,0,.7)),F.yellow=Object.freeze(new F(.7,.6,.01)),F.orange=Object.freeze(new F(.7,.453,0)),F.mediumWhite=Object.freeze(new F(.5,.5,.5)),F.faintWhite=Object.freeze(new F(.1,.1,.1)),F.dimRed=Object.freeze(new F(.35,0,0)),F.dimGreen=Object.freeze(new F(0,.35,0)),F.dimBlue=Object.freeze(new F(0,0,.35)),F.dimWhite=Object.freeze(new F(.35,.35,.35)),F.dimCyan=Object.freeze(new F(0,.35,.35)),F.dimMagenta=Object.freeze(new F(.35,0,.35)),F.dimYellow=Object.freeze(new F(.35,.3,.005)),F.dimOrange=Object.freeze(new F(.35,.226,0));const z=F;function L(e){return e<0?0:e>255?255:Math.floor(e)}function R(e){return K[L(e)]}function j(e){return f(R(y(e)),R(m(e)),R(g(e)))}function V(e){const t=R(e.rByte),i=R(e.gByte),r=R(e.bByte);return z.fromBytes(t,i,r)}function B(e){return W[L(e)]}function N(e){const t=B(e.rByte),i=B(e.gByte),r=B(e.bByte);return z.fromBytes(t,i,r)}const K=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,4,4,4,4,4,5,5,5,5,6,6,6,6,6,7,7,7,8,8,8,8,9,9,9,10,10,10,11,11,12,12,12,13,13,14,14,14,15,15,16,16,17,17,18,18,19,19,20,20,21,22,22,23,23,24,25,25,26,27,27,28,29,29,30,31,32,32,33,34,35,35,36,37,38,39,40,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,61,62,63,64,65,67,68,69,70,72,73,74,76,77,78,80,81,82,84,85,87,88,90,91,93,94,96,97,99,101,102,104,105,107,109,111,112,114,116,118,119,121,123,125,127,129,131,132,134,136,138,140,142,144,147,149,151,153,155,157,159,162,164,166,168,171,173,175,178,180,182,185,187,190,192,195,197,200,202,205,207,210,213,215,218,221,223,226,229,232,235,237,240,243,246,249,252,255],W=[0,70,80,87,92,97,101,105,108,112,114,117,119,122,124,126,128,130,132,134,135,137,138,140,141,143,144,146,147,148,149,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,170,171,172,173,174,174,175,176,177,177,178,179,180,180,181,182,182,183,184,184,185,186,186,187,188,188,189,189,190,191,191,192,192,193,194,194,195,195,196,196,197,197,198,198,199,200,200,201,201,202,202,203,203,204,204,204,205,205,206,206,207,207,208,208,209,209,210,210,210,211,211,212,212,213,213,214,214,214,215,215,216,216,216,217,217,218,218,218,219,219,220,220,220,221,221,222,222,222,223,223,223,224,224,224,225,225,226,226,226,227,227,227,228,228,228,229,229,229,230,230,230,231,231,231,232,232,232,233,233,233,234,234,234,235,235,235,236,236,236,237,237,237,237,238,238,238,239,239,239,240,240,240,241,241,241,241,242,242,242,243,243,243,243,244,244,244,245,245,245,245,246,246,246,247,247,247,247,248,248,248,248,249,249,249,249,250,250,250,251,251,251,251,252,252,252,252,253,253,253,253,254,254,254,254,255];class q{constructor(){this.palette=[],this.rgbKeyframes=[],this.rgbTracks=[],this.keyframes=[],this.tracks=[],this.animations=[]}getColor32(e,t){return f(this.getColor(e,t))}getColor(e,t){return e===p.paletteColorFromFace?new z(C(t.currentFace,t.ledCount)):e===p.paletteColorFromRandom?z.black:this.getArrayItem(this.palette,e,"color")}getPaletteSize(){return 3*this.palette.length}getRgbKeyframe(e){return this.getArrayItem(this.rgbKeyframes,e,"rgb keyframe")}getRgbKeyframeCount(){return this.rgbKeyframes.length}getKeyframe(e){return this.getArrayItem(this.keyframes,e,"keyframe")}getKeyframeCount(){return this.keyframes.length}getRgbTrack(e){return this.getArrayItem(this.rgbTracks,e,"rgb track")}getRgbTrackCount(){return this.rgbTracks.length}getTrack(e){return this.getArrayItem(this.tracks,e,"track")}getTrackCount(){return this.tracks.length}getAnimation(e){return this.getArrayItem(this.animations,e,"animation")}getAnimationCount(){return this.animations.length}computeDataSize(){return h(3*this.palette.length)+(0,o.bE)(this.rgbKeyframes)+(0,o.bE)(this.rgbTracks)+(0,o.bE)(this.keyframes)+(0,o.bE)(this.tracks)}serialize(e,t=0){for(const i of this.palette)[e,t]=i.serialize(e,t);return t=h(t),[e,t]=(0,o.lK)(this.rgbKeyframes,{dataView:e,byteOffset:t}),[e,t]=(0,o.lK)(this.rgbTracks,{dataView:e,byteOffset:t}),[e,t]=(0,o.lK)(this.keyframes,{dataView:e,byteOffset:t}),[e,t]=(0,o.lK)(this.tracks,{dataView:e,byteOffset:t}),[e,t]}getArrayItem(e,t,i){const r=e[t];if(void 0===r)throw t<0||t>=e.length?new Error(`Out of bound index for AnimationBits.${i}, got ${t} but array has ${e.length} item(s)`):new Error(`No item for AnimationBits.${i} at index ${t}`);return r}}class G{get startTime(){return this._startTime}get duration(){return this._animationPreset.duration}get animationPreset(){return this._animationPreset}get bits(){return this._animationBits}get die(){return this._virtualDie}constructor(e,t,i){this._startTime=0,this._animationPreset=e,this._animationBits=t,this._virtualDie=i}start(e){this._startTime=e}setIndices(e,t){const i=this._virtualDie.ledCount;let r=0;for(let n=0;n<i;++n)e&1<<n&&(t[r]=n,r++);return r}setColor(e,t,i,r){const n=this._virtualDie.ledCount;let s=0;for(let o=0;o<n;++o)t&1<<o&&(i[s]=o,r[s]=e,s++);return s}}class H extends G{get preset(){return this.animationPreset}updateLEDs(e,t,i){const r=this.preset,n=this.die.ledCount,s=e-this.startTime,o=r.duration*r.fade/510;let a=r.intensity;s<=o?a=s*r.intensity/o:s>=r.duration-o&&(a=(r.duration-s)*r.intensity/o);const c=this.bits.getRgbTrack(r.gradientTrackOffset),l=s*r.count*1e3/r.duration;let u=0;for(let e=0;e<n;++e)if(r.faceMask&1<<e){t[u]=e;const s=(l+1e3*e*r.cyclesTimes10/(10*n))%1e3;i[u]=_(c.evaluateColor(s,this.bits,this.die),a),u++}return u}stop(e){const t=this.die.ledCount,i=this.preset;let r=0;for(let n=0;n<t;++n)i.faceMask&1<<n&&(e[r]=n,r++);return r}}var Y=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class Z{constructor(){this.type=a.cycle,this.animFlags=0,this.duration=0,this.faceMask=0,this.count=0,this.fade=0,this.intensity=128,this.cyclesTimes10=10,this.gradientTrackOffset=0}createInstance(e,t){return new H(this,e,t)}}Y([(0,o.sU)(1)],Z.prototype,"type",void 0),Y([(0,o.sU)(1)],Z.prototype,"animFlags",void 0),Y([(0,o.sU)(2)],Z.prototype,"duration",void 0),Y([(0,o.sU)(4)],Z.prototype,"faceMask",void 0),Y([(0,o.sU)(1)],Z.prototype,"count",void 0),Y([(0,o.sU)(1)],Z.prototype,"fade",void 0),Y([(0,o.sU)(1)],Z.prototype,"intensity",void 0),Y([(0,o.sU)(1)],Z.prototype,"cyclesTimes10",void 0),Y([(0,o.sU)(2)],Z.prototype,"gradientTrackOffset",void 0);class J extends G{get preset(){return this.animationPreset}updateLEDs(e,t,i){const r=this.preset,n=e-this.startTime,s=this.bits.getRgbTrack(r.gradientTrackOffset),o=1e3*n/r.duration,a=s.evaluateColor(o,this.bits,this.die);return this.setColor(a,r.faceMask,t,i)}stop(e){return this.setIndices(this.preset.faceMask,e)}}var X=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class Q{constructor(){this.type=a.gradient,this.animFlags=0,this.duration=0,this.faceMask=0,this.gradientTrackOffset=0}createInstance(e,t){return new J(this,e,t)}}X([(0,o.sU)(1)],Q.prototype,"type",void 0),X([(0,o.sU)(1)],Q.prototype,"animFlags",void 0),X([(0,o.sU)(2)],Q.prototype,"duration",void 0),X([(0,o.sU)(4)],Q.prototype,"faceMask",void 0),X([(0,o.sU)(2,{padding:2})],Q.prototype,"gradientTrackOffset",void 0);class ee extends G{constructor(){super(...arguments),this._rgb=0}get preset(){return this.animationPreset}start(e){super.start(e),this.preset.overrideWithFace&&(this._rgb=this.bits.getColor32(p.paletteColorFromFace,this.die))}updateLEDs(e,t,i){const r=this.preset,n=this.die.ledCount,s=1e3*(e-this.startTime)/r.duration,o=this.bits.getRgbTrack(r.gradientTrackOffset);let a=0;a=r.overrideWithFace?this._rgb:o.evaluateColor(s,this.bits,this.die);let c=0;const l=[],u=[];for(let e=0;e<r.trackCount;++e){const o=this.bits.getTrack(r.tracksOffset+e).evaluate(this.bits,a,s,n,l,u);for(let e=0;e<o;++e)t[c+e]=l[e],i[c+e]=u[e];c+=o}return c}stop(e){const t=this.preset;let i=0;const r=[];for(let n=0;n<t.trackCount;++n){const s=this.bits.getRgbTrack(t.tracksOffset+n).extractLEDIndices(r);for(let t=0;t<s;++t)e[i+t]=r[t];i+=s}return i}}var te=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class ie{constructor(){this.type=a.gradientPattern,this.animFlags=0,this.duration=0,this.tracksOffset=0,this.trackCount=0,this.gradientTrackOffset=0,this.overrideWithFace=!1}createInstance(e,t){return new ee(this,e,t)}}te([(0,o.sU)(1)],ie.prototype,"type",void 0),te([(0,o.sU)(1)],ie.prototype,"animFlags",void 0),te([(0,o.sU)(2)],ie.prototype,"duration",void 0),te([(0,o.sU)(2)],ie.prototype,"tracksOffset",void 0),te([(0,o.sU)(2)],ie.prototype,"trackCount",void 0),te([(0,o.sU)(2)],ie.prototype,"gradientTrackOffset",void 0),te([(0,o.sU)(1,{padding:1})],ie.prototype,"overrideWithFace",void 0);class re extends G{get preset(){return this.animationPreset}updateLEDs(e,t,i){const r=this.preset,n=1e3*(e-this.startTime)/r.duration;let s=0;const o=[],a=[];for(let e=0;e<r.trackCount;++e){const c=this.bits.getRgbTrack(r.tracksOffset+e).evaluate(n,this.bits,this.die,o,a);for(let e=0;e<c;++e)t[s+e]=o[e],i[s+e]=a[e];s+=c}return s}stop(e){const t=this.preset;let i=0;const r=[];for(let n=0;n<t.trackCount;++n){const s=this.bits.getRgbTrack(t.tracksOffset+n).extractLEDIndices(r);for(let t=0;t<s;++t)e[i+t]=r[t];i+=s}return i}}var ne=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class se{constructor(){this.type=a.keyframed,this.animFlags=0,this.duration=0,this.tracksOffset=0,this.trackCount=0}createInstance(e,t){return new re(this,e,t)}}function oe(){return Math.floor(4294967295*Math.random())}ne([(0,o.sU)(1)],se.prototype,"type",void 0),ne([(0,o.sU)(1)],se.prototype,"animFlags",void 0),ne([(0,o.sU)(2)],se.prototype,"duration",void 0),ne([(0,o.sU)(2)],se.prototype,"tracksOffset",void 0),ne([(0,o.sU)(2)],se.prototype,"trackCount",void 0);class ae extends G{constructor(){super(...arguments),this.nextBlinkTime=0,this.blinkStartTimes=[],this.blinkDurations=[],this.blinkColors=[],this.blinkInterValMinMs=0,this.blinkInterValDeltaMs=0,this.baseColorParam=0}get preset(){return this.animationPreset}start(e){super.start(e);const t=this.preset;this.blinkInterValMinMs=1e6/(t.blinkFrequencyTimes1000+t.blinkFrequencyVarTimes1000);const i=1e6/(t.blinkFrequencyTimes1000-t.blinkFrequencyVarTimes1000);this.blinkInterValDeltaMs=Math.max(i-this.blinkInterValMinMs,1);for(let e=0;e<p.maxLEDsCount;e++)this.blinkStartTimes[e]=0,this.blinkDurations[e]=0;this.nextBlinkTime=e+this.blinkInterValMinMs+oe()%this.blinkInterValDeltaMs,this.baseColorParam=function(e,t){switch(e){case u.faceToGradient:return 1e3*t.currentFace/t.faceCount;case u.faceToRainbowWheel:return 256*t.currentFace/t.faceCount;case u.randomFromGradient:case u.none:default:return 0}}(t.gradientColorType,this.die)}updateLEDs(e,t,i){const r=this.preset,n=this.die.ledCount,s=e-this.startTime,o=r.duration*r.fade/510,a=this.bits.getRgbTrack(r.gradientTrackOffset),c=this.bits.getRgbTrack(r.blinkTrackOffset);let l=255;if(s<=o?l=255*s/o:s>=r.duration-o&&(l=255*(r.duration-s)/o),e>=this.nextBlinkTime){let t=oe()%n;for(let e=0;0!==this.blinkDurations[t]&&e<5;++e)t=oe()%n;this.blinkDurations[t]=r.blinkDuration,this.blinkStartTimes[t]=e;let i=0;switch(r.gradientColorType){case u.randomFromGradient:i=a.evaluateColor(oe()%1e3,this.bits,this.die);break;case u.faceToGradient:{const e=Math.floor(oe()%Math.max(1,2*r.gradientColorVar))-r.gradientColorVar;let t=this.baseColorParam+e;t<0?t=0:t>1e3&&(t=1e3),i=a.evaluateColor(t,this.bits,this.die)}break;case u.faceToRainbowWheel:{const e=Math.floor(oe()%Math.max(1,2*r.gradientColorVar))-r.gradientColorVar;i=k(this.baseColorParam+255*e/1e3)}break;case u.none:default:{const e=1e3*s/r.duration;i=a.evaluateColor(e,this.bits,this.die)}}this.blinkColors[t]=i,this.nextBlinkTime=e+this.blinkInterValMinMs+oe()%this.blinkInterValDeltaMs}let d=0;for(let r=0;r<n;++r)if(this.blinkDurations[r]>0){const n=e-this.blinkStartTimes[r];if(n>this.blinkDurations[r])t[d]=r,i[d]=0,d++,this.blinkDurations[r]=0,this.blinkStartTimes[r]=0;else{const e=1e3*n/this.blinkDurations[r],s=c.evaluateColor(e,this.bits,this.die);t[d]=r,i[d]=_(v(this.blinkColors[r],s),l),d++}}return d}stop(e){return this.setIndices(p.faceMaskAll,e)}}var ce=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class le{constructor(){this.type=a.noise,this.animFlags=0,this.duration=0,this.gradientTrackOffset=0,this.blinkTrackOffset=0,this.blinkFrequencyTimes1000=0,this.blinkFrequencyVarTimes1000=0,this.blinkDuration=0,this.fade=0,this.gradientColorType=u.none,this.gradientColorVar=0}createInstance(e,t){return new ae(this,e,t)}}ce([(0,o.sU)(1)],le.prototype,"type",void 0),ce([(0,o.sU)(1)],le.prototype,"animFlags",void 0),ce([(0,o.sU)(2)],le.prototype,"duration",void 0),ce([(0,o.sU)(2)],le.prototype,"gradientTrackOffset",void 0),ce([(0,o.sU)(2)],le.prototype,"blinkTrackOffset",void 0),ce([(0,o.sU)(2)],le.prototype,"blinkFrequencyTimes1000",void 0),ce([(0,o.sU)(2)],le.prototype,"blinkFrequencyVarTimes1000",void 0),ce([(0,o.sU)(2)],le.prototype,"blinkDuration",void 0),ce([(0,o.sU)(1)],le.prototype,"fade",void 0),ce([(0,o.sU)(1)],le.prototype,"gradientColorType",void 0),ce([(0,o.sU)(2)],le.prototype,"gradientColorVar",void 0);class ue extends G{get preset(){return this.animationPreset}updateLEDs(e,t,i){const r=this.preset,n=this.die.ledCount;let s=0;const o=r.duration*r.fade/510,a=e-this.startTime,l=a*r.count*255/r.duration%256;let u=r.intensity;a<=o?u=a*r.intensity/o:a>=r.duration-o&&(u=(r.duration-a)*r.intensity/o);let d=0;if(r.animFlags&c.traveling)for(let e=0;e<n;++e)r.faceMask&1<<e&&(t[d]=e,i[d]=k((l+256*e*r.cyclesTimes10/(10*n))%256,u),d++);else s=k(l,u),d=this.setColor(s,r.faceMask,t,i);return d}stop(e){return this.setIndices(this.preset.faceMask,e)}}var de=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class pe{constructor(){this.type=a.rainbow,this.animFlags=0,this.duration=0,this.faceMask=0,this.count=0,this.fade=0,this.intensity=128,this.cyclesTimes10=10}createInstance(e,t){return new ue(this,e,t)}}de([(0,o.sU)(1)],pe.prototype,"type",void 0),de([(0,o.sU)(1)],pe.prototype,"animFlags",void 0),de([(0,o.sU)(2)],pe.prototype,"duration",void 0),de([(0,o.sU)(4)],pe.prototype,"faceMask",void 0),de([(0,o.sU)(1)],pe.prototype,"count",void 0),de([(0,o.sU)(1)],pe.prototype,"fade",void 0),de([(0,o.sU)(1)],pe.prototype,"intensity",void 0),de([(0,o.sU)(1)],pe.prototype,"cyclesTimes10",void 0);class he extends G{constructor(){super(...arguments),this._rgb=0}get preset(){return this.animationPreset}start(e){super.start(e),this._rgb=this.bits.getColor32(this.preset.colorIndex,this.die)}updateLEDs(e,t,i){const r=this.preset;let n=0;const s=r.duration/r.count,o=s*r.fade/510,a=(s-2*o)/2,c=(e-this.startTime)%s;return n=c<=o?w(0,0,this._rgb,o,c):c<=o+a?this._rgb:c<=2*o+a?w(this._rgb,o+a,0,2*o+a,c):0,this.setColor(n,r.faceMask,t,i)}stop(e){return this.setIndices(this.preset.faceMask,e)}}var fe=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class ye{constructor(){this.type=a.simple,this.animFlags=0,this.duration=0,this.faceMask=0,this.colorIndex=0,this.count=0,this.fade=0}createInstance(e,t){return new he(this,e,t)}}function me(e=0,t=0,i=0){return{xTimes1000:1e3*e,yTimes1000:1e3*t,zTimes1000:1e3*i}}function ge(e){const t=function(e){return Math.sqrt(1e3*function(e){return(e.xTimes1000*e.xTimes1000+e.yTimes1000*e.yTimes1000+e.zTimes1000*e.zTimes1000)/1e3}(e))}(e);e.xTimes1000=1e3*e.xTimes1000/t,e.yTimes1000=1e3*e.yTimes1000/t,e.zTimes1000=1e3*e.zTimes1000/t}function ve(e,t){return(e.xTimes1000*t.xTimes1000+e.yTimes1000*t.yTimes1000+e.zTimes1000*t.zTimes1000)/1e3}function be(e,t){return{xTimes1000:(e.yTimes1000*t.zTimes1000-e.zTimes1000*t.yTimes1000)/1e3,yTimes1000:(e.zTimes1000*t.xTimes1000-e.xTimes1000*t.zTimes1000)/1e3,zTimes1000:(e.xTimes1000*t.yTimes1000-e.yTimes1000*t.xTimes1000)/1e3}}function we(e,t){return{xTimes1000:e.xTimes1000-t.xTimes1000,yTimes1000:e.yTimes1000-t.yTimes1000,zTimes1000:e.zTimes1000-t.zTimes1000}}function Te(e,t){return"d6pipped"===e?0===t?0:t<=4?3:t<=6?1:t<=9?2:t<=14?4:5:t}function _e(e){switch(e){case"unknown":case"d10":case"d00":return 0;case"d20":return 19;case"d12":return 11;case"d8":return 7;default:return 5}}function ke(e){switch(e){case"unknown":return 0;case"d20":return 20;case"d12":return 12;case"d10":case"d00":return 10;case"d8":return 8;default:return 6}}function Ce(e){switch(e){case"unknown":return 0;case"d20":return 20;case"d12":return 12;case"d10":case"d00":return 10;case"d8":return 8;case"d6pipped":return 21;default:return 6}}function xe(e,t){if("number"==typeof e)switch(t){case"d10":case"unknown":++e;break;case"d00":e=1+Math.round(e/10)}if("number"==typeof e){const i=e;return(0,o.vA)(i>0&&i<=32,`getFaceMask: Face value is out of range [1, 32], got ${i} for type ${t}`),1<<i-1>>>0}return e.reduce(((e,i)=>xe(i,t)|e),0)}function Ue(e){return(0,o.ZI)(e).map((e=>e+1))}fe([(0,o.sU)(1)],ye.prototype,"type",void 0),fe([(0,o.sU)(1)],ye.prototype,"animFlags",void 0),fe([(0,o.sU)(2)],ye.prototype,"duration",void 0),fe([(0,o.sU)(4)],ye.prototype,"faceMask",void 0),fe([(0,o.sU)(2)],ye.prototype,"colorIndex",void 0),fe([(0,o.sU)(1)],ye.prototype,"count",void 0),fe([(0,o.sU)(1)],ye.prototype,"fade",void 0);const Ae=[{xTimes1000:-335,yTimes1000:937,zTimes1000:-92},{xTimes1000:-352,yTimes1000:-930,zTimes1000:-98},{xTimes1000:716,yTimes1000:572,zTimes1000:-399},{xTimes1000:-253,yTimes1000:-357,zTimes1000:898},{xTimes1000:-995,yTimes1000:8,zTimes1000:93},{xTimes1000:804,yTimes1000:-9,zTimes1000:593},{xTimes1000:-396,yTimes1000:583,zTimes1000:-708},{xTimes1000:705,yTimes1000:-582,zTimes1000:-403},{xTimes1000:407,yTimes1000:571,zTimes1000:712},{xTimes1000:246,yTimes1000:-355,zTimes1000:-901},{xTimes1000:-246,yTimes1000:355,zTimes1000:901},{xTimes1000:-407,yTimes1000:-571,zTimes1000:-712},{xTimes1000:-705,yTimes1000:582,zTimes1000:403},{xTimes1000:396,yTimes1000:-583,zTimes1000:708},{xTimes1000:-804,yTimes1000:9,zTimes1000:-593},{xTimes1000:995,yTimes1000:-8,zTimes1000:-93},{xTimes1000:253,yTimes1000:357,zTimes1000:-898},{xTimes1000:-716,yTimes1000:-572,zTimes1000:399},{xTimes1000:352,yTimes1000:930,zTimes1000:98},{xTimes1000:335,yTimes1000:-937,zTimes1000:92}],Se=[{xTimes1000:-446,yTimes1000:850,zTimes1000:-276},{xTimes1000:-447,yTimes1000:525,zTimes1000:723},{xTimes1000:-447,yTimes1000:-850,zTimes1000:-276},{xTimes1000:-1e3,yTimes1000:0,zTimes1000:-0},{xTimes1000:447,yTimes1000:525,zTimes1000:-723},{xTimes1000:-447,yTimes1000:0,zTimes1000:-894},{xTimes1000:447,yTimes1000:-0,zTimes1000:894},{xTimes1000:-447,yTimes1000:-525,zTimes1000:723},{xTimes1000:1e3,yTimes1000:-0,zTimes1000:0},{xTimes1000:447,yTimes1000:850,zTimes1000:276},{xTimes1000:447,yTimes1000:-525,zTimes1000:-723},{xTimes1000:446,yTimes1000:-850,zTimes1000:276}],Pe=[{xTimes1000:-65,yTimes1000:996,zTimes1000:55},{xTimes1000:165,yTimes1000:-617,zTimes1000:768},{xTimes1000:489,yTimes1000:-8,zTimes1000:-871},{xTimes1000:-993,yTimes1000:17,zTimes1000:111},{xTimes1000:650,yTimes1000:603,zTimes1000:461},{xTimes1000:-650,yTimes1000:-603,zTimes1000:-461},{xTimes1000:993,yTimes1000:-17,zTimes1000:-111},{xTimes1000:-489,yTimes1000:8,zTimes1000:871},{xTimes1000:-165,yTimes1000:617,zTimes1000:-768},{xTimes1000:65,yTimes1000:-996,zTimes1000:-55}],Me=[{xTimes1000:-921,yTimes1000:-198,zTimes1000:-333},{xTimes1000:288,yTimes1000:897,zTimes1000:-333},{xTimes1000:-0,yTimes1000:0,zTimes1000:-1e3},{xTimes1000:-633,yTimes1000:698,zTimes1000:333},{xTimes1000:633,yTimes1000:-698,zTimes1000:-333},{xTimes1000:0,yTimes1000:-0,zTimes1000:1e3},{xTimes1000:-288,yTimes1000:-897,zTimes1000:333},{xTimes1000:921,yTimes1000:198,zTimes1000:333}],Oe=[{xTimes1000:-1e3,yTimes1000:0,zTimes1000:0},{xTimes1000:0,yTimes1000:1e3,zTimes1000:0},{xTimes1000:0,yTimes1000:0,zTimes1000:1e3},{xTimes1000:0,yTimes1000:0,zTimes1000:-1e3},{xTimes1000:0,yTimes1000:-1e3,zTimes1000:0},{xTimes1000:1e3,yTimes1000:0,zTimes1000:0}],$e=[63,68,70,72,73,75,76,77,78,79,79,80,81,82,82,83,84,84,85,86,86,87,87,88,89,89,90,90,91,91,92,92,93,93,94,94,95,95,95,96,96,97,97,98,98,98,99,99,100,100,100,101,101,102,102,102,103,103,104,104,104,105,105,105,106,106,107,107,107,108,108,108,109,109,109,110,110,110,111,111,112,112,112,113,113,113,114,114,114,115,115,115,116,116,116,117,117,117,118,118,118,119,119,119,119,120,120,120,121,121,121,122,122,122,123,123,123,124,124,124,125,125,125,126,126,126,127,127,127,127,128,128,128,129,129,129,130,130,130,131,131,131,132,132,132,133,133,133,134,134,134,135,135,135,135,136,136,136,137,137,137,138,138,138,139,139,139,140,140,140,141,141,141,142,142,142,143,143,144,144,144,145,145,145,146,146,146,147,147,147,148,148,149,149,149,150,150,150,151,151,152,152,152,153,153,154,154,154,155,155,156,156,156,157,157,158,158,159,159,159,160,160,161,161,162,162,163,163,164,164,165,165,166,167,167,168,168,169,170,170,171,172,172,173,174,175,175,176,177,178,179,181,182,184,186,191];function Ie(e){return 64+$e[255&e]}class Ee extends G{constructor(){super(...arguments),this.normals=[],this.faceNormal=me(),this.backVector=me(),this.baseColorParam=0}get preset(){return this.animationPreset}start(e){super.start(e);const t=this.preset,i=this.die.faceCount;this.normals=function(e){switch(e){case"d20":return Ae;case"d12":return Se;case"d10":case"d00":return Pe;case"d8":return Me;default:return Oe}}(this.die.dieType);const r=this.die.topFace;this.faceNormal=this.normals[r];let n=1,s=this.normals[(r+n)%i];for(;Math.abs(ve(this.faceNormal,s))>800&&n<i;)n+=1,s=Object.assign({},this.normals[(r+n)%i]);const o=be(this.faceNormal,s);switch(ge(o),this.backVector=be(o,this.faceNormal),t.mainGradientColorType){case d.faceToGradient:this.baseColorParam=1e3*this.die.currentFace/i;break;case d.faceToRainbowWheel:this.baseColorParam=256*this.die.currentFace/i;break;case d.none:default:this.baseColorParam=0}}updateLEDs(e,t,i){const r=this.preset,n=this.die.ledCount,s=e-this.startTime,o=r.duration*r.fade/510;let a=255;s<=o?a=255*s/o:s>=r.duration-o&&(a=255*(r.duration-s)/o);const c=s*r.axisScrollSpeedTimes1000/r.duration,l=s*r.angleScrollSpeedTimes1000/r.duration,u=1e3*s/r.duration,p=this.bits.getRgbTrack(r.gradientTrackOffset),h=this.bits.getRgbTrack(r.axisGradientTrackOffset),f=this.bits.getRgbTrack(r.angleGradientTrackOffset);for(let e=0;e<n;++e){const n=Te(this.die.dieType,e),s=ve(this.faceNormal,this.normals[n]),o=1e3*(Ie((1275*s+1275e3)/1e4)-128)/128,g=1e3*o/r.axisScaleTimes1000+r.axisOffsetTimes1000+c,b=h.evaluateColor(g,this.bits,this.die),w=we(this.normals[n],(m=s,{xTimes1000:(y=this.faceNormal).xTimes1000*m/1e3,yTimes1000:y.yTimes1000*m/1e3,zTimes1000:y.zTimes1000*m/1e3}));ge(w);let T=Ie((1275*ve(this.backVector,w)+1275e3)/1e4);ve(be(this.backVector,this.normals[n]),this.faceNormal)<0&&(T=255-T);const C=((1e3*(T-128)/128+1e3)/2+l)%1e3,x=f.evaluateColor(C,this.bits,this.die);let U=0;switch(r.mainGradientColorType){case d.faceToGradient:{const e=this.baseColorParam+o*r.mainGradientColorVar/1e3;U=p.evaluateColor(e,this.bits,this.die)}break;case d.faceToRainbowWheel:U=k((this.baseColorParam+o*r.mainGradientColorVar*256/1e6)%256);break;case d.none:default:U=p.evaluateColor(u,this.bits,this.die)}t[e]=e,i[e]=_(v(U,v(b,x)),a)}var y,m;return n}stop(e){return this.setIndices(p.faceMaskAll,e)}}var De=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class Fe{constructor(){this.type=a.normals,this.animFlags=0,this.duration=0,this.gradientTrackOffset=0,this.axisGradientTrackOffset=0,this.angleGradientTrackOffset=0,this.axisScaleTimes1000=0,this.axisOffsetTimes1000=0,this.axisScrollSpeedTimes1000=0,this.angleScrollSpeedTimes1000=0,this.fade=0,this.mainGradientColorType=d.none,this.mainGradientColorVar=0}createInstance(e,t){return new Ee(this,e,t)}}De([(0,o.sU)(1)],Fe.prototype,"type",void 0),De([(0,o.sU)(1)],Fe.prototype,"animFlags",void 0),De([(0,o.sU)(2)],Fe.prototype,"duration",void 0),De([(0,o.sU)(2)],Fe.prototype,"gradientTrackOffset",void 0),De([(0,o.sU)(2)],Fe.prototype,"axisGradientTrackOffset",void 0),De([(0,o.sU)(2)],Fe.prototype,"angleGradientTrackOffset",void 0),De([(0,o.sU)(2,{numberFormat:"signed"})],Fe.prototype,"axisScaleTimes1000",void 0),De([(0,o.sU)(2,{numberFormat:"signed"})],Fe.prototype,"axisOffsetTimes1000",void 0),De([(0,o.sU)(2,{numberFormat:"signed"})],Fe.prototype,"axisScrollSpeedTimes1000",void 0),De([(0,o.sU)(2,{numberFormat:"signed"})],Fe.prototype,"angleScrollSpeedTimes1000",void 0),De([(0,o.sU)(1)],Fe.prototype,"fade",void 0),De([(0,o.sU)(1)],Fe.prototype,"mainGradientColorType",void 0),De([(0,o.sU)(2)],Fe.prototype,"mainGradientColorVar",void 0);class ze extends G{constructor(){super(...arguments),this._lastMillis=-1,this._animInstances=[]}get preset(){return this.animationPreset}start(e){super.start(e),this._lastMillis=-1;const t=this.preset,i=[t.animation0Offset,t.animation1Offset,t.animation2Offset,t.animation3Offset],r=[t.animation0Delay,t.animation1Delay,t.animation2Delay,t.animation3Delay];this._animInstances.length=0;for(let e=0;e<t.animationCount;e++){const t=i[e],n=r[e];this._animInstances.push({anim:this.bits.getAnimation(t).createInstance(this.bits,this.die),delay:n,started:!1})}}updateLEDs(e,t,i){const r=this.preset,n=this._lastMillis-this.startTime,s=e-this.startTime;this._lastMillis=e;let o=0;const a=Array(p.maxLEDsCount),c=Array(p.maxLEDsCount);for(let l=0;l<r.animationCount;l++){const r=this._animInstances[l].delay;if(!this._animInstances[l].started&&r>n&&r<=s&&(this._animInstances[l].anim.start(e),this._animInstances[l].started=!0),this._animInstances[l].started){a.fill(0),c.fill(0);const r=this._animInstances[l].anim.updateLEDs(e,a,c);for(let e=0;e<r;e++){const r=t.indexOf(a[e]);r>=0&&r<o?i[r]=b(i[r],c[e]):(t[o]=a[e],i[o]=c[e],++o)}}}return o}stop(){return 0}}var Le=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class Re{constructor(){this.type=a.sequence,this.animFlags=0,this.duration=0,this.animation0Offset=0,this.animation0Delay=0,this.animation1Offset=0,this.animation1Delay=0,this.animation2Offset=0,this.animation2Delay=0,this.animation3Offset=0,this.animation3Delay=0,this.animationCount=0}createInstance(e,t){return new ze(this,e,t)}}Le([(0,o.sU)(1)],Re.prototype,"type",void 0),Le([(0,o.sU)(1)],Re.prototype,"animFlags",void 0),Le([(0,o.sU)(2)],Re.prototype,"duration",void 0),Le([(0,o.sU)(2)],Re.prototype,"animation0Offset",void 0),Le([(0,o.sU)(2)],Re.prototype,"animation0Delay",void 0),Le([(0,o.sU)(2)],Re.prototype,"animation1Offset",void 0),Le([(0,o.sU)(2)],Re.prototype,"animation1Delay",void 0),Le([(0,o.sU)(2)],Re.prototype,"animation2Offset",void 0),Le([(0,o.sU)(2)],Re.prototype,"animation2Delay",void 0),Le([(0,o.sU)(2)],Re.prototype,"animation3Offset",void 0),Le([(0,o.sU)(2)],Re.prototype,"animation3Delay",void 0),Le([(0,o.sU)(2)],Re.prototype,"animationCount",void 0);class je{constructor(){this.timeAndColor=0}get time(){return 2*((65535&this.timeAndColor)>>7)}get colorIndex(){return 127&this.timeAndColor}getColor(e,t){return e.getColor32(this.colorIndex,t)}setTimeAndColorIndex(e,t){const i=Math.round(1e3*Math.max(0,e))/2&511;this.timeAndColor=i<<7|127&t}equals(e){return this.timeAndColor===e.timeAndColor}}!function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)}([(0,o.sU)(2)],je.prototype,"timeAndColor",void 0);var Ve=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class Be{constructor(){this.keyframesOffset=0,this.keyFrameCount=0,this.ledMask=0}getDuration(e){return e.getRgbKeyframe(this.keyframesOffset+this.keyFrameCount-1).time}getKeyframe(e,t){return(0,o.vA)(t>=0&&t<this.keyFrameCount,`Invalid key frame index: ${t} (count: ${this.keyFrameCount})`),e.getRgbKeyframe(this.keyframesOffset+t)}evaluate(e,t,i,r,n){if(0===this.keyFrameCount)return 0;const s=this.evaluateColor(e,t,i);let o=0;for(let e=0;e<p.maxLEDsCount;++e)this.ledMask&1<<e&&(r[o]=e,n[o]=s,o++);return o}evaluateColor(e,t,i){if(0===this.keyFrameCount)return 0;let r=0;for(;r<this.keyFrameCount&&this.getKeyframe(t,r).time<e;)r++;let n=0;if(0===r)n=this.getKeyframe(t,r).getColor(t,i);else if(r===this.keyFrameCount)n=this.getKeyframe(t,r-1).getColor(t,i);else{const s=this.getKeyframe(t,r),o=s.time,a=s.getColor(t,i),c=this.getKeyframe(t,r-1),l=c.time;n=w(c.getColor(t,i),l,a,o,e)}return n}extractLEDIndices(e){let t=0;for(let i=0;i<p.maxLEDsCount;++i)this.ledMask&1<<i&&(e[t]=i,t++);return t}equals(e){return this.keyframesOffset===e.keyframesOffset&&this.keyFrameCount===e.keyFrameCount&&this.ledMask===e.ledMask}}Ve([(0,o.sU)(2)],Be.prototype,"keyframesOffset",void 0),Ve([(0,o.sU)(1,{padding:1})],Be.prototype,"keyFrameCount",void 0),Ve([(0,o.sU)(4)],Be.prototype,"ledMask",void 0);class Ne{constructor(){this.timeAndIntensity=0}get time(){return 2*((65535&this.timeAndIntensity)>>7)}get intensity(){return 2*(127&this.timeAndIntensity)}setTimeAndIntensity(e,t){const i=Math.round(1e3*Math.max(0,e))/2&511,r=127&Math.floor(t/2);this.timeAndIntensity=i<<7|r}equals(e){return this.timeAndIntensity===e.timeAndIntensity}}!function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)}([(0,o.sU)(2)],Ne.prototype,"timeAndIntensity",void 0);var Ke=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class We{constructor(){this.keyframesOffset=0,this.keyFrameCount=0,this.ledMask=0}getDuration(e){return e.getRgbKeyframe(this.keyframesOffset+this.keyFrameCount-1).time}getKeyframe(e,t){return(0,o.vA)(t>=0&&t<this.keyFrameCount,`Invalid key frame index: ${t} (count: ${this.keyFrameCount})`),e.getKeyframe(this.keyframesOffset+t)}evaluate(e,t,i,r,n,s){if(0===this.keyFrameCount)return 0;const o=_(t,this.evaluateIntensity(e,i));let a=0;for(let e=0;e<r;++e)this.ledMask&1<<e&&(n[a]=e,s[a]=o,a++);return a}evaluateIntensity(e,t){let i=0;for(;i<this.keyFrameCount&&this.getKeyframe(e,i).time<t;)i++;if(0===i)return this.getKeyframe(e,i).intensity;if(i===this.keyFrameCount)return this.getKeyframe(e,i-1).intensity;{const r=this.getKeyframe(e,i),n=r.time,s=r.intensity,o=this.getKeyframe(e,i-1),a=o.time;return T(o.intensity,a,s,n,t)}}extractLEDIndices(e){let t=0;for(let i=0;i<p.maxLEDsCount;++i)this.ledMask&1<<i&&(e[t]=i,t++);return t}equals(e){return this.keyframesOffset===e.keyframesOffset&&this.keyFrameCount===e.keyFrameCount&&this.ledMask===e.ledMask}}function qe(e){return e&&e<=170415e7}Ke([(0,o.sU)(2)],We.prototype,"keyframesOffset",void 0),Ke([(0,o.sU)(1,{padding:1})],We.prototype,"keyFrameCount",void 0),Ke([(0,o.sU)(4)],We.prototype,"ledMask",void 0);const Ge={getLEDCount(e){switch(e){case"unknown":return 0;case"d4":case"d6":case"d6fudge":return 6;case"d6pipped":return 21;case"d8":return 8;case"d10":case"d00":return 10;case"d12":return 12;case"d20":return 20;default:(0,o.xb)(e)}},getFaceCount(e){switch(e){case"unknown":return 0;case"d4":return 4;case"d6":case"d6fudge":case"d6pipped":return 6;case"d8":return 8;case"d10":case"d00":return 10;case"d12":return 12;case"d20":return 20;default:(0,o.xb)(e)}},getHighestFace:e=>"d10"===e||"d00"===e?0:Ge.getFaceCount(e),getLowestFace:e=>"d00"===e?10:1,getTopFace:e=>Ge.getHighestFace(e),getBottomFace:e=>"d10"===e?9:"d00"===e?90:1,estimateDieType(e){switch(e){case 4:return"d4";case 6:return"d6";case 8:return"d8";case 10:return"d10";case 12:return"d12";case 20:return"d20";case 21:return"d6pipped";default:return"unknown"}},faceFromIndex(e,t,i){if(qe(i))switch(t){case"d4":return 3===e?2:2===e?3:5===e?4:1;case"d6":return 4===e?2:3===e?3:2===e?4:1===e?5:e+1}switch(t){case"d10":case"unknown":return e;case"d00":return 10*e;default:return e+1}},indexFromFace(e,t,i){if(qe(i))switch(t){case"d4":return 2===e?3:3===e?2:4===e?5:0;case"d6":return 2===e?4:3===e?3:4===e?2:5===e?1:e-1}switch(t){case"d10":case"unknown":return e;case"d00":return Math.floor(e/10);default:return e-1}},getDieFaces(e){switch(e){case"unknown":return[];case"d4":return(0,o.y1)(1,5);case"d6":case"d6pipped":case"d6fudge":return(0,o.y1)(1,7);case"d8":return(0,o.y1)(1,9);case"d10":return(0,o.y1)(0,10);case"d00":return(0,o.y1)(0,100,10);case"d12":return(0,o.y1)(1,13);case"d20":return(0,o.y1)(1,21);default:(0,o.xb)(e)}},mapFaceForAnimation:(e,t)=>1+Ge.indexFromFace(e,t),unMapFaceFromAnimation:(e,t)=>Ge.faceFromIndex(e-1,t),getPd6LedIndex(e,t=0){let i=0;for(let t=1;t<e;++t)i+=t;return i+t}};class He{get currentFace(){return this.tryRoll(),this._currentFace}constructor(e="d20"){this._currentFace=0,this._lastRoll=0,this.dieType=e,this.ledCount=Ge.getLEDCount(e),this.faceCount=Ge.getFaceCount(e),this.topFace=Ge.indexFromFace(Ge.getTopFace(e),e),this.tryRoll()}tryRoll(){const e=Date.now();e-this._lastRoll>5e3&&(this._lastRoll=e,this._currentFace=Math.floor(Math.random()*this.faceCount))}}const Ye={unknown:(0,o.$9)(0),onyxBlack:(0,o.$9)(),hematiteGrey:(0,o.$9)(),midnightGalaxy:(0,o.$9)(),auroraSky:(0,o.$9)(),clear:(0,o.$9)(),whiteAurora:(0,o.$9)(),custom:255},Ze={unknown:(0,o.$9)(0),d4:(0,o.$9)(),d6:(0,o.$9)(),d8:(0,o.$9)(),d10:(0,o.$9)(),d00:(0,o.$9)(),d12:(0,o.$9)(),d20:(0,o.$9)(),d6pipped:(0,o.$9)(),d6fudge:(0,o.$9)()};var Je=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class Xe{constructor(){this.rulesOffset=0,this.rulesCount=0}}Je([(0,o.sU)(2)],Xe.prototype,"rulesOffset",void 0),Je([(0,o.sU)(2)],Xe.prototype,"rulesCount",void 0);var Qe=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class et{constructor(){this.condition=0,this.actionOffset=0,this.actionCount=0,this.actionCountPadding=0}}Qe([(0,o.sU)(2)],et.prototype,"condition",void 0),Qe([(0,o.sU)(2)],et.prototype,"actionOffset",void 0),Qe([(0,o.sU)(2)],et.prototype,"actionCount",void 0),Qe([(0,o.sU)(2)],et.prototype,"actionCountPadding",void 0);const tt={none:(0,o.$9)(0),playAnimation:(0,o.$9)(),playAudioClip:(0,o.$9)(),makeWebRequest:(0,o.$9)(),speakText:(0,o.$9)()};var it=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class rt{constructor(){this.type=tt.playAnimation,this.animIndex=0,this.faceIndex=0,this.loopCount=0}}it([(0,o.sU)(1)],rt.prototype,"type",void 0),it([(0,o.sU)(1)],rt.prototype,"animIndex",void 0),it([(0,o.sU)(1,{numberFormat:"signed"})],rt.prototype,"faceIndex",void 0),it([(0,o.sU)(1)],rt.prototype,"loopCount",void 0);var nt=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class st{constructor(){this.type=tt.playAudioClip,this._unused=0,this.actionId=0}}nt([(0,o.sU)(1)],st.prototype,"type",void 0),nt([(0,o.sU)(1)],st.prototype,"_unused",void 0),nt([(0,o.sU)(2)],st.prototype,"actionId",void 0);var ot=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class at{constructor(){this.type=tt.makeWebRequest,this._unused=0,this.actionId=0}}ot([(0,o.sU)(1)],at.prototype,"type",void 0),ot([(0,o.sU)(1)],at.prototype,"_unused",void 0),ot([(0,o.sU)(2)],at.prototype,"actionId",void 0);var ct=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class lt{constructor(){this.type=tt.speakText,this._unused=0,this.actionId=0}}ct([(0,o.sU)(1)],lt.prototype,"type",void 0),ct([(0,o.sU)(1)],lt.prototype,"_unused",void 0),ct([(0,o.sU)(2)],lt.prototype,"actionId",void 0);const ut={none:(0,o.$9)(0),helloGoodbye:(0,o.$9)(),handling:(0,o.$9)(),rolling:(0,o.$9)(),faceCompare:(0,o.$9)(),crooked:(0,o.$9)(),connection:(0,o.$9)(),battery:(0,o.$9)(),idle:(0,o.$9)(),rolled:(0,o.$9)()};var dt=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};const pt={ok:(0,o.YE)(0),low:(0,o.YE)(),charging:(0,o.YE)(),done:(0,o.YE)(),badCharging:(0,o.YE)(),error:(0,o.YE)()};class ht{constructor(){this.type=ut.battery,this.flags=0,this.repeatPeriodMs=0}}dt([(0,o.sU)(1)],ht.prototype,"type",void 0),dt([(0,o.sU)(1)],ht.prototype,"flags",void 0),dt([(0,o.sU)(2)],ht.prototype,"repeatPeriodMs",void 0);var ft=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};const yt={connected:(0,o.YE)(0),disconnected:(0,o.YE)()};class mt{constructor(){this.type=ut.connection,this.flags=0}}ft([(0,o.sU)(1)],mt.prototype,"type",void 0),ft([(0,o.sU)(1,{padding:2})],mt.prototype,"flags",void 0);var gt=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};const vt={less:(0,o.YE)(0),equal:(0,o.YE)(),greater:(0,o.YE)()};class bt{constructor(){this.type=ut.faceCompare,this.faceIndex=0,this.flags=0}}gt([(0,o.sU)(1)],bt.prototype,"type",void 0),gt([(0,o.sU)(1)],bt.prototype,"faceIndex",void 0),gt([(0,o.sU)(1,{padding:1})],bt.prototype,"flags",void 0);var wt=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};const Tt={hello:(0,o.YE)(0),goodbye:(0,o.YE)()};class _t{constructor(){this.type=ut.helloGoodbye,this.flags=0}}wt([(0,o.sU)(1)],_t.prototype,"type",void 0),wt([(0,o.sU)(1,{padding:2})],_t.prototype,"flags",void 0);class kt{constructor(){this.type=ut.crooked}}!function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)}([(0,o.sU)(1,{padding:3})],kt.prototype,"type",void 0);class Ct{constructor(){this.type=ut.handling}}!function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)}([(0,o.sU)(1,{padding:3})],Ct.prototype,"type",void 0);var xt=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class Ut{constructor(){this.type=ut.idle,this.repeatPeriodMs=0}}xt([(0,o.sU)(1,{padding:1})],Ut.prototype,"type",void 0),xt([(0,o.sU)(2)],Ut.prototype,"repeatPeriodMs",void 0);var At=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class St{constructor(){this.type=ut.rolling,this.repeatPeriodMs=0}}At([(0,o.sU)(1,{padding:1})],St.prototype,"type",void 0),At([(0,o.sU)(2)],St.prototype,"repeatPeriodMs",void 0);var Pt=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class Mt{constructor(){this.type=ut.rolled,this.faceMask=0}}function Ot(e){switch(e){case"none":return;case"simple":return{name:"Simple Flashes",order:0};case"rainbow":return{name:"Colorful Rainbow",order:1};case"keyframed":return{name:"Colored Design",order:3};case"gradientPattern":return{name:"Mixed Design",order:4};case"gradient":return{name:"Simple Gradient",order:2};case"noise":return{name:"Noise",order:5};case"normals":return{name:"Normals",order:6};case"sequence":return{name:"Sequence",order:7};case"cycle":case"name":throw new Error(`getAnimationTypeDisplayName: unsupported animation type: ${e}`);default:(0,o.xb)(e,`Unknown animation type: ${e}`)}}function $t(e){switch(e){case"none":return;case"playAnimation":return{name:"Trigger Pattern",order:0};case"playAudioClip":return{name:"Play Audio Clip",order:1};case"makeWebRequest":return{name:"Make Web Request",order:2};case"speakText":return{name:"Speak Text",order:3};default:(0,o.xb)(e,`Unknown action type: ${e}`)}}function It(e){switch(e){case"none":return;case"helloGoodbye":return{name:"Pixel wakes up / sleeps",order:0};case"handling":return{name:"Pixel is picked up",order:1};case"rolling":return{name:"Pixel is rolling",order:2};case"faceCompare":return{name:"Pixel roll is...",order:3};case"crooked":return{name:"Pixel is crooked",order:4};case"connection":return{name:"Bluetooth Event...",order:5};case"battery":return{name:"Battery Event...",order:6};case"idle":return{name:"Pixel is idle for...",order:7};case"rolled":return{name:"Pixel roll is one of...",order:8};default:(0,o.xb)(e,`Unknown condition type: ${e}`)}}Pt([(0,o.sU)(1,{padding:3})],Mt.prototype,"type",void 0),Pt([(0,o.sU)(4)],Mt.prototype,"faceMask",void 0);class Et{get animationBits(){return this._animationBits}get animations(){return this._animationBits.animations}get conditions(){return this._conditions}get actions(){return this._actions}get rules(){return this._rules}get brightness(){return this._brightness}set brightness(e){this._brightness=e}get profile(){return this._profile}set profile(e){this._profile=e}constructor(e){this._conditions=[],this._actions=[],this._rules=[],this._profile=new Xe,this._brightness=255,this._animationBits=null!=e?e:new q}computeDataSetByteSize(){return this._animationBits.computeDataSize()+h(2*this.animations.length)+(0,o.bE)(this.animations)+h(2*this._conditions.length)+(0,o.bE)(this._conditions)+h(2*this._actions.length)+(0,o.bE)(this._actions)+(0,o.bE)(this._rules)+(this._profile?(0,o.bE)(this._profile):0)}toSingleAnimationByteArray(){(0,o.vA)(1===this.animations.length,"Need exactly one animation"),(0,o.vA)(this._animationBits.palette.length<128,"Palette has more than 127 colors: "+this._animationBits.palette.length);const e=this._animationBits.computeDataSize()+(0,o.bE)(this.animations[0]),[t,i]=this._animationBits.serialize(new DataView(new ArrayBuffer(e)));return(0,o.lK)(this.animations[0],{dataView:t,byteOffset:i}),new Uint8Array(t.buffer)}toAnimationsByteArray(){(0,o.vA)(this.animations.length>0,"No animations"),(0,o.vA)(this._animationBits.palette.length<128,"Palette has more than 127 colors: "+this._animationBits.palette.length);const e=this._animationBits.computeDataSize()+h(2*this.animations.length)+(0,o.bE)(this.animations);let[t,i]=this._animationBits.serialize(new DataView(new ArrayBuffer(e))),r=0;return this.animations.forEach(((e,n)=>{t.setUint16(i+2*n,r,!0),r+=(0,o.bE)(e)})),i+=h(2*this.animations.length),[t,i]=(0,o.lK)(this.animations,{dataView:t,byteOffset:i}),new Uint8Array(t.buffer)}toByteArray(){const e=this.computeDataSetByteSize(),[t]=this.serialize(new DataView(new ArrayBuffer(e)));return new Uint8Array(t.buffer)}serialize(e,t=0){(0,o.vA)(this._animationBits.palette.length<128,"Palette has more than 127 colors: "+this._animationBits.palette.length),[e,t]=this._animationBits.serialize(e);let i=0;this.animations.forEach(((r,n)=>{e.setUint16(t+2*n,i,!0),i+=(0,o.bE)(r)})),t+=h(2*this.animations.length),[e,t]=(0,o.lK)(this.animations,{dataView:e,byteOffset:t});let r=0;this._conditions.forEach(((i,n)=>{e.setUint16(t+2*n,r,!0),r+=(0,o.bE)(i)})),t+=h(2*this._conditions.length),[e,t]=(0,o.lK)(this._conditions,{dataView:e,byteOffset:t});let n=0;return this._actions.forEach(((i,r)=>{e.setUint16(t+2*r,n,!0),n+=(0,o.bE)(i)})),t+=h(2*this._actions.length),[e,t]=(0,o.lK)(this._actions,{dataView:e,byteOffset:t}),[e,t]=(0,o.lK)(this._rules,{dataView:e,byteOffset:t}),this._profile&&([e,t]=(0,o.lK)(this._profile,{dataView:e,byteOffset:t})),[e,t]}static computeHash(e){return(0,o.TN)(e)}}},99:(e,t,i)=>{"use strict";i.r(t),i.d(t,{BatteryLevel:()=>De,Blink:()=>Ee,BlinkId:()=>Qe,BulkData:()=>Ce,BulkDataAck:()=>xe,BulkSetup:()=>ke,Charger:()=>ae,ChargerMessages:()=>r,Constants:()=>f,CustomDesignAndColorNameChunk:()=>fe,DebugLog:()=>Oe,DieInfoChunk:()=>he,DieNameChunk:()=>ye,Discharge:()=>Xe,IAmADie:()=>ve,LegacyIAmADie:()=>be,MessageTypeValues:()=>de,NotifyUser:()=>Le,NotifyUserAck:()=>Re,Pixel:()=>rt,PixelBatteryControllerModeValues:()=>Te,PixelBatteryControllerStateValues:()=>ce,PixelBatteryStateValues:()=>g,PixelConnect:()=>se,PixelConnectCancelledError:()=>H,PixelConnectError:()=>q,PixelConnectIdMismatchError:()=>Y,PixelConnectTimeoutError:()=>G,PixelEmptyNameError:()=>Q,PixelError:()=>W,PixelIncompatibleMessageError:()=>X,PixelInfoNotifier:()=>K,PixelPowerOperationValues:()=>We,PixelRollStateValues:()=>le,PixelSession:()=>st,PixelTransferCompletedTimeoutError:()=>re,PixelTransferError:()=>ee,PixelTransferInProgressError:()=>te,PixelTransferInvalidDataError:()=>ie,PixelTransferOutOfMemoryError:()=>ne,PixelWaitForMessageDisconnectError:()=>J,PixelWaitForMessageTimeoutError:()=>Z,PixelsBluetoothIds:()=>nt,PixelsNamePrefixes:()=>s,PlayInstantAnimation:()=>Ye,PlayProfileAnimation:()=>tt,PowerOperation:()=>qe,RemoteAction:()=>$e,RequestRssi:()=>Fe,RequestTelemetry:()=>Ie,RollState:()=>we,Rssi:()=>ze,SetBatteryControllerMode:()=>Je,SetDesignAndColor:()=>Ne,SetName:()=>Ke,SettingsInfoChunk:()=>me,StatusInfoChunk:()=>ge,StoreValue:()=>je,StoreValueAck:()=>Be,StoreValueResultValues:()=>Ve,Telemetry:()=>_e,TelemetryRequestModeValues:()=>b,Temperature:()=>Ze,TransferAnimationSet:()=>Ue,TransferAnimationSetAck:()=>Ae,TransferInstantAnimationSet:()=>Ge,TransferInstantAnimationSetAck:()=>He,TransferInstantAnimationsSetAckTypeValues:()=>Pe,TransferTest:()=>et,TransferTestAnimationSet:()=>Se,TransferTestAnimationSetAck:()=>Me,VersionInfoChunk:()=>pe,getDefaultPixelsDeviceName:()=>u,getPixelIdFromName:()=>p,getPixelsBootloaderAdvertisedName:()=>o,isPixelsBootloaderName:()=>c,isPixelsDeviceName:()=>l,repeatConnect:()=>at,serializer:()=>it,toFullUuid:()=>ct});var r={};i.r(r),i.d(r,{BatteryLevel:()=>E,Blink:()=>I,BulkData:()=>M,BulkDataAck:()=>O,BulkSetup:()=>P,ChargerInfoChunk:()=>k,ChargerMessageTypeValues:()=>T,ChargerNameChunk:()=>C,DebugLog:()=>$,IAmALCC:()=>A,LegacyIAmALCC:()=>S,NotifyUser:()=>z,NotifyUserAck:()=>L,RequestRssi:()=>D,Rssi:()=>F,SetName:()=>R,SettingsInfoChunk:()=>x,StatusInfoChunk:()=>U,Temperature:()=>j,VersionInfoChunk:()=>_,serializer:()=>V});var n=i(721);const s={die:{bootloader:"PXL",default:"Pixel"},charger:{bootloader:"LCC",default:"Charger"}};function o(e,t){if(!t)throw new Error("getBootloaderAdvertisedName: got empty Pixel id");const i=s[e].bootloader;if(!i)throw new Error("isPixelDeviceName: unknown Pixels device type");return i+(0,n.Vl)(t)}function a(e,t){return e.length===t.length+8&&e.startsWith(t)}function c(e,t){const i=s[e].bootloader;if(!i)throw new Error("isPixelDeviceName: unknown Pixels device type");return a(t,i)}function l(e,t){const i=s[e].default;if(!i)throw new Error("isPixelDeviceName: unknown Pixels device type");return a(t,i)}function u(e,t){if(!t)throw new Error("getDefaultPixelName: got empty Pixel id");const i=s[e].default;if(!i)throw new Error("getDefaultPixelName: unknown Pixels device type");return i+(0,n.Vl)(t)}function d(e,t){if(a(e,t))return parseInt(e.slice(t.length),16)}function p(e){for(const t of Object.values(s)){const i=d(e,t.bootloader);if(void 0!==i)return i;const r=d(e,t.default);if(void 0!==r)return r}}var h=i(36);const f={minMtu:23,maxMtu:517,connectionTimeout:1e4,defaultRequestTimeout:1e4,ackMessageTimeout:5e3,maxMessageSize:100,maxNameByteSize:31,maxAdvertisedNameByteSize:13,apiVersion:256,compatApiVersion:256,factoryProfileHashes:{unknown:1464302091,d20:1464302091}};class y{constructor(e){this.type=e}}!function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)}([(0,n.sU)(1)],y.prototype,"type",void 0);class m{constructor(e,t){this._messageNamesLookup=[],this._reverseMsgClassesLookup=new Map,this._messageClassesLookup=new Map,this._messageTypeValues=new Map(e),this._messageClasses=t}getMessageTypeValue(e){return"function"==typeof e?this._getMessageTypeValue(e):"string"==typeof e?this._checkGetMessageTypeValue(e):e.type}getMessageType(e){if("string"==typeof e)return e;{const t="number"==typeof e?e:e.type,i=this._getMessageNameFromValue(t);if(i)return i;throw Error(`getMessageName: ${t} is not a value in MessageTypeValues`)}}instantiateMessage(e){const t=this._checkGetMessageTypeValue(e),i=this._getMessageClass(t);return i?new i:new y(t)}serialize(e){if("object"==typeof e){const t=e,[i]=(0,n.lK)(t);return(0,n.vA)(i.byteLength>0,"Got empty buffer from deserialization"),(0,n.vA)(i.getUint8(0)===this.getMessageTypeValue(t),`Unexpected message type, got ${i.getUint8(0)} instead of ${this.getMessageTypeValue(t)}`),i.buffer}{const t="number"==typeof e?e:this._messageTypeValues.get(e);return(0,n.vA)(t,`No Pixel message value for ${e}`),Uint8Array.of(t)}}deserializeMessage(e){if(!e.byteLength)throw new n.Fn("Can't deserialize an empty buffer");const t=e.getUint8(0);if(1===e.byteLength)return this.getMessageType(t);{const i=this.instantiateMessage(this.getMessageType(t)),r=(0,n.iu)(i,e);return r!==e.byteLength&&console.warn(`The last ${e.byteLength-r} bytes were not read while deserializing message of type ${i.type}`),(0,n.vA)(i.type===t,`Incorrect message type after deserializing ${i.type} but expecting ${t}`),i}}_getMessageNameFromValue(e){if(!this._messageNamesLookup.length){const e=this._messageNamesLookup;for(const[t,i]of this._messageTypeValues)e[i]=t}return this._messageNamesLookup[e]}_getMessageTypeValue(e){var t;if(!this._reverseMsgClassesLookup){const e=this._reverseMsgClassesLookup;for(const t of this._messageClasses)e.set(t,(new t).type)}return null!==(t=this._reverseMsgClassesLookup.get(e))&&void 0!==t?t:0}_getMessageClass(e){if(!this._messageClassesLookup.size){const e=this._messageClassesLookup;for(const t of this._messageClasses)e.set((new t).type,t)}return this._messageClassesLookup.get(e)}_checkGetMessageTypeValue(e){const t=this._messageTypeValues.get(e);return(0,n.vA)(t,`No Pixel message type value for ${e}`),t}}const g={ok:(0,n.$9)(0),low:(0,n.$9)(),charging:(0,n.$9)(),done:(0,n.$9)(),badCharging:(0,n.$9)(),error:(0,n.$9)()},v={unknown:(0,n.$9)(0),nRF52810:(0,n.$9)()},b={off:(0,n.$9)(0),once:(0,n.$9)(),automatic:(0,n.$9)()};var w=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};const T={none:(0,n.$9)(0),whoAreYou:(0,n.$9)(),iAmALCC:(0,n.$9)(),bulkSetup:(0,n.$9)(),bulkSetupAck:(0,n.$9)(),bulkData:(0,n.$9)(),bulkDataAck:(0,n.$9)(),transferSettings:(0,n.$9)(),transferSettingsAck:(0,n.$9)(),transferSettingsFinished:(0,n.$9)(),debugLog:(0,n.$9)(),requestSettings:(0,n.$9)(),blink:(0,n.$9)(),blinkAck:(0,n.$9)(),requestBatteryLevel:(0,n.$9)(),batteryLevel:(0,n.$9)(),requestRssi:(0,n.$9)(),rssi:(0,n.$9)(),notifyUser:(0,n.$9)(),notifyUserAck:(0,n.$9)(),programDefaultParameters:(0,n.$9)(),programDefaultParametersFinished:(0,n.$9)(),setName:(0,n.$9)(),setNameAck:(0,n.$9)(),requestTemperature:(0,n.$9)(),temperature:(0,n.$9)(),testBulkSend:(0,n.$9)(),testBulkReceive:(0,n.$9)(),attractMode:(0,n.$9)(),printA2DReadings:(0,n.$9)(),printAnimationControllerState:(0,n.$9)()};class _{constructor(){this.chunkSize=(0,n.bE)(this),this.firmwareVersion=0,this.buildTimestamp=0,this.settingsVersion=0,this.compatStandardApiVersion=0,this.compatExtendedApiVersion=0,this.compatManagementApiVersion=0}}w([(0,n.sU)(1)],_.prototype,"chunkSize",void 0),w([(0,n.sU)(2)],_.prototype,"firmwareVersion",void 0),w([(0,n.sU)(4)],_.prototype,"buildTimestamp",void 0),w([(0,n.sU)(2)],_.prototype,"settingsVersion",void 0),w([(0,n.sU)(2)],_.prototype,"compatStandardApiVersion",void 0),w([(0,n.sU)(2)],_.prototype,"compatExtendedApiVersion",void 0),w([(0,n.sU)(2)],_.prototype,"compatManagementApiVersion",void 0);class k{constructor(){this.chunkSize=(0,n.bE)(this),this.pixelId=0,this.chipModel=v.unknown,this.ledCount=0}}w([(0,n.sU)(1)],k.prototype,"chunkSize",void 0),w([(0,n.sU)(4)],k.prototype,"pixelId",void 0),w([(0,n.sU)(1)],k.prototype,"chipModel",void 0),w([(0,n.sU)(1)],k.prototype,"ledCount",void 0);class C{constructor(){this.chunkSize=0,this.name=""}}w([(0,n.sU)(1)],C.prototype,"chunkSize",void 0),w([(0,n.sU)(0,{terminator:!0})],C.prototype,"name",void 0);class x{constructor(){this.chunkSize=(0,n.bE)(this),this.availableFlash=0,this.totalUsableFlash=0}}w([(0,n.sU)(1)],x.prototype,"chunkSize",void 0),w([(0,n.sU)(4)],x.prototype,"availableFlash",void 0),w([(0,n.sU)(4)],x.prototype,"totalUsableFlash",void 0);class U{constructor(){this.chunkSize=(0,n.bE)(this),this.batteryLevelPercent=0,this.batteryState=g.ok}}w([(0,n.sU)(1)],U.prototype,"chunkSize",void 0),w([(0,n.sU)(1)],U.prototype,"batteryLevelPercent",void 0),w([(0,n.sU)(1)],U.prototype,"batteryState",void 0);class A{constructor(){this.type=T.iAmALCC,this.versionInfo=new _,this.chargerInfo=new k,this.dieName=new C,this.settingsInfo=new x,this.statusInfo=new U}}w([(0,n.sU)(1)],A.prototype,"type",void 0);class S{constructor(){this.type=T.iAmALCC,this.ledCount=0,this.dataSetHash=0,this.pixelId=0,this.availableFlashSize=0,this.buildTimestamp=0,this.batteryLevelPercent=0,this.batteryState=g.ok}}S.expectedSize=20,w([(0,n.sU)(1)],S.prototype,"type",void 0),w([(0,n.sU)(1,{padding:2})],S.prototype,"ledCount",void 0),w([(0,n.sU)(4)],S.prototype,"dataSetHash",void 0),w([(0,n.sU)(4)],S.prototype,"pixelId",void 0),w([(0,n.sU)(2)],S.prototype,"availableFlashSize",void 0),w([(0,n.sU)(4)],S.prototype,"buildTimestamp",void 0),w([(0,n.sU)(1)],S.prototype,"batteryLevelPercent",void 0),w([(0,n.sU)(1)],S.prototype,"batteryState",void 0);class P{constructor(){this.type=T.bulkSetup,this.size=0}}w([(0,n.sU)(1)],P.prototype,"type",void 0),w([(0,n.sU)(2)],P.prototype,"size",void 0);class M{constructor(){this.type=T.bulkData,this.size=0,this.offset=0}}w([(0,n.sU)(1)],M.prototype,"type",void 0),w([(0,n.sU)(1)],M.prototype,"size",void 0),w([(0,n.sU)(2)],M.prototype,"offset",void 0),w([(0,n.sU)(f.maxMessageSize)],M.prototype,"data",void 0);class O{constructor(){this.type=T.bulkDataAck,this.offset=0}}w([(0,n.sU)(1)],O.prototype,"type",void 0),w([(0,n.sU)(2)],O.prototype,"offset",void 0);class ${constructor(){this.type=T.debugLog,this.message=""}}w([(0,n.sU)(1)],$.prototype,"type",void 0),w([(0,n.sU)(0,{terminator:!0})],$.prototype,"message",void 0);class I{constructor(){this.type=T.blink,this.count=0,this.duration=0,this.color=0,this.faceMask=h.AnimConstants.faceMaskAll,this.fade=0,this.loopCount=1}}w([(0,n.sU)(1)],I.prototype,"type",void 0),w([(0,n.sU)(1)],I.prototype,"count",void 0),w([(0,n.sU)(2)],I.prototype,"duration",void 0),w([(0,n.sU)(4)],I.prototype,"color",void 0),w([(0,n.sU)(4)],I.prototype,"faceMask",void 0),w([(0,n.sU)(1)],I.prototype,"fade",void 0),w([(0,n.sU)(1)],I.prototype,"loopCount",void 0);class E{constructor(){this.type=T.batteryLevel,this.levelPercent=0,this.state=g.ok}}w([(0,n.sU)(1)],E.prototype,"type",void 0),w([(0,n.sU)(1)],E.prototype,"levelPercent",void 0),w([(0,n.sU)(1)],E.prototype,"state",void 0);class D{constructor(){this.type=T.requestRssi,this.requestMode=b.off,this.minInterval=0}}w([(0,n.sU)(1)],D.prototype,"type",void 0),w([(0,n.sU)(1)],D.prototype,"requestMode",void 0),w([(0,n.sU)(2)],D.prototype,"minInterval",void 0);class F{constructor(){this.type=T.rssi,this.value=0}}w([(0,n.sU)(1)],F.prototype,"type",void 0),w([(0,n.sU)(1,{numberFormat:"signed"})],F.prototype,"value",void 0);class z{constructor(){this.type=T.notifyUser,this.timeoutSec=0,this.ok=!1,this.cancel=!1,this.message=""}}w([(0,n.sU)(1)],z.prototype,"type",void 0),w([(0,n.sU)(1)],z.prototype,"timeoutSec",void 0),w([(0,n.sU)(1)],z.prototype,"ok",void 0),w([(0,n.sU)(1)],z.prototype,"cancel",void 0),w([(0,n.sU)(f.maxMessageSize-4)],z.prototype,"message",void 0);class L{constructor(){this.type=T.notifyUserAck,this.okCancel=!1}}w([(0,n.sU)(1)],L.prototype,"type",void 0),w([(0,n.sU)(1)],L.prototype,"okCancel",void 0);class R{constructor(){this.type=T.setName,this.name=""}}w([(0,n.sU)(1)],R.prototype,"type",void 0),w([(0,n.sU)(f.maxNameByteSize+1)],R.prototype,"name",void 0);class j{constructor(){this.type=T.temperature,this.mcuTemperatureTimes100=0,this.batteryTemperatureTimes100=0}}w([(0,n.sU)(1)],j.prototype,"type",void 0),w([(0,n.sU)(2)],j.prototype,"mcuTemperatureTimes100",void 0),w([(0,n.sU)(2)],j.prototype,"batteryTemperatureTimes100",void 0);const V=new m(Object.entries(T),[S,P,M,O,$,I,E,D,F,z,L,R,j]);function B(e,t,i){(0,n.vA)(e.getUint8(0)===t.type,`Unexpected message type, got ${e.getUint8(0)} instead of ${t.type}`);let r=1;for(const[s,o]of Object.entries(t))if("type"!==s){(0,n.vA)("object"==typeof o&&"chunkSize"in o);const a=e.getUint8(r);i&&o.chunkSize>0&&a!==o.chunkSize&&i(`In message of type ${t.type}, got '${s}' chunk of size ${a} but expected ${o.chunkSize} bytes`),(0,n.iu)(o,new DataView(e.buffer,e.byteOffset+r,0===o.chunkSize?a:Math.min(a,o.chunkSize)),{allowSkipLastProps:!0}),r+=a}}var N=i(46);class K{constructor(){this._infoEvEmitter=(0,n.pI)(),this.isNotifier=!0,this._infoEvEmitter.setMaxListeners(50)}addPropertyListener(e,t){this._infoEvEmitter.addListener(e,t)}removePropertyListener(e,t){this._infoEvEmitter.removeListener(e,t)}emitPropertyEvent(e){try{this._infoEvEmitter.emit(e,this)}catch(t){console.error(`PixelInfoNotifier: Uncaught error in "${e}" event listener: ${t}`)}}}K.MutablePropsList=["name","ledCount","colorway","dieType","firmwareDate","rssi","batteryLevel","isCharging","rollState","currentFace","currentFaceIndex"];class W extends Error{constructor(e,t,i){const r=i&&i.code;r&&(t+=` (${r})`),super(`Pixel ${e.name}: ${t}`),this.name="PixelError",this.pixel=e,this.description=t,this.cause=i}}class q extends W{constructor(e,t){const i=t instanceof Error;super(e,"string"==typeof t?t:i&&t instanceof W?`Connection error, ${t.description}`:i?`Connection error, ${t.message}`:`Unknown connection error, ${JSON.stringify(t)}`,i?t:void 0),this.name="PixelConnectError"}}class G extends q{constructor(e,t){super(e,`Connection timeout after ${t} ms`),this.name="PixelConnectTimeoutError"}}class H extends q{constructor(e){super(e,`Connection cancelled (status was ${e.status})`),this.name="PixelConnectCancelledError"}}class Y extends q{constructor(e,t){super(e,"Identification mismatch, expecting "+(0,n.Vl)(e.pixelId)+" but got "+(0,n.Vl)(t)),this.name="PixelIdMismatchError"}}class Z extends W{constructor(e,t,i){super(e,`Timeout of ${t}ms waiting for message ${i}`),this.name="PixelMessageTimeoutError"}}class J extends W{constructor(e,t){super(e,`Disconnected while waiting for message ${t}`),this.name="PixelMessageConnectStatusError"}}class X extends W{constructor(e,t,i,r,n){super(e,`Message ${t} cannot be send, firmware ${"firmware"===n?"compat. ":""} API version is ${r} but library ${"library"===n?"compat. ":""} API version is ${i}`),this.name="PixelConnectIncompatibleFirmwareError"}}class Q extends W{constructor(e){super(e,"New Pixel name must have at least one character"),this.name="PixelEmptyNameError"}}class ee extends W{constructor(e,t,i){super(e,t,i),this.name="PixelTransferError"}}class te extends ee{constructor(e){super(e,"A data transfer is already in progress"),this.name="PixelTransferInProgressError"}}class ie extends ee{constructor(e){super(e,"Invalid data to transfer"),this.name="PixelTransferInvalidDataError"}}class re extends ee{constructor(e,t){super(e,`Timeout waiting on device to confirm completed data transfer with ${t} message`),this.name="PixelTransferAckTimeoutError"}}class ne extends ee{constructor(e,t){super(e,`Not enough memory on die to store ${t} bytes`),this.name="PixelTransferOutOfMemoryError"}}class se extends K{get logMessages(){return this._logMessages}set logMessages(e){this._logMessages=e}get logMessagesSerializedData(){return this._logData}set logMessagesSerializedData(e){this._logData=e}get logger(){return this._logFunc}set logger(e){this._logFunc=e}get status(){return this._status}get sessionDeviceName(){return this._session.pixelName}constructor(e,t){super(),this._msgEvEmitter=new N.EventEmitter,this._logMessages=!1,this._logData=!1,this._serializer=e,this._session=t,this._status="disconnected",t.setConnectionEventListener((({status:e,reason:t})=>{"connected"===e||"ready"===e?this._updateStatus("connecting"):this._updateStatus("failedToConnect"===e?"disconnected":e,t)}))}_dispose(){this._internalDispose(),this._session.dispose()}addMessageListener(e,t){this._msgEvEmitter.addListener(`${e}Message`,t)}removeMessageListener(e,t){this._msgEvEmitter.removeListener(`${e}Message`,t)}async _internalConnect(e=0){try{if(await this._session.connect(e),"connecting"===this.status){this._updateStatus("identifying");try{await this._session.subscribe((e=>this._onValueChanged(e))),await this._internalSetup(),"identifying"===this.status&&this._updateStatus("ready")}catch(e){try{this._warn(`Disconnecting after getting error: ${e}`),await this._session.disconnect()}catch(e){}throw e}}else"identifying"===this.status&&await new Promise((e=>{const t=({status:i})=>{"identifying"!==i&&(this.removePropertyListener("status",t),e())};this.addPropertyListener("status",t)}));if("ready"!==this.status)throw new H(this)}catch(t){const i=null==t?void 0:t.message;throw"string"==typeof i&&i.startsWith("Connection timeout")?new G(this,e):t instanceof q?t:new q(this,t)}}async _internalDisconnect(){await this._session.disconnect()}_onValueChanged(e){try{this._logData&&this._logArray(e.buffer);const t=this._internalDeserializeMessage(e),i=this._serializer.getMessageType(t);this._logMessages&&"rssi"!==i&&"batteryLevel"!==i&&(this._log(`Received message ${i} (${this._serializer.getMessageTypeValue(i)})`),"object"==typeof t&&this._log(t)),this._msgEvEmitter.emit(`${i}Message`,t)}catch(e){this._warn(`Message deserialization error: ${e}`)}}_internalWaitForMessage(e,t=f.ackMessageTimeout){return new Promise(((i,r)=>{let n;const s=e=>{n(),i(e)};this.addMessageListener(e,s);const o=({status:t})=>{"disconnecting"!==t&&"disconnected"!==t||(n(),r(new J(this,e)))};let a;this.addPropertyListener("status",o),a=setTimeout((()=>{a=void 0,n(),r(new Z(this,t,e))}),t),n=()=>{a&&clearTimeout(a),this.removeMessageListener(e,s),this.removePropertyListener("status",o)}}))}async _internalSendMessage(e,t=!1){const i=this._serializer.serialize(e);if(this._logMessages){const t=this._serializer.getMessageType(e);this._log(`Sending message ${t} (${this._serializer.getMessageTypeValue(t)})`)}this._logData&&this._logArray(i),await this._session.writeValue(i,t)}async _internalSendAndWaitForResponse(e,t,i=f.ackMessageTimeout){return(await Promise.all([this._internalWaitForMessage(t,i),this._internalSendMessage(e)]))[0]}async _internalSendAndWaitForTypedResponse(e,t,i=f.ackMessageTimeout){return await this._internalSendAndWaitForResponse(e,this._serializer.getMessageType((new t).type),i)}_updateStatus(e,t){if(e!==this._status){const i=this._status;this._status=e,this._log(`Status changed to ${e} with reason: ${t}`),this._onStatusChanged({status:e,lastStatus:i,reason:t}),this.emitPropertyEvent("status")}}_tagLogString(e){const t=(0,n.Vl)(this.pixelId);return`[${this.name} (${t})] ${e}`}_log(e){var t;null===(t=this._logFunc)||void 0===t||t.call(this,this._tagLogString((null==e?void 0:e.type)?JSON.stringify(e):String(e)))}_warn(e){var t;null===(t=this._logFunc)||void 0===t||t.call(this,this._tagLogString("WARN: "+((null==e?void 0:e.type)?JSON.stringify(e):String(e))))}_logArray(e){this._logFunc&&this._logFunc(this._tagLogString(`${[...new Uint8Array(e)].map((e=>(e>>>0).toString(16).padStart(2,"0"))).join(":")}`))}}function oe(e){return e===g.charging||e===g.done}class ae extends se{get systemId(){return this._info.systemId}get pixelId(){return this._info.pixelId}get name(){var e;return this._info.name.length?this._info.name:null!==(e=this.sessionDeviceName)&&void 0!==e?e:""}get ledCount(){return this._info.ledCount}get colorway(){return"unknown"}get dieType(){return"unknown"}get firmwareDate(){return this._info.firmwareDate}get rssi(){return this._info.rssi}get batteryLevel(){return this._info.batteryLevel}get isCharging(){return this._info.isCharging}get rollState(){return"unknown"}get currentFace(){return 0}get currentFaceIndex(){return 0}constructor(e,t){var i,r,s;super(V,e),this._evEmitter=(0,n.pI)(),this.type="charger",this._info={systemId:e.systemId,pixelId:null!==(i=null==t?void 0:t.pixelId)&&void 0!==i?i:0,name:"",ledCount:null!==(r=null==t?void 0:t.ledCount)&&void 0!==r?r:0,colorway:"unknown",dieType:"unknown",firmwareDate:null!==(s=null==t?void 0:t.firmwareDate)&&void 0!==s?s:new Date(0),rssi:0,batteryLevel:0,isCharging:!1,rollState:"unknown",currentFace:0,currentFaceIndex:0},this._versions={firmwareVersion:0,settingsVersion:0,compatStandardApiVersion:0,compatExtendedApiVersion:0,compatManagementApiVersion:0};const o=({status:e})=>{"ready"===e&&this._emitEvent("battery",{level:this._info.batteryLevel,isCharging:this._info.isCharging})};this.addPropertyListener("status",o);const a=e=>{this._updateRssi(e.value)};this.addMessageListener("rssi",a);const c=e=>{const t=e;this._updateBattery(t.levelPercent,oe(t.state))};this.addMessageListener("batteryLevel",c);const l=()=>{this._updateName(u("charger",this._info.pixelId))};this.addMessageListener("programDefaultParametersFinished",l),this._disposeFunc=()=>{this.removePropertyListener("status",o),this.removeMessageListener("rssi",a),this.removeMessageListener("batteryLevel",c),this.removeMessageListener("programDefaultParametersFinished",l)}}_internalDispose(){this._disposeFunc()}updateInfo(e){"disconnected"===this.status&&this.pixelId===e.pixelId&&(e.name&&this._updateName(e.name),e.ledCount&&e.ledCount>0&&!this.ledCount&&this._updateLedCount(e.ledCount),e.firmwareDate&&e.firmwareDate.getTime()>0&&this._updateFirmwareDate(e.firmwareDate.getTime()),void 0!==e.rssi&&e.rssi<0&&this._updateRssi(e.rssi),(void 0===e.batteryLevel||e.batteryLevel>=0&&e.batteryLevel<=100)&&this._updateBattery(e.batteryLevel,e.isCharging))}async connect(e=0){return await this._internalConnect(e),this}async disconnect(){return await this._internalDisconnect(),this}addEventListener(e,t){this._evEmitter.addListener(e,t)}removeEventListener(e,t){this._evEmitter.removeListener(e,t)}async sendMessage(e,t=!1){const i=this._versions.firmwareVersion;if(i>0&&f.compatApiVersion>i)throw new X(this,this._serializer.getMessageType(e),f.compatApiVersion,i,"library");const r=this._versions.compatStandardApiVersion;if(r>0&&f.apiVersion<r)throw new X(this,this._serializer.getMessageType(e),f.apiVersion,r,"firmware");await this._internalSendMessage(e,t),this._emitEvent("messageSend",e)}async sendAndWaitForResponse(e,t,i=f.ackMessageTimeout){return await this._internalSendAndWaitForResponse(e,t,i)}async sendAndWaitForTypedResponse(e,t,i=f.ackMessageTimeout){return await this._internalSendAndWaitForTypedResponse(e,t,i)}async rename(e){if(!e.length)throw new Q(this);await this.sendAndWaitForResponse((0,n.rV)(new R,{name:e}),"setNameAck"),this._updateName(e)}async reportRssi(e,t=5e3){await this.sendMessage((0,n.rV)(new D,{requestMode:e?b.automatic:b.off,minInterval:t}))}async queryRssi(){return(await this.sendAndWaitForResponse((0,n.rV)(new D,{requestMode:b.once}),"rssi")).value}async blink(e,t){var i,r,s,o,a;const c=(0,n.rV)(new I,{color:h.Color32Utils.toColor32(e),count:null!==(i=null==t?void 0:t.count)&&void 0!==i?i:1,duration:null!==(r=null==t?void 0:t.duration)&&void 0!==r?r:1e3,fade:255*(null!==(s=null==t?void 0:t.fade)&&void 0!==s?s:0),faceMask:null!==(o=null==t?void 0:t.faceMask)&&void 0!==o?o:h.AnimConstants.faceMaskAll,loopCount:null!==(a=null==t?void 0:t.loopCount)&&void 0!==a?a:1});await this.sendAndWaitForResponse(c,"blinkAck")}_onStatusChanged(e){this._emitEvent("statusChanged",e)}async _internalSetup(){var e,t;let i;for(i in this._versions)this._versions[i]=0;this._log("Waiting on identification message");const r=await this.sendAndWaitForResponse("whoAreYou","iAmALCC"),n=null!==(e=r.pixelId)&&void 0!==e?e:null===(t=r.chargerInfo)||void 0===t?void 0:t.pixelId;if(!n){const e=r.ledCount;throw console.log("ledCount="+e),new q(this,"Got an empty Pixel id")}if(this._info.pixelId){if(this._info.pixelId!==n)throw new Y(this,n)}else this._info.pixelId=n,this.emitPropertyEvent("pixelId");const s=e=>{this._updateLedCount(e.ledCount),this._updateFirmwareDate(1e3*e.buildTimestamp),this._updateBattery(e.batteryLevelPercent,oe(e.batteryState))};if(r instanceof S){s(r);const e=256;this._versions.firmwareVersion=e,this._versions.settingsVersion=e,this._versions.compatStandardApiVersion=e,this._versions.compatExtendedApiVersion=e,this._versions.compatManagementApiVersion=e}else{for(i in s(Object.assign(Object.assign(Object.assign({},r.chargerInfo),r.versionInfo),r.statusInfo)),this._versions)this._versions[i]=r.versionInfo[i];this._updateName(r.dieName.name)}}_internalDeserializeMessage(e){let t;if(e.byteLength&&e.getUint8(0)===T.iAmALCC&&e.byteLength!==S.expectedSize){const i=new A;B(e,i,(e=>this._warn(e))),t=i}else t=this._serializer.deserializeMessage(e);return t&&this._emitEvent("messageReceived",t),t}_emitEvent(e,t){try{this._evEmitter.emit(e,t)}catch(t){console.error(this._tagLogString(`Uncaught error in "${e}" event listener: ${t}`))}}_updateName(e){e.length&&e!==this._info.name&&(this._info.name=e,this.emitPropertyEvent("name"))}_updateLedCount(e){this._info.ledCount!==e&&(this._info.ledCount=e,this.emitPropertyEvent("ledCount"))}_updateFirmwareDate(e){e&&e!==this._info.firmwareDate.getTime()&&(this._info.firmwareDate=new Date(e),this.emitPropertyEvent("firmwareDate"))}_updateRssi(e){e&&e!==this._info.rssi&&(this._info.rssi=e,this.emitPropertyEvent("rssi"))}_updateBattery(e,t){const i=void 0!==e&&this._info.batteryLevel!==e,r=void 0!==t&&this._info.isCharging!==t;i&&(this._info.batteryLevel=e,this.emitPropertyEvent("batteryLevel")),r&&(this._info.isCharging=t,this.emitPropertyEvent("isCharging")),(i||r)&&this._emitEvent("battery",{level:null!=e?e:this.batteryLevel,isCharging:null!=t?t:this.isCharging})}}const ce={unknown:(0,n.$9)(0),ok:(0,n.$9)(),empty:(0,n.$9)(),low:(0,n.$9)(),transitionOn:(0,n.$9)(),transitionOff:(0,n.$9)(),badCharging:(0,n.$9)(),error:(0,n.$9)(),chargingLow:(0,n.$9)(),charging:(0,n.$9)(),cooldown:(0,n.$9)(),trickle:(0,n.$9)(),done:(0,n.$9)(),lowTemp:(0,n.$9)(),highTemp:(0,n.$9)()},le={unknown:(0,n.$9)(0),rolled:(0,n.$9)(),handling:(0,n.$9)(),rolling:(0,n.$9)(),crooked:(0,n.$9)(),onFace:(0,n.$9)()};var ue=function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};const de={none:(0,n.$9)(0),whoAreYou:(0,n.$9)(),iAmADie:(0,n.$9)(),rollState:(0,n.$9)(),telemetry:(0,n.$9)(),bulkSetup:(0,n.$9)(),bulkSetupAck:(0,n.$9)(),bulkData:(0,n.$9)(),bulkDataAck:(0,n.$9)(),transferAnimationSet:(0,n.$9)(),transferAnimationSetAck:(0,n.$9)(),transferAnimationSetFinished:(0,n.$9)(),transferSettings:(0,n.$9)(),transferSettingsAck:(0,n.$9)(),transferSettingsFinished:(0,n.$9)(),transferTestAnimationSet:(0,n.$9)(),transferTestAnimationSetAck:(0,n.$9)(),transferTestAnimationSetFinished:(0,n.$9)(),debugLog:(0,n.$9)(),playAnimation:(0,n.$9)(),playAnimationEvent:(0,n.$9)(),stopAnimation:(0,n.$9)(),remoteAction:(0,n.$9)(),requestRollState:(0,n.$9)(),requestAnimationSet:(0,n.$9)(),requestSettings:(0,n.$9)(),requestTelemetry:(0,n.$9)(),programDefaultAnimationSet:(0,n.$9)(),programDefaultAnimationSetFinished:(0,n.$9)(),blink:(0,n.$9)(),blinkAck:(0,n.$9)(),requestDefaultAnimationSetColor:(0,n.$9)(),defaultAnimationSetColor:(0,n.$9)(),requestBatteryLevel:(0,n.$9)(),batteryLevel:(0,n.$9)(),requestRssi:(0,n.$9)(),rssi:(0,n.$9)(),calibrate:(0,n.$9)(),calibrateFace:(0,n.$9)(),notifyUser:(0,n.$9)(),notifyUserAck:(0,n.$9)(),testHardware:(0,n.$9)(),storeValue:(0,n.$9)(),storeValueAck:(0,n.$9)(),setTopLevelState:(0,n.$9)(),programDefaultParameters:(0,n.$9)(),programDefaultParametersFinished:(0,n.$9)(),setDesignAndColor:(0,n.$9)(),setDesignAndColorAck:(0,n.$9)(),setCurrentBehavior:(0,n.$9)(),setCurrentBehaviorAck:(0,n.$9)(),setName:(0,n.$9)(),setNameAck:(0,n.$9)(),powerOperation:(0,n.$9)(),exitValidation:(0,n.$9)(),transferInstantAnimationSet:(0,n.$9)(),transferInstantAnimationSetAck:(0,n.$9)(),transferInstantAnimationSetFinished:(0,n.$9)(),playInstantAnimation:(0,n.$9)(),stopAllAnimations:(0,n.$9)(),requestTemperature:(0,n.$9)(),temperature:(0,n.$9)(),setBatteryControllerMode:(0,n.$9)(),_unused:(0,n.$9)(),discharge:(0,n.$9)(),blinkId:(0,n.$9)(),blinkIdAck:(0,n.$9)(),transferTest:(0,n.$9)(),transferTestAck:(0,n.$9)(),transferTestFinished:(0,n.$9)(),clearSettings:(0,n.$9)(),clearSettingsAck:(0,n.$9)(),testBulkSend:(0,n.$9)(),testBulkReceive:(0,n.$9)(),setAllLEDsToColor:(0,n.$9)(),attractMode:(0,n.$9)(),printNormals:(0,n.$9)(),printA2DReadings:(0,n.$9)(),lightUpFace:(0,n.$9)(),setLEDToColor:(0,n.$9)(),printAnimationControllerState:(0,n.$9)()};class pe{constructor(){this.chunkSize=(0,n.bE)(this),this.firmwareVersion=0,this.buildTimestamp=0,this.settingsVersion=0,this.compatStandardApiVersion=0,this.compatExtendedApiVersion=0,this.compatManagementApiVersion=0}}ue([(0,n.sU)(1)],pe.prototype,"chunkSize",void 0),ue([(0,n.sU)(2)],pe.prototype,"firmwareVersion",void 0),ue([(0,n.sU)(4)],pe.prototype,"buildTimestamp",void 0),ue([(0,n.sU)(2)],pe.prototype,"settingsVersion",void 0),ue([(0,n.sU)(2)],pe.prototype,"compatStandardApiVersion",void 0),ue([(0,n.sU)(2)],pe.prototype,"compatExtendedApiVersion",void 0),ue([(0,n.sU)(2)],pe.prototype,"compatManagementApiVersion",void 0);class he{constructor(){this.chunkSize=(0,n.bE)(this),this.pixelId=0,this.chipModel=v.unknown,this.dieType=h.PixelDieTypeValues.unknown,this.ledCount=0,this.colorway=h.PixelColorwayValues.unknown}}ue([(0,n.sU)(1)],he.prototype,"chunkSize",void 0),ue([(0,n.sU)(4)],he.prototype,"pixelId",void 0),ue([(0,n.sU)(1)],he.prototype,"chipModel",void 0),ue([(0,n.sU)(1)],he.prototype,"dieType",void 0),ue([(0,n.sU)(1)],he.prototype,"ledCount",void 0),ue([(0,n.sU)(1)],he.prototype,"colorway",void 0);class fe{constructor(){this.chunkSize=0,this.name=""}}ue([(0,n.sU)(1)],fe.prototype,"chunkSize",void 0),ue([(0,n.sU)(0,{terminator:!0})],fe.prototype,"name",void 0);class ye{constructor(){this.chunkSize=0,this.name=""}}ue([(0,n.sU)(1)],ye.prototype,"chunkSize",void 0),ue([(0,n.sU)(0,{terminator:!0})],ye.prototype,"name",void 0);class me{constructor(){this.chunkSize=(0,n.bE)(this),this.profileDataHash=0,this.availableFlash=0,this.totalUsableFlash=0}}ue([(0,n.sU)(1)],me.prototype,"chunkSize",void 0),ue([(0,n.sU)(4)],me.prototype,"profileDataHash",void 0),ue([(0,n.sU)(4)],me.prototype,"availableFlash",void 0),ue([(0,n.sU)(4)],me.prototype,"totalUsableFlash",void 0);class ge{constructor(){this.chunkSize=(0,n.bE)(this),this.batteryLevelPercent=0,this.batteryState=g.ok,this.rollState=le.unknown,this.currentFaceIndex=0}}ue([(0,n.sU)(1)],ge.prototype,"chunkSize",void 0),ue([(0,n.sU)(1)],ge.prototype,"batteryLevelPercent",void 0),ue([(0,n.sU)(1)],ge.prototype,"batteryState",void 0),ue([(0,n.sU)(1)],ge.prototype,"rollState",void 0),ue([(0,n.sU)(1)],ge.prototype,"currentFaceIndex",void 0);class ve{constructor(){this.type=de.iAmADie,this.versionInfo=new pe,this.dieInfo=new he,this.customDesignAndColorName=new fe,this.dieName=new ye,this.settingsInfo=new me,this.statusInfo=new ge}}ue([(0,n.sU)(1)],ve.prototype,"type",void 0);class be{constructor(){this.type=de.iAmADie,this.ledCount=0,this.colorway=h.PixelColorwayValues.unknown,this.dieType=h.PixelDieTypeValues.unknown,this.dataSetHash=0,this.pixelId=0,this.availableFlashSize=0,this.buildTimestamp=0,this.rollState=le.unknown,this.currentFaceIndex=0,this.batteryLevelPercent=0,this.batteryState=g.ok}}be.expectedSize=22,ue([(0,n.sU)(1)],be.prototype,"type",void 0),ue([(0,n.sU)(1)],be.prototype,"ledCount",void 0),ue([(0,n.sU)(1)],be.prototype,"colorway",void 0),ue([(0,n.sU)(1)],be.prototype,"dieType",void 0),ue([(0,n.sU)(4)],be.prototype,"dataSetHash",void 0),ue([(0,n.sU)(4)],be.prototype,"pixelId",void 0),ue([(0,n.sU)(2)],be.prototype,"availableFlashSize",void 0),ue([(0,n.sU)(4)],be.prototype,"buildTimestamp",void 0),ue([(0,n.sU)(1)],be.prototype,"rollState",void 0),ue([(0,n.sU)(1)],be.prototype,"currentFaceIndex",void 0),ue([(0,n.sU)(1)],be.prototype,"batteryLevelPercent",void 0),ue([(0,n.sU)(1)],be.prototype,"batteryState",void 0);class we{constructor(){this.type=de.rollState,this.state=le.unknown,this.faceIndex=0}}ue([(0,n.sU)(1)],we.prototype,"type",void 0),ue([(0,n.sU)(1)],we.prototype,"state",void 0),ue([(0,n.sU)(1)],we.prototype,"faceIndex",void 0);const Te={default:(0,n.$9)(0),forceDisableCharging:(0,n.$9)(),forceEnableCharging:(0,n.$9)()};class _e{constructor(){this.type=de.telemetry,this.accXTimes1000=0,this.accYTimes1000=0,this.accZTimes1000=0,this.faceConfidenceTimes1000=0,this.timeMs=0,this.rollState=le.unknown,this.faceIndex=0,this.batteryLevelPercent=0,this.batteryState=g.ok,this.batteryControllerState=ce.ok,this.voltageTimes50=0,this.vCoilTimes50=0,this.rssi=0,this.channelIndex=0,this.mcuTemperatureTimes100=0,this.batteryTemperatureTimes100=0,this.internalChargeState=!1,this.batteryControllerMode=Te.default,this.ledCurrent=0}}ue([(0,n.sU)(1)],_e.prototype,"type",void 0),ue([(0,n.sU)(2,{numberFormat:"signed"})],_e.prototype,"accXTimes1000",void 0),ue([(0,n.sU)(2,{numberFormat:"signed"})],_e.prototype,"accYTimes1000",void 0),ue([(0,n.sU)(2,{numberFormat:"signed"})],_e.prototype,"accZTimes1000",void 0),ue([(0,n.sU)(4,{numberFormat:"signed"})],_e.prototype,"faceConfidenceTimes1000",void 0),ue([(0,n.sU)(4)],_e.prototype,"timeMs",void 0),ue([(0,n.sU)(1)],_e.prototype,"rollState",void 0),ue([(0,n.sU)(1)],_e.prototype,"faceIndex",void 0),ue([(0,n.sU)(1)],_e.prototype,"batteryLevelPercent",void 0),ue([(0,n.sU)(1)],_e.prototype,"batteryState",void 0),ue([(0,n.sU)(1)],_e.prototype,"batteryControllerState",void 0),ue([(0,n.sU)(1)],_e.prototype,"voltageTimes50",void 0),ue([(0,n.sU)(1)],_e.prototype,"vCoilTimes50",void 0),ue([(0,n.sU)(1,{numberFormat:"signed"})],_e.prototype,"rssi",void 0),ue([(0,n.sU)(1)],_e.prototype,"channelIndex",void 0),ue([(0,n.sU)(2)],_e.prototype,"mcuTemperatureTimes100",void 0),ue([(0,n.sU)(2)],_e.prototype,"batteryTemperatureTimes100",void 0),ue([(0,n.sU)(1)],_e.prototype,"internalChargeState",void 0),ue([(0,n.sU)(1)],_e.prototype,"batteryControllerMode",void 0),ue([(0,n.sU)(1)],_e.prototype,"ledCurrent",void 0);class ke{constructor(){this.type=de.bulkSetup,this.size=0}}ue([(0,n.sU)(1)],ke.prototype,"type",void 0),ue([(0,n.sU)(2)],ke.prototype,"size",void 0);class Ce{constructor(){this.type=de.bulkData,this.size=0,this.offset=0}}ue([(0,n.sU)(1)],Ce.prototype,"type",void 0),ue([(0,n.sU)(1)],Ce.prototype,"size",void 0),ue([(0,n.sU)(2)],Ce.prototype,"offset",void 0),ue([(0,n.sU)(f.maxMessageSize)],Ce.prototype,"data",void 0);class xe{constructor(){this.type=de.bulkDataAck,this.offset=0}}ue([(0,n.sU)(1)],xe.prototype,"type",void 0),ue([(0,n.sU)(2)],xe.prototype,"offset",void 0);class Ue{constructor(){this.type=de.transferAnimationSet,this.paletteSize=0,this.rgbKeyFrameCount=0,this.rgbTrackCount=0,this.keyFrameCount=0,this.trackCount=0,this.animationCount=0,this.animationSize=0,this.conditionCount=0,this.conditionSize=0,this.actionCount=0,this.actionSize=0,this.ruleCount=0,this.brightness=0}}ue([(0,n.sU)(1)],Ue.prototype,"type",void 0),ue([(0,n.sU)(2)],Ue.prototype,"paletteSize",void 0),ue([(0,n.sU)(2)],Ue.prototype,"rgbKeyFrameCount",void 0),ue([(0,n.sU)(2)],Ue.prototype,"rgbTrackCount",void 0),ue([(0,n.sU)(2)],Ue.prototype,"keyFrameCount",void 0),ue([(0,n.sU)(2)],Ue.prototype,"trackCount",void 0),ue([(0,n.sU)(2)],Ue.prototype,"animationCount",void 0),ue([(0,n.sU)(2)],Ue.prototype,"animationSize",void 0),ue([(0,n.sU)(2)],Ue.prototype,"conditionCount",void 0),ue([(0,n.sU)(2)],Ue.prototype,"conditionSize",void 0),ue([(0,n.sU)(2)],Ue.prototype,"actionCount",void 0),ue([(0,n.sU)(2)],Ue.prototype,"actionSize",void 0),ue([(0,n.sU)(2)],Ue.prototype,"ruleCount",void 0),ue([(0,n.sU)(1)],Ue.prototype,"brightness",void 0);class Ae{constructor(){this.type=de.transferAnimationSetAck,this.result=0}}ue([(0,n.sU)(1)],Ae.prototype,"type",void 0),ue([(0,n.sU)(1)],Ae.prototype,"result",void 0);class Se{constructor(){this.type=de.transferTestAnimationSet,this.paletteSize=0,this.rgbKeyFrameCount=0,this.rgbTrackCount=0,this.keyFrameCount=0,this.trackCount=0,this.animationCount=0,this.animationSize=0,this.hash=0}}ue([(0,n.sU)(1)],Se.prototype,"type",void 0),ue([(0,n.sU)(2)],Se.prototype,"paletteSize",void 0),ue([(0,n.sU)(2)],Se.prototype,"rgbKeyFrameCount",void 0),ue([(0,n.sU)(2)],Se.prototype,"rgbTrackCount",void 0),ue([(0,n.sU)(2)],Se.prototype,"keyFrameCount",void 0),ue([(0,n.sU)(2)],Se.prototype,"trackCount",void 0),ue([(0,n.sU)(2)],Se.prototype,"animationCount",void 0),ue([(0,n.sU)(2)],Se.prototype,"animationSize",void 0),ue([(0,n.sU)(4)],Se.prototype,"hash",void 0);const Pe={download:(0,n.$9)(0),upToDate:(0,n.$9)(),noMemory:(0,n.$9)()};class Me{constructor(){this.type=de.transferTestAnimationSetAck,this.ackType=Pe.download}}ue([(0,n.sU)(1)],Me.prototype,"type",void 0),ue([(0,n.sU)(1)],Me.prototype,"ackType",void 0);class Oe{constructor(){this.type=de.debugLog,this.message=""}}ue([(0,n.sU)(1)],Oe.prototype,"type",void 0),ue([(0,n.sU)(0,{terminator:!0})],Oe.prototype,"message",void 0);class $e{constructor(){this.type=de.remoteAction,this.actionId=0}}ue([(0,n.sU)(1)],$e.prototype,"type",void 0),ue([(0,n.sU)(2)],$e.prototype,"actionId",void 0);class Ie{constructor(){this.type=de.requestTelemetry,this.requestMode=b.off,this.minInterval=0}}ue([(0,n.sU)(1)],Ie.prototype,"type",void 0),ue([(0,n.sU)(1)],Ie.prototype,"requestMode",void 0),ue([(0,n.sU)(2)],Ie.prototype,"minInterval",void 0);class Ee{constructor(){this.type=de.blink,this.count=0,this.duration=0,this.color=0,this.faceMask=h.AnimConstants.faceMaskAll,this.fade=0,this.loopCount=1}}ue([(0,n.sU)(1)],Ee.prototype,"type",void 0),ue([(0,n.sU)(1)],Ee.prototype,"count",void 0),ue([(0,n.sU)(2)],Ee.prototype,"duration",void 0),ue([(0,n.sU)(4)],Ee.prototype,"color",void 0),ue([(0,n.sU)(4)],Ee.prototype,"faceMask",void 0),ue([(0,n.sU)(1)],Ee.prototype,"fade",void 0),ue([(0,n.sU)(1)],Ee.prototype,"loopCount",void 0);class De{constructor(){this.type=de.batteryLevel,this.levelPercent=0,this.state=g.ok}}ue([(0,n.sU)(1)],De.prototype,"type",void 0),ue([(0,n.sU)(1)],De.prototype,"levelPercent",void 0),ue([(0,n.sU)(1)],De.prototype,"state",void 0);class Fe{constructor(){this.type=de.requestRssi,this.requestMode=b.off,this.minInterval=0}}ue([(0,n.sU)(1)],Fe.prototype,"type",void 0),ue([(0,n.sU)(1)],Fe.prototype,"requestMode",void 0),ue([(0,n.sU)(2)],Fe.prototype,"minInterval",void 0);class ze{constructor(){this.type=de.rssi,this.value=0}}ue([(0,n.sU)(1)],ze.prototype,"type",void 0),ue([(0,n.sU)(1,{numberFormat:"signed"})],ze.prototype,"value",void 0);class Le{constructor(){this.type=de.notifyUser,this.timeoutSec=0,this.ok=!1,this.cancel=!1,this.message=""}}ue([(0,n.sU)(1)],Le.prototype,"type",void 0),ue([(0,n.sU)(1)],Le.prototype,"timeoutSec",void 0),ue([(0,n.sU)(1)],Le.prototype,"ok",void 0),ue([(0,n.sU)(1)],Le.prototype,"cancel",void 0),ue([(0,n.sU)(f.maxMessageSize-4)],Le.prototype,"message",void 0);class Re{constructor(){this.type=de.notifyUserAck,this.okCancel=!1}}ue([(0,n.sU)(1)],Re.prototype,"type",void 0),ue([(0,n.sU)(1)],Re.prototype,"okCancel",void 0);class je{constructor(){this.type=de.storeValue,this.value=0}}ue([(0,n.sU)(1)],je.prototype,"type",void 0),ue([(0,n.sU)(4)],je.prototype,"value",void 0);const Ve={success:(0,n.$9)(0),unknownError:(0,n.$9)(),storeFull:(0,n.$9)(),invalidRange:(0,n.$9)(),notPermitted:(0,n.$9)()};class Be{constructor(){this.type=de.storeValueAck,this.result=0,this.index=Ve.success}}ue([(0,n.sU)(1)],Be.prototype,"type",void 0),ue([(0,n.sU)(1)],Be.prototype,"result",void 0),ue([(0,n.sU)(1)],Be.prototype,"index",void 0);class Ne{constructor(){this.type=de.setDesignAndColor,this.dieType=0,this.colorway=0}}ue([(0,n.sU)(1)],Ne.prototype,"type",void 0),ue([(0,n.sU)(1)],Ne.prototype,"dieType",void 0),ue([(0,n.sU)(1)],Ne.prototype,"colorway",void 0);class Ke{constructor(){this.type=de.setName,this.name=""}}ue([(0,n.sU)(1)],Ke.prototype,"type",void 0),ue([(0,n.sU)(f.maxNameByteSize+1)],Ke.prototype,"name",void 0);const We={turnOff:(0,n.$9)(0),reset:(0,n.$9)(),sleep:(0,n.$9)()};class qe{constructor(){this.type=de.powerOperation,this.operation=We.sleep}}ue([(0,n.sU)(1)],qe.prototype,"type",void 0),ue([(0,n.sU)(1)],qe.prototype,"operation",void 0);class Ge{constructor(){this.type=de.transferInstantAnimationSet,this.paletteSize=0,this.rgbKeyFrameCount=0,this.rgbTrackCount=0,this.keyFrameCount=0,this.trackCount=0,this.animationCount=0,this.animationSize=0,this.hash=0}}ue([(0,n.sU)(1)],Ge.prototype,"type",void 0),ue([(0,n.sU)(2)],Ge.prototype,"paletteSize",void 0),ue([(0,n.sU)(2)],Ge.prototype,"rgbKeyFrameCount",void 0),ue([(0,n.sU)(2)],Ge.prototype,"rgbTrackCount",void 0),ue([(0,n.sU)(2)],Ge.prototype,"keyFrameCount",void 0),ue([(0,n.sU)(2)],Ge.prototype,"trackCount",void 0),ue([(0,n.sU)(2)],Ge.prototype,"animationCount",void 0),ue([(0,n.sU)(2)],Ge.prototype,"animationSize",void 0),ue([(0,n.sU)(4)],Ge.prototype,"hash",void 0);class He{constructor(){this.type=de.transferInstantAnimationSetAck,this.ackType=Pe.download}}ue([(0,n.sU)(1)],He.prototype,"type",void 0),ue([(0,n.sU)(1)],He.prototype,"ackType",void 0);class Ye{constructor(){this.type=de.playInstantAnimation,this.animation=0,this.faceIndex=0,this.loopCount=1}}ue([(0,n.sU)(1)],Ye.prototype,"type",void 0),ue([(0,n.sU)(1)],Ye.prototype,"animation",void 0),ue([(0,n.sU)(1)],Ye.prototype,"faceIndex",void 0),ue([(0,n.sU)(1)],Ye.prototype,"loopCount",void 0);class Ze{constructor(){this.type=de.temperature,this.mcuTemperatureTimes100=0,this.batteryTemperatureTimes100=0}}ue([(0,n.sU)(1)],Ze.prototype,"type",void 0),ue([(0,n.sU)(2)],Ze.prototype,"mcuTemperatureTimes100",void 0),ue([(0,n.sU)(2)],Ze.prototype,"batteryTemperatureTimes100",void 0);class Je{constructor(){this.type=de.setBatteryControllerMode,this.mode=Te.default}}ue([(0,n.sU)(1)],Je.prototype,"type",void 0),ue([(0,n.sU)(1)],Je.prototype,"mode",void 0);class Xe{constructor(){this.type=de.discharge,this.currentMA=0}}ue([(0,n.sU)(1)],Xe.prototype,"type",void 0),ue([(0,n.sU)(1)],Xe.prototype,"currentMA",void 0);class Qe{constructor(){this.type=de.blinkId,this.brightness=0,this.loopCount=1}}ue([(0,n.sU)(1)],Qe.prototype,"type",void 0),ue([(0,n.sU)(1)],Qe.prototype,"brightness",void 0),ue([(0,n.sU)(1)],Qe.prototype,"loopCount",void 0);class et{constructor(){this.type=de.transferTest,this.size=0}}ue([(0,n.sU)(1)],et.prototype,"type",void 0),ue([(0,n.sU)(2,{padding:1})],et.prototype,"size",void 0);class tt{constructor(){this.type=de.playAnimation,this.animationIndex=0,this.remapToFace=0,this.loopCount=1}}ue([(0,n.sU)(1)],tt.prototype,"type",void 0),ue([(0,n.sU)(1)],tt.prototype,"animationIndex",void 0),ue([(0,n.sU)(1)],tt.prototype,"remapToFace",void 0),ue([(0,n.sU)(1)],tt.prototype,"loopCount",void 0);const it=new m(Object.entries(de),[be,we,_e,ke,Ce,xe,Ue,Ae,Se,Me,Oe,$e,Ee,De,Fe,ze,Le,Re,je,Be,Ne,Ke,qe,Ge,He,Ye,Ze,Je,Xe,Qe,et]);class rt extends se{get systemId(){return this._info.systemId}get pixelId(){return this._info.pixelId}get name(){var e;return this._info.name.length?this._info.name:null!==(e=this.sessionDeviceName)&&void 0!==e?e:""}get ledCount(){return this._info.ledCount}get colorway(){return this._info.colorway}get dieType(){return this._info.dieType}get dieFaceCount(){return h.DiceUtils.getFaceCount(this.dieType)}get firmwareDate(){return this._info.firmwareDate}get rssi(){return this._info.rssi}get batteryLevel(){return this._info.batteryLevel}get isCharging(){return this._info.isCharging}get rollState(){return this._info.rollState}get currentFace(){return this._info.currentFace}get currentFaceIndex(){return this._info.currentFaceIndex}get profileHash(){return this._profileHash}get isTransferring(){return this._isTransferring}constructor(e,t){var i,r,s,o,a;super(it,e),this._evEmitter=(0,n.pI)(),this._profileHash=0,this._isTransferring=!1,this.type="die",this._info={systemId:e.systemId,pixelId:null!==(i=null==t?void 0:t.pixelId)&&void 0!==i?i:0,name:"",ledCount:null!==(r=null==t?void 0:t.ledCount)&&void 0!==r?r:0,colorway:null!==(s=null==t?void 0:t.colorway)&&void 0!==s?s:"unknown",dieType:null!==(o=null==t?void 0:t.dieType)&&void 0!==o?o:"unknown",firmwareDate:null!==(a=null==t?void 0:t.firmwareDate)&&void 0!==a?a:new Date(0),rssi:0,batteryLevel:0,isCharging:!1,rollState:"unknown",currentFace:0,currentFaceIndex:0},this._info.ledCount&&"unknown"===this._info.dieType&&(this._info.dieType=h.DiceUtils.estimateDieType(this._info.ledCount)),this._versions={firmwareVersion:0,settingsVersion:0,compatStandardApiVersion:0,compatExtendedApiVersion:0,compatManagementApiVersion:0};const c=({status:e})=>{this._isTransferring&&"identifying"!==e&&"ready"!==e&&this._updateTransferProgress({type:"failed",error:"disconnected"}),"ready"===e&&this._emitEvent("battery",{level:this._info.batteryLevel,isCharging:this._info.isCharging})};this.addPropertyListener("status",c);const l=e=>{this._updateRssi(e.value)};this.addMessageListener("rssi",l);const d=e=>{const t=e;this._updateBattery(t.levelPercent,oe(t.state))};this.addMessageListener("batteryLevel",d);const p=e=>{var t;const i=e;this._updateRoll(null!==(t=(0,n.Gi)(i.state,le))&&void 0!==t?t:"unknown",i.faceIndex)};this.addMessageListener("rollState",p);const y=()=>{var e;this._updateHash(null!==(e=f.factoryProfileHashes[this.dieType])&&void 0!==e?e:0),this._updateName(u("die",this._info.pixelId))};this.addMessageListener("clearSettingsAck",y),this.addMessageListener("programDefaultParametersFinished",y);const m=e=>{const t=e;this._emitEvent("userMessage",{message:t.message,withCancel:t.cancel,response:e=>this.sendMessage((0,n.rV)(new Re,{okCancel:e}))})};this.addMessageListener("notifyUser",m);const g=e=>{const t=e;this._emitEvent("remoteAction",t.actionId)};this.addMessageListener("remoteAction",g),this._disposeFunc=()=>{this.removePropertyListener("status",c),this.removeMessageListener("rssi",l),this.removeMessageListener("batteryLevel",d),this.removeMessageListener("rollState",p),this.removeMessageListener("notifyUser",m),this.removeMessageListener("remoteAction",g),this.removeMessageListener("clearSettingsAck",y),this.removeMessageListener("programDefaultParametersFinished",y)}}_internalDispose(){this._disposeFunc()}updateInfo(e){"disconnected"===this.status&&this.pixelId===e.pixelId&&(e.name&&this._updateName(e.name),e.ledCount&&e.ledCount>0&&!this.ledCount&&this._updateLedCount(e.ledCount),e.colorway&&"unknown"!==e.colorway&&"unknown"===this.colorway&&this._updateColorway(e.colorway),e.dieType&&"unknown"!==e.dieType&&"unknown"===this.dieType&&this._updateDieType(e.dieType),e.firmwareDate&&e.firmwareDate.getTime()>0&&this._updateFirmwareDate(e.firmwareDate.getTime()),void 0!==e.rssi&&e.rssi<0&&this._updateRssi(e.rssi),(void 0===e.batteryLevel||e.batteryLevel>=0&&e.batteryLevel<=100)&&this._updateBattery(e.batteryLevel,e.isCharging),void 0!==e.rollState&&void 0!==e.currentFaceIndex&&e.currentFaceIndex>=0&&e.currentFaceIndex<this.dieFaceCount&&this._updateRoll(e.rollState,e.currentFaceIndex))}async connect(e=0){return await this._internalConnect(e),this}async disconnect(){return await this._internalDisconnect(),this}addEventListener(e,t){this._evEmitter.addListener(e,t)}removeEventListener(e,t){this._evEmitter.removeListener(e,t)}async sendMessage(e,t=!1){const i=this._versions.firmwareVersion;if(i>0&&f.compatApiVersion>i)throw new X(this,this._serializer.getMessageType(e),f.compatApiVersion,i,"library");const r=this._versions.compatStandardApiVersion;if(r>0&&f.apiVersion<r)throw new X(this,this._serializer.getMessageType(e),f.apiVersion,r,"firmware");await this._internalSendMessage(e,t),this._emitEvent("messageSend",e)}async sendAndWaitForResponse(e,t,i=f.ackMessageTimeout){return await this._internalSendAndWaitForResponse(e,t,i)}async sendAndWaitForTypedResponse(e,t,i=f.ackMessageTimeout){return await this._internalSendAndWaitForTypedResponse(e,t,i)}async rename(e){var t;if(!e.length)throw new Q(this);await this.sendAndWaitForResponse((0,n.rV)(new Ke,{name:e}),"setNameAck"),this._updateHash(null!==(t=f.factoryProfileHashes[this.dieType])&&void 0!==t?t:0),this._updateName(e)}async startCalibration(){await this.sendMessage("calibrate")}async reportRssi(e,t=5e3){await this.sendMessage((0,n.rV)(new Fe,{requestMode:e?b.automatic:b.off,minInterval:t}))}async queryRssi(){return(await this.sendAndWaitForResponse((0,n.rV)(new Fe,{requestMode:b.once}),"rssi")).value}async turnOff(){await this.sendMessage((0,n.rV)(new qe,{operation:We.turnOff}),!0)}async blink(e,t){var i,r,s,o,a;const c=(0,n.rV)(new Ee,{color:h.Color32Utils.toColor32(e),count:null!==(i=null==t?void 0:t.count)&&void 0!==i?i:1,duration:null!==(r=null==t?void 0:t.duration)&&void 0!==r?r:1e3,fade:255*(null!==(s=null==t?void 0:t.fade)&&void 0!==s?s:0),faceMask:null!==(o=null==t?void 0:t.faceMask)&&void 0!==o?o:h.AnimConstants.faceMaskAll,loopCount:null!==(a=null==t?void 0:t.loopCount)&&void 0!==a?a:1});await this.sendAndWaitForResponse(c,"blinkAck")}async stopAllAnimations(){await this.sendMessage("stopAllAnimations")}async transferDataSet(e){const t=e.toByteArray(),i=h.DataSet.computeHash(t),r=(0,n.rV)(new Ue,{paletteSize:e.animationBits.getPaletteSize(),rgbKeyFrameCount:e.animationBits.getRgbKeyframeCount(),rgbTrackCount:e.animationBits.getRgbTrackCount(),keyFrameCount:e.animationBits.getKeyframeCount(),trackCount:e.animationBits.getTrackCount(),animationCount:e.animations.length,animationSize:e.animations.reduce(((e,t)=>e+(0,n.bE)(t)),0),conditionCount:e.conditions.length,conditionSize:e.conditions.reduce(((e,t)=>e+(0,n.bE)(t)),0),actionCount:e.actions.length,actionSize:e.actions.reduce(((e,t)=>e+(0,n.bE)(t)),0),ruleCount:e.rules.length,brightness:e.brightness});await this._programDataSet((async()=>(await this.sendAndWaitForTypedResponse(r,Ae)).result?Pe.download:Pe.noMemory),"transferAnimationSetFinished",t),this._updateHash(i)}async playTestAnimation(e){if(!e.animations.length)throw new ie(this);const t=e.toAnimationsByteArray(),i=h.DataSet.computeHash(t),r=(0,n.rV)(new Se,{paletteSize:e.animationBits.getPaletteSize(),rgbKeyFrameCount:e.animationBits.getRgbKeyframeCount(),rgbTrackCount:e.animationBits.getRgbTrackCount(),keyFrameCount:e.animationBits.getKeyframeCount(),trackCount:e.animationBits.getTrackCount(),animationCount:e.animations.length,animationSize:e.animations.reduce(((e,t)=>e+(0,n.bE)(t)),0),hash:i});await this._programDataSet((async()=>(await this.sendAndWaitForTypedResponse(r,Me)).ackType),"transferTestAnimationSetFinished",t)}async transferInstantAnimations(e){if(!e.animations.length)throw new ie(this);const t=e.toAnimationsByteArray(),i=h.DataSet.computeHash(t),r=(0,n.rV)(new Ge,{paletteSize:e.animationBits.getPaletteSize(),rgbKeyFrameCount:e.animationBits.getRgbKeyframeCount(),rgbTrackCount:e.animationBits.getRgbTrackCount(),keyFrameCount:e.animationBits.getKeyframeCount(),trackCount:e.animationBits.getTrackCount(),animationCount:e.animations.length,animationSize:e.animations.reduce(((e,t)=>e+(0,n.bE)(t)),0),hash:i});await this._programDataSet((async()=>(await this.sendAndWaitForTypedResponse(r,He)).ackType),"transferInstantAnimationSetFinished",t)}async playInstantAnimation(e){await this.sendMessage((0,n.rV)(new Ye,{animation:e}))}_onStatusChanged(e){this._emitEvent("statusChanged",e)}async _internalSetup(){var e,t,i;let r;for(r in this._versions)this._versions[r]=0;this._log("Waiting on identification message");const s=await this.sendAndWaitForResponse("whoAreYou","iAmADie"),o=null!==(e=s.pixelId)&&void 0!==e?e:null===(t=s.dieInfo)||void 0===t?void 0:t.pixelId;if(!o)throw new q(this,"Got an empty Pixel id");if(this._info.pixelId){if(this._info.pixelId!==o)throw new Y(this,o)}else this._info.pixelId=o,this.emitPropertyEvent("pixelId");const a=e=>{var t,i,r;this._updateLedCount(e.ledCount),this._updateColorway(null!==(t=(0,n.Gi)(e.colorway,h.PixelColorwayValues))&&void 0!==t?t:"unknown");const s=null!==(i=(0,n.Gi)(e.dieType,h.PixelDieTypeValues))&&void 0!==i?i:"unknown";this._updateDieType("unknown"!==s?s:h.DiceUtils.estimateDieType(this.ledCount)),this._updateFirmwareDate(1e3*e.buildTimestamp),this._updateBattery(e.batteryLevelPercent,oe(e.batteryState)),this._updateRoll(null!==(r=(0,n.Gi)(e.rollState,le))&&void 0!==r?r:"unknown",e.currentFaceIndex,{skipEvents:!0})};if(s instanceof be){a(s);const e=256;this._versions.firmwareVersion=e,this._versions.settingsVersion=e,this._versions.compatStandardApiVersion=e,this._versions.compatExtendedApiVersion=e,this._versions.compatManagementApiVersion=e}else{for(r in a(Object.assign(Object.assign(Object.assign({},s.dieInfo),s.versionInfo),s.statusInfo)),this._versions)this._versions[r]=s.versionInfo[r];this._updateName(s.dieName.name)}const c=null!==(i=s.dataSetHash)&&void 0!==i?i:s.settingsInfo.profileDataHash;this._updateHash(c)}_internalDeserializeMessage(e){let t;if(e.byteLength&&e.getUint8(0)===de.iAmADie&&e.byteLength!==be.expectedSize){const i=new ve;B(e,i,(e=>this._warn(e))),t=i}else t=this._serializer.deserializeMessage(e);return t&&this._emitEvent("messageReceived",t),t}_emitEvent(e,t){try{this._evEmitter.emit(e,t)}catch(t){console.error(this._tagLogString(`Uncaught error in "${e}" event listener: ${t}`))}}_updateName(e){e.length&&e!==this._info.name&&(this._info.name=e,this.emitPropertyEvent("name"))}_updateLedCount(e){this._info.ledCount!==e&&(this._info.ledCount=e,this.emitPropertyEvent("ledCount"))}_updateColorway(e){this._info.colorway!==e&&(this._info.colorway=e,this.emitPropertyEvent("colorway"))}_updateDieType(e){this._info.dieType!==e&&(this._info.dieType=e,this.emitPropertyEvent("dieType"))}_updateFirmwareDate(e){e&&e!==this._info.firmwareDate.getTime()&&(this._info.firmwareDate=new Date(e),this.emitPropertyEvent("firmwareDate"))}_updateRssi(e){e&&e!==this._info.rssi&&(this._info.rssi=e,this.emitPropertyEvent("rssi"))}_updateBattery(e,t){const i=void 0!==e&&this._info.batteryLevel!==e,r=void 0!==t&&this._info.isCharging!==t;i&&(this._info.batteryLevel=e,this.emitPropertyEvent("batteryLevel")),r&&(this._info.isCharging=t,this.emitPropertyEvent("isCharging")),(i||r)&&this._emitEvent("battery",{level:null!=e?e:this.batteryLevel,isCharging:null!=t?t:this.isCharging})}_updateRoll(e,t,i){6===this._info.ledCount&&this._info.firmwareDate.getTime()<17163828e5&&"crooked"===e&&(e="rolled");const r={state:e,faceIndex:t,face:h.DiceUtils.faceFromIndex(t,this.dieType,this.firmwareDate.getTime())},n=this._info.rollState!==r.state,s=this._info.currentFaceIndex!==r.faceIndex,o=this._info.currentFace!==r.face;if(this._info.rollState=r.state,this._info.currentFaceIndex=r.faceIndex,this._info.currentFace=r.face,n&&this.emitPropertyEvent("rollState"),s&&this.emitPropertyEvent("currentFaceIndex"),o&&this.emitPropertyEvent("currentFace"),!(null==i?void 0:i.skipEvents)){const e="rolled"===r.state?r.face:void 0;this._emitEvent("rollState",r),void 0!==e&&this._emitEvent("roll",e)}}_updateHash(e){e!==this._profileHash&&(this._profileHash=e,this.emitPropertyEvent("profileHash"))}async _programDataSet(e,t,i){if(this._isTransferring)throw new te(this);let r;this._isTransferring=!0,this._updateTransferProgress({type:"preparing",totalBytes:i.byteLength}),this.emitPropertyEvent("isTransferring");try{r=await e()}catch(e){throw this._isTransferring&&this._updateTransferProgress({type:"failed",error:"timeout"}),e}switch(r){case Pe.download:this._log("Ready to receive animations of size "+i.byteLength),await this._uploadBulkDataWithAck(t,i);break;case Pe.upToDate:this._log("Animations are already up-to-date"),this._updateTransferProgress({type:"completed",totalBytes:0});break;case Pe.noMemory:throw this._log("Not enough memory to store animations of size "+i.byteLength),this._updateTransferProgress({type:"failed",error:"outOfMemory"}),new ne(this,i.byteLength);default:{const e=new ee(this,`Got unknown transfer result: ${r}`);throw this._updateTransferProgress({type:"failed",error:"unknown"}),e}}}_updateTransferProgress(e){const t=this._isTransferring;this._isTransferring="completed"!==e.type&&"failed"!==e.type,this._emitEvent("dataTransfer",e),this._isTransferring!==t&&this.emitPropertyEvent("isTransferring")}async _uploadBulkDataWithAck(e,t){this._updateTransferProgress({type:"starting",totalBytes:t.byteLength});let i,r=!1;const n=()=>{r=!0,i&&(i(),i=void 0)};this.addMessageListener(e,n);try{await this._uploadBulkData(t),this._log("Done sending dataset, waiting for Pixel to finish programming");const n=new Promise(((t,n)=>{if(r)t();else{const r=setTimeout((()=>{n(new re(this,e))}),f.ackMessageTimeout);i=()=>{clearTimeout(r),t()}}}));await n,this._log("Programming done"),this._updateTransferProgress({type:"completed",totalBytes:t.byteLength})}catch(e){throw this._isTransferring&&this._updateTransferProgress({type:"failed",error:"timeout"}),e}finally{this.removeMessageListener(e,n)}}async _uploadBulkData(e){let t=e.byteLength;this._log(`Sending ${t} bytes of bulk data`);const i=new ke;i.size=t,await this.sendAndWaitForResponse(i,"bulkSetupAck"),this._log("Ready for receiving data"),this._updateTransferProgress({type:"progress",progressPercent:0,transferredBytes:0,totalBytes:e.byteLength});let r=0,n=0;const s=new Ce;for(;t>0;){s.offset=n,s.size=Math.min(t,f.maxMessageSize),s.data=e.slice(n,n+s.size),await this.sendAndWaitForResponse(s,"bulkDataAck"),t-=s.size,n+=s.size;const i=Math.round(100*n/e.byteLength);i>r&&(this._updateTransferProgress({type:"progress",progressPercent:i,transferredBytes:n,totalBytes:e.byteLength}),r=i)}this._log("Finished sending bulk data")}}const nt={die:{service:"a6b90001-7a5a-43f2-a962-350c8edc9b5b",notifyCharacteristic:"a6b90002-7a5a-43f2-a962-350c8edc9b5b",writeCharacteristic:"a6b90003-7a5a-43f2-a962-350c8edc9b5b"},legacyDie:{service:"6e400001-b5a3-f393-e0a9-e50e24dcca9e",notifyCharacteristic:"6e400001-b5a3-f393-e0a9-e50e24dcca9e",writeCharacteristic:"6e400002-b5a3-f393-e0a9-e50e24dcca9e"},charger:{service:"a8b90001-8d5e-4411-bd7a-cb49359d1f05",notifyCharacteristic:"a8b90002-8d5e-4411-bd7a-cb49359d1f05",writeCharacteristic:"a8b90003-8d5e-4411-bd7a-cb49359d1f05"},dfuService:65113,systemicGamesCompanyId:3385};class st{constructor(e,t){this._systemId=e,this._lastConnStatus="disconnected",this._name=t}get systemId(){return this._systemId}get pixelName(){return this._name}get lastConnectionStatus(){return this._lastConnStatus}setConnectionEventListener(e){this._connStatusCb=e}_notifyConnectionEvent(e,t="success"){var i;this._lastConnStatus!==e&&(this._lastConnStatus=e,null===(i=this._connStatusCb)||void 0===i||i.call(this,{systemId:this._systemId,status:e,reason:t}))}_setName(e){this._name=e}}async function ot(e,t,i,r){var s,o,a;try{const e=await i();null===(s=null==r?void 0:r.onResolved)||void 0===s||s.call(r,e)}catch(s){if(0===e)throw null===(a=null==r?void 0:r.onRejected)||void 0===a||a.call(r,s),s;null===(o=null==r?void 0:r.onWillRetry)||void 0===o||o.call(r,t,e,s),await(0,n.cb)(t),await ot(e-1,2*t,i,r)}}async function at(e,t){var i;await ot(null!==(i=null==t?void 0:t.retries)&&void 0!==i?i:2,2e3,e.connect.bind(e),t)}function ct(e){return(0,n.Vl)(e)+"-0000-1000-8000-00805f9b34fb"}},721:(e,t,i)=>{"use strict";i.d(t,{Fn:()=>w,vA:()=>n,xb:()=>s,TN:()=>o,ZI:()=>a,bE:()=>k,pI:()=>l,cb:()=>d,iu:()=>S,YE:()=>y,$9:()=>h,Gi:()=>m,y1:()=>g,rV:()=>v,sU:()=>T,lK:()=>A,Vl:()=>P});class r extends Error{constructor(e){super(e),this.name="AssertionError"}}function n(e,t){if(!e)throw new r(null!=t?t:`Assertion failed with value ${e}`)}function s(e,t){n(!1,null!=t?t:"assertNever() called")}function o(e){let t=5381;for(let i=0;i<e.length;++i)t=33*t^e[i];return t>>>0}function a(e){const t=[];if((e=Math.floor(null!=e?e:0))>0){let i=e.toString(2),r=0;for(;i.length;)"1"===i[i.length-1]&&t.push(r),i=i.substring(0,i.length-1),++r}return t}var c=i(46);function l(){return new c.EventEmitter}class u extends Error{constructor(e,t){super(e),this.name="DecodeUtf8Error",this.decodedString=t}}async function d(e,t){return new Promise(((i,r)=>{if(null==t?void 0:t.aborted)r(new Error(`Call to delay(${e}) aborted on start`));else{const n=()=>{clearTimeout(s),r(new Error(`Call to delay(${e}) aborted before timeout`))};null==t||t.addEventListener("abort",n);const s=setTimeout((()=>{null==t||t.removeEventListener("abort",n),i()}),e)}}))}let p=0;function h(e){return void 0!==e&&(p=e),p++}let f=0;function y(e){void 0!==e&&(f=e);const t=1<<f;return f+=1,t}function m(e,t){for(const[i,r]of Object.entries(t))if(r===e)return i}function g(e,t,i){let r=e;void 0===t&&(t=e,r=0),i||(i=1);let n=(t-r)/i;n<0&&(n=-n,i=-i);const s=Array(Math.floor(n));let o=r,a=0;for(;a<n;)s[a]=o,o+=i,a+=1;return s}function v(e,t){return Object.assign(e,function(e){for(const t of Object.keys(e))void 0===e[t]&&delete e[t];return e}(t))}i(909);const b=Symbol.for("PixelsAnimationSerializable");class w extends Error{constructor(e){super(e),this.name="SerializationError"}}function T(e,t){return function(i,r){const n=Reflect.getMetadata(b,i),s={propertyKey:r,size:e,options:t};n?n.push(s):Reflect.defineMetadata(b,[s],i)}}function _(e){return Reflect.getMetadata(b,e)}function k(e){var t,i;return Array.isArray(e)?e.reduce(((e,t)=>e+k(t)),0):null!==(i=null===(t=_(e))||void 0===t?void 0:t.reduce(((e,t)=>{var i,r,n,s;if((null===(i=t.options)||void 0===i?void 0:i.nullTerminated)||(null===(r=null==t?void 0:t.options)||void 0===r?void 0:r.terminator))throw new w("Dynamic size");return e+t.size+(null!==(s=null===(n=t.options)||void 0===n?void 0:n.padding)&&void 0!==s?s:0)}),0))&&void 0!==i?i:0}function C(e,t){const i=_(e);if(!(null==i?void 0:i.length))throw new w("Object has no serializable property");for(const r of i){const i=e[r.propertyKey],n=i instanceof ArrayBuffer||i&&i.buffer instanceof ArrayBuffer;if("number"!=typeof i&&"bigint"!=typeof i&&"boolean"!=typeof i&&"string"!=typeof i&&!n)throw new w(Array.isArray(i)?"Invalid property type, got an array, use an 'ArrayBuffer' instead":`Invalid property type, got ${typeof i} for ${r.propertyKey} but expected number or bigint`);if(!t(r,i))break}}function x(e,t){const i=Number(e);let r,n;switch(t){case"int8":r=-128,n=127;break;case"uint8":r=0,n=255;break;case"int16":r=-32768,n=32767;break;case"uint16":r=0,n=65535;break;case"int32":r=-2147483648,n=2147483647;break;case"uint32":r=0,n=4294967295}if(r&&n){if(i<r)throw new w(`Value ${i} too small to fit in a ${t}`);if(i>n)throw new w(`Value ${i} too big to fit in a ${t}`)}return i}function U(e,t,i=0){if(Array.isArray(e)){const r={dataView:t,byteOffset:i};for(const t of e){const[e,i]=A(t,r);r.dataView=e,r.byteOffset=i}return[r.dataView,r.byteOffset]}return C(e,((e,r)=>{var n,s,o,a,c,l,u,d,p,h;let f;var y;if("string"==typeof r?f=(y=r,new Uint8Array(function(e){const t=[];for(let i=0;i<e.length;i++){const r=e.codePointAt(i);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<65536?t.push(224|r>>12,128|r>>6&63,128|63&r):(i++,t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return t}(y))).buffer:r instanceof ArrayBuffer?f=r:r.buffer&&r.buffer instanceof ArrayBuffer&&(f=r.buffer),f){const u=f.byteLength+("string"==typeof r?1:0);if(!(null===(n=e.options)||void 0===n?void 0:n.nullTerminated)&&!(null===(s=e.options)||void 0===s?void 0:s.terminator)&&e.size<u)throw new w(`Serialized value for \`${e.propertyKey}\` takes ${u} bytes but prop size is ${e.size}`);const d=new Uint8Array(f),p=(null===(o=e.options)||void 0===o?void 0:o.nullTerminated)||(null===(a=e.options)||void 0===a?void 0:a.terminator)?d.byteLength:Math.min(d.byteLength,e.size);for(let e=0;e<p;++e)t.setUint8(i,d[e]),++i;if(!(null===(c=e.options)||void 0===c?void 0:c.nullTerminated)&&!(null===(l=e.options)||void 0===l?void 0:l.terminator))for(let r=p;r<e.size;++r)t.setUint8(i,0),++i}else{const n="float"===(null===(u=e.options)||void 0===u?void 0:u.numberFormat),s="signed"===(null===(d=e.options)||void 0===d?void 0:d.numberFormat);!function(e,t,i,r,n,s){switch(r){case 1:n?e.setInt8(t,x(i,"int8")):e.setUint8(t,x(i,"uint8"));break;case 2:n?e.setInt16(t,x(i,"int16"),!0):e.setUint16(t,x(i,"uint16"),!0);break;case 4:s?e.setFloat32(t,x(i,"float32"),!0):n?e.setInt32(t,x(i,"int32"),!0):e.setInt32(t,x(i,"uint32"),!0);break;case 8:if(!s)throw new w("BigInt not supported");e.setFloat64(t,x(i,"float64"),!0);break;default:throw new w(`Invalid property size, got ${r} but expected 1, 2, 4, or 8`)}}(t,i,r,e.size,s,n),i+=e.size+(null!==(h=null===(p=e.options)||void 0===p?void 0:p.padding)&&void 0!==h?h:0)}return!0})),[t,i]}function A(e,t){var i;if(null==t?void 0:t.dataView)return U(e,t.dataView,null!==(i=t.byteOffset)&&void 0!==i?i:0);{const t=k(e),[i,r]=U(e,new DataView(new ArrayBuffer(t)));return n(r===i.buffer.byteLength,`Incorrect offset after serialization, got ${r} but expected ${i.buffer.byteLength}`),[i,r]}}function S(e,t,i){return function(e,t,i){function r(e,t,i,r){if("boolean"!=typeof r||"number"!=typeof i&&"bigint"!=typeof i){if(typeof i!=typeof r)throw new w(`Type mismatch, deserialized a ${typeof i} but but expected a ${typeof r}`)}else i=Boolean(i);e[t.propertyKey]=i}let n=0;return C(e,((s,o)=>{var a,c,l,d,p,h,f,y,m,g,v;if((null==i?void 0:i.allowSkipLastProps)&&n===t.byteLength)return!1;if(!(null===(a=s.options)||void 0===a?void 0:a.nullTerminated)&&!(null===(c=s.options)||void 0===c?void 0:c.terminator)&&n+s.size>t.byteLength)throw new w(`Not enough bytes for deserializing \`${s.propertyKey}\` of size ${s.size}`);if(Array.isArray(e))throw new w("Array type not supported for deserialization");if("string"==typeof o){const i=t.byteOffset+n;if(!(null===(l=s.options)||void 0===l?void 0:l.nullTerminated)&&!(null===(d=s.options)||void 0===d?void 0:d.terminator)&&i+s.size>t.buffer.byteLength)throw new w(`Unexpected property size, got ${s.size} but there are only ${t.buffer.byteLength-i} left`);const a=t.buffer.slice(i,(null===(p=s.options)||void 0===p?void 0:p.nullTerminated)?function(e,t){for(let i=t;i<e.byteLength;++i)if(!e.getUint8(i))return i;throw new w("Data is not null terminated")}(t,n)-1:(null===(h=s.options)||void 0===h?void 0:h.terminator)?t.byteOffset+t.byteLength:i+s.size);try{r(e,s,function(e){let t=0,i="";for(;t<e.length;){let r=e[t++];if(!r)break;if(r>127)if(r>191&&r<224){if(t>=e.length)throw new u("Incomplete 2-bytes sequence",i);r=(31&r)<<6|63&e[t++]}else if(r>223&&r<240){if(t+1>=e.length)throw new u("Incomplete 3-bytes sequence",i);r=(15&r)<<12|(63&e[t++])<<6|63&e[t++]}else{if(!(r>239&&r<248))throw new u(`Unknown multibyte start 0x${r.toString(16).padStart(2,"0")} at index ${t-1}`,i);if(t+2>=e.length)throw new u("Incomplete 4-bytes sequence",i);r=(7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++]}if(r<=65535)i+=String.fromCharCode(r);else{if(!(r<=1114111))throw new u(`Code point 0x${r.toString(16).padStart(2,"0")} exceeds UTF-16 reach`,i);r-=65536,i+=String.fromCharCode(r>>10|55296),i+=String.fromCharCode(1023&r|56320)}}return i}(new Uint8Array(a)),o)}catch(t){if(!(t instanceof u))throw new w(null!==(f=null==t?void 0:t.message)&&void 0!==f?f:String(t));r(e,s,t.decodedString,o),console.warn(`Error decoding string for \`${s.propertyKey}\`: ${t}`)}n+=a.byteLength}else{const i="float"===(null===(y=s.options)||void 0===y?void 0:y.numberFormat),a="signed"===(null===(m=s.options)||void 0===m?void 0:m.numberFormat),c=function(e,t,i,r,n){switch(i){case 1:return r?e.getInt8(t):e.getUint8(t);case 2:return r?e.getInt16(t,!0):e.getUint16(t,!0);case 4:return n?e.getFloat32(t,!0):r?e.getInt32(t,!0):e.getUint32(t,!0);case 8:if(n)return e.getFloat64(t,!0);throw new w("BigInt not supported");default:throw new w(`Invalid property size, got ${i} but expected 1, 2, 4, or 8`)}}(t,n,s.size,a,i);r(e,s,c,o),n+=s.size}return n+=null!==(v=null===(g=s.options)||void 0===g?void 0:g.padding)&&void 0!==v?v:0,!0})),n}(e,t,i)}function P(e){return(e>>>0).toString(16).padStart(8,"0")}},909:(e,t,i)=>{var r;!function(e){!function(){var t="object"==typeof globalThis?globalThis:"object"==typeof i.g?i.g:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(e){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}(),r=n(e);function n(e,t){return function(i,r){Object.defineProperty(e,i,{configurable:!0,writable:!0,value:r}),t&&t(i,r)}}void 0!==t.Reflect&&(r=n(t.Reflect,r)),function(e,t){var i=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,n=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",s=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,c=!o&&!a,l={create:o?function(){return B(Object.create(null))}:a?function(){return B({__proto__:null})}:function(){return B({})},has:c?function(e,t){return i.call(e,t)}:function(e,t){return t in e},get:c?function(e,t){return i.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),d="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:function(){var e={},t=[],i=function(){function e(e,t,i){this._index=0,this._keys=e,this._values=t,this._selector=i}return e.prototype["@@iterator"]=function(){return this},e.prototype[s]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var i=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:i,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var i=this._find(e,!0);return this._values[i]=t,this},t.prototype.delete=function(t){var i=this._find(t,!1);if(i>=0){for(var r=this._keys.length,n=i+1;n<r;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,E(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new i(this._keys,this._values,r)},t.prototype.values=function(){return new i(this._keys,this._values,n)},t.prototype.entries=function(){return new i(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[s]=function(){return this.entries()},t.prototype._find=function(e,t){if(!E(this._cacheKey,e)){this._cacheIndex=-1;for(var i=0;i<this._keys.length;i++)if(E(this._keys[i],e)){this._cacheIndex=i;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function n(e,t){return t}function o(e,t){return[e,t]}}(),p="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:function(){function e(){this._map=new d}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[s]=function(){return this.keys()},e}(),h="function"==typeof WeakMap?WeakMap:function(){var e=l.create(),t=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=n(e,!1);return void 0!==t&&l.has(t,this._key)},e.prototype.get=function(e){var t=n(e,!1);return void 0!==t?l.get(t,this._key):void 0},e.prototype.set=function(e,t){return n(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=n(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do{t="@@WeakMap@@"+o()}while(l.has(e,t));return e[t]=!0,t}function n(e,r){if(!i.call(e,t)){if(!r)return;Object.defineProperty(e,t,{value:l.create()})}return e[t]}function s(e,t){for(var i=0;i<t;++i)e[i]=255*Math.random()|0;return e}function o(){var e=function(e){if("function"==typeof Uint8Array){var t=new Uint8Array(e);return"undefined"!=typeof crypto?crypto.getRandomValues(t):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(t):s(t,e),t}return s(new Array(e),e)}(16);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var t="",i=0;i<16;++i){var r=e[i];4!==i&&6!==i&&8!==i||(t+="-"),r<16&&(t+="0"),t+=r.toString(16).toLowerCase()}return t}}(),f=r?Symbol.for("@reflect-metadata:registry"):void 0,y=function(){var e;return!x(f)&&A(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[f]),x(e)&&(e=function(){var e,i,r,n;x(f)||void 0===t.Reflect||f in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=function(e){var t=e.defineMetadata,i=e.hasOwnMetadata,r=e.getOwnMetadata,n=e.getOwnMetadataKeys,s=e.deleteMetadata,o=new h;return{isProviderFor:function(e,t){var i=o.get(e);return!(x(i)||!i.has(t))||!!n(e,t).length&&(x(i)&&(i=new p,o.set(e,i)),i.add(t),!0)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:r,OrdinaryOwnMetadataKeys:n,OrdinaryDeleteMetadata:s}}(t.Reflect));var s=new h,o={registerProvider:a,getProvider:l,setProvider:y};return o;function a(t){if(!Object.isExtensible(o))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case x(i):i=t;break;case i===t:break;case x(r):r=t;break;case r===t:break;default:void 0===n&&(n=new p),n.add(t)}}function c(t,s){if(!x(i)){if(i.isProviderFor(t,s))return i;if(!x(r)){if(r.isProviderFor(t,s))return i;if(!x(n))for(var o=F(n);;){var a=L(o);if(!a)return;var c=z(a);if(c.isProviderFor(t,s))return R(o),c}}}if(!x(e)&&e.isProviderFor(t,s))return e}function l(e,t){var i,r=s.get(e);return x(r)||(i=r.get(t)),x(i)?(x(i=c(e,t))||(x(r)&&(r=new d,s.set(e,r)),r.set(t,i)),i):i}function u(e){if(x(e))throw new TypeError;return i===e||r===e||!x(n)&&n.has(e)}function y(e,t,i){if(!u(i))throw new Error("Metadata provider not registered.");var r=l(e,t);if(r!==i){if(!x(r))return!1;var n=s.get(e);x(n)&&(n=new d,s.set(e,n)),n.set(t,i)}return!0}}()),!x(f)&&A(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,f,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}(),m=function(e){var t=new h,i={isProviderFor:function(e,i){var r=t.get(e);return!x(r)&&r.has(i)},OrdinaryDefineOwnMetadata:function(e,t,i,n){r(i,n,!0).set(e,t)},OrdinaryHasOwnMetadata:function(e,t,i){var n=r(t,i,!1);return!x(n)&&P(n.has(e))},OrdinaryGetOwnMetadata:function(e,t,i){var n=r(t,i,!1);if(!x(n))return n.get(e)},OrdinaryOwnMetadataKeys:function(e,t){var i=[],n=r(e,t,!1);if(x(n))return i;for(var s=F(n.keys()),o=0;;){var a=L(s);if(!a)return i.length=o,i;var c=z(a);try{i[o]=c}catch(e){try{R(s)}finally{throw e}}o++}},OrdinaryDeleteMetadata:function(e,i,n){var s=r(i,n,!1);if(x(s))return!1;if(!s.delete(e))return!1;if(0===s.size){var o=t.get(i);x(o)||(o.delete(n),0===o.size&&t.delete(o))}return!0}};return y.registerProvider(i),i;function r(r,n,s){var o=t.get(r),a=!1;if(x(o)){if(!s)return;o=new d,t.set(r,o),a=!0}var c=o.get(n);if(x(c)){if(!s)return;if(c=new d,o.set(n,c),!e.setProvider(r,n,i))throw o.delete(n),a&&t.delete(r),new Error("Wrong provider for target.")}return c}}(y);function g(e,t,i){if(v(e,t,i))return!0;var r=j(t);return!U(r)&&g(e,r,i)}function v(e,t,i){var r=V(t,i,!1);return!x(r)&&P(r.OrdinaryHasOwnMetadata(e,t,i))}function b(e,t,i){if(v(e,t,i))return w(e,t,i);var r=j(t);return U(r)?void 0:b(e,r,i)}function w(e,t,i){var r=V(t,i,!1);if(!x(r))return r.OrdinaryGetOwnMetadata(e,t,i)}function T(e,t,i,r){V(i,r,!0).OrdinaryDefineOwnMetadata(e,t,i,r)}function _(e,t){var i=k(e,t),r=j(e);if(null===r)return i;var n=_(r,t);if(n.length<=0)return i;if(i.length<=0)return n;for(var s=new p,o=[],a=0,c=i;a<c.length;a++){var l=c[a];s.has(l)||(s.add(l),o.push(l))}for(var u=0,d=n;u<d.length;u++)l=d[u],s.has(l)||(s.add(l),o.push(l));return o}function k(e,t){var i=V(e,t,!1);return i?i.OrdinaryOwnMetadataKeys(e,t):[]}function C(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function x(e){return void 0===e}function U(e){return null===e}function A(e){return"object"==typeof e?null!==e:"function"==typeof e}function S(e,t){switch(C(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var i=3===t?"string":5===t?"number":"default",r=D(e,n);if(void 0!==r){var s=r.call(e,i);if(A(s))throw new TypeError;return s}return function(e,t){if("string"===t){var i=e.toString;if($(i)&&!A(n=i.call(e)))return n;if($(r=e.valueOf)&&!A(n=r.call(e)))return n}else{var r;if($(r=e.valueOf)&&!A(n=r.call(e)))return n;var n,s=e.toString;if($(s)&&!A(n=s.call(e)))return n}throw new TypeError}(e,"default"===i?"number":i)}function P(e){return!!e}function M(e){var t=S(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function O(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function $(e){return"function"==typeof e}function I(e){return"function"==typeof e}function E(e,t){return e===t||e!=e&&t!=t}function D(e,t){var i=e[t];if(null!=i){if(!$(i))throw new TypeError;return i}}function F(e){var t=D(e,s);if(!$(t))throw new TypeError;var i=t.call(e);if(!A(i))throw new TypeError;return i}function z(e){return e.value}function L(e){var t=e.next();return!t.done&&t}function R(e){var t=e.return;t&&t.call(e)}function j(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===u)return t;if(t!==u)return t;var i=e.prototype,r=i&&Object.getPrototypeOf(i);if(null==r||r===Object.prototype)return t;var n=r.constructor;return"function"!=typeof n||n===e?t:n}function V(e,t,i){var r=y.getProvider(e,t);if(!x(r))return r;if(i){if(y.setProvider(e,t,m))return m;throw new Error("Illegal state.")}}function B(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,i,r){if(x(i)){if(!O(e))throw new TypeError;if(!I(t))throw new TypeError;return function(e,t){for(var i=e.length-1;i>=0;--i){var r=(0,e[i])(t);if(!x(r)&&!U(r)){if(!I(r))throw new TypeError;t=r}}return t}(e,t)}if(!O(e))throw new TypeError;if(!A(t))throw new TypeError;if(!A(r)&&!x(r)&&!U(r))throw new TypeError;return U(r)&&(r=void 0),function(e,t,i,r){for(var n=e.length-1;n>=0;--n){var s=(0,e[n])(t,i,r);if(!x(s)&&!U(s)){if(!A(s))throw new TypeError;r=s}}return r}(e,t,i=M(i),r)})),e("metadata",(function(e,t){return function(i,r){if(!A(i))throw new TypeError;if(!x(r)&&!function(e){switch(C(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;T(e,t,i,r)}})),e("defineMetadata",(function(e,t,i,r){if(!A(i))throw new TypeError;return x(r)||(r=M(r)),T(e,t,i,r)})),e("hasMetadata",(function(e,t,i){if(!A(t))throw new TypeError;return x(i)||(i=M(i)),g(e,t,i)})),e("hasOwnMetadata",(function(e,t,i){if(!A(t))throw new TypeError;return x(i)||(i=M(i)),v(e,t,i)})),e("getMetadata",(function(e,t,i){if(!A(t))throw new TypeError;return x(i)||(i=M(i)),b(e,t,i)})),e("getOwnMetadata",(function(e,t,i){if(!A(t))throw new TypeError;return x(i)||(i=M(i)),w(e,t,i)})),e("getMetadataKeys",(function(e,t){if(!A(e))throw new TypeError;return x(t)||(t=M(t)),_(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!A(e))throw new TypeError;return x(t)||(t=M(t)),k(e,t)})),e("deleteMetadata",(function(e,t,i){if(!A(t))throw new TypeError;if(x(i)||(i=M(i)),!A(t))throw new TypeError;x(i)||(i=M(i));var r=V(t,i,!1);return!x(r)&&r.OrdinaryDeleteMetadata(e,t,i)}))}(r,t),void 0===t.Reflect&&(t.Reflect=e)}()}(r||(r={}))}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}return i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(344)})()));