/*! For license information please see index.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.pixelsWebConnect=t():e.pixelsWebConnect=t()}(this,(()=>(()=>{var e={699:e=>{"use strict";var t,i="object"==typeof Reflect?Reflect:null,n=i&&"function"==typeof i.apply?i.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};t=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(i,n){function r(i){e.removeListener(t,o),n(i)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",r),i([].slice.call(arguments))}y(e,t,o,{once:!0}),"error"!==t&&function(e,t,i){"function"==typeof e.on&&y(e,"error",t,{once:!0})}(e,r)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function l(e,t,i,n){var r,o,s,l;if(a(i),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),o=e._events),s=o[t]),void 0===s)s=o[t]=i,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[i,s]:[s,i]:n?s.unshift(i):s.push(i),(r=c(e))>0&&s.length>r&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,l=u,console&&console.warn&&console.warn(l)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=u.bind(n);return r.listener=i,n.wrapFn=r,r}function p(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):f(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function f(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}function y(e,t,i,n){if("function"==typeof e.on)n.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(o){n.once&&e.removeEventListener(t,r),i(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var l=c.length,u=f(c,l);for(i=0;i<l;++i)n(u[i],this,t)}return!0},o.prototype.addListener=function(e,t){return l(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return l(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,n,r,o,s;if(a(t),void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){s=i[o].listener,r=o;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,o=Object.keys(i);for(n=0;n<o.length;++n)"removeListener"!==(r=o[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},o.prototype.listeners=function(e){return p(this,e,!0)},o.prototype.rawListeners=function(e){return p(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},o.prototype.listenerCount=h,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},554:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BleSessionError=void 0;const n=i(754),r=i(494);class o extends Error{constructor(e){super(e),this.name="BluetoothError"}}class s extends Error{constructor(e){super(e),this.name="ScanTimeoutError"}}class a extends Error{constructor(e){super(e),this.name="BleSessionError"}}t.BleSessionError=a;class c extends n.PixelSession{constructor(e){super(e);const t=r.PixelsDevices.getKnownDevice(e);if(!t)throw new a(`No known Bluetooth device with system id: ${e}`);this._device=t,this._name=this._device.name}get pixelName(){return this._name}async connect(){var e;this._name=this._device.name;const t=this;this._device.addEventListener("gattserverdisconnected",(()=>{t._notifyConnectionEvent("disconnected")}));const i=this._device.gatt;if(!i)throw new o("Gatt server not available");if(!i.connected){try{this._notifyConnectionEvent("connecting"),await i.connect()}catch(n){let r=n;if(this._device.watchAdvertisements&&(null===(e=null==r?void 0:r.message)||void 0===e?void 0:e.includes("no longer in range")))try{await async function(e){return new Promise(((t,i)=>{const n=setTimeout((()=>{r.abort(),i(new s)}),5e3),r=new AbortController;e.addEventListener("advertisementreceived",(()=>{clearTimeout(n),r.abort(),t()})),e.watchAdvertisements({signal:r.signal}).catch((e=>i(e)))}))}(this._device),await i.connect(),r=void 0}catch(e){e instanceof s||(r=e)}if(r)throw t._notifyConnectionEvent("disconnected"),r}this._notifyConnectionEvent("connected");const r=await i.getPrimaryService(n.PixelBleUuids.service);this._notify=await r.getCharacteristic(n.PixelBleUuids.notifyCharacteristic),this._write=await r.getCharacteristic(n.PixelBleUuids.writeCharacteristic)}this._notifyConnectionEvent("ready")}async disconnect(){var e;null===(e=this._device.gatt)||void 0===e||e.disconnect()}async subscribe(e){if(!this._notify)throw new a("Not connected");function t(){var t,i;(null===(i=null===(t=this.value)||void 0===t?void 0:t.buffer)||void 0===i?void 0:i.byteLength)&&e(this.value)}const i=this._notify;return i.addEventListener("characteristicvaluechanged",t),await i.startNotifications(),()=>{i.removeEventListener("characteristicvaluechanged",t)}}async writeValue(e,t,i){if(!this._write)throw new a("Not connected");t?await this._write.writeValueWithoutResponse(e):await this._write.writeValueWithResponse(e)}}t.default=c},494:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PixelsDevices=void 0;const n=i(754),r=new Map;t.PixelsDevices={async requestDevice(){var e;if(!(null===(e=null===navigator||void 0===navigator?void 0:navigator.bluetooth)||void 0===e?void 0:e.requestDevice))throw new Error("Bluetooth is not available, check that you're running in a secure environment and that Web Bluetooth is enabled.");const t=await navigator.bluetooth.requestDevice({filters:[{services:[n.PixelBleUuids.service]}]});return r.set(t.id,t),t},getKnownDevice:e=>r.get(e),async getDevice(e){var t;let i=r.get(e);return!i&&(null===(t=null===navigator||void 0===navigator?void 0:navigator.bluetooth)||void 0===t?void 0:t.getDevices)&&(i=(await navigator.bluetooth.getDevices()).find((t=>t.id===e)),i&&r.set(i.id,i)),i}}},872:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBluetoothCapabilities=void 0,t.getBluetoothCapabilities=function(){var e,t;return{bluetooth:!!(null===(e=null===navigator||void 0===navigator?void 0:navigator.bluetooth)||void 0===e?void 0:e.requestDevice),persistentPermissions:!!(null===(t=null===navigator||void 0===navigator?void 0:navigator.bluetooth)||void 0===t?void 0:t.getDevices)}}},368:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(754),t),r(i(749),t),r(i(695),t),r(i(872),t)},695:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getPixel=t.requestPixel=void 0;const r=i(754),o=n(i(554)),s=i(494),a=new Map;function c(e){let t=a.get(e.id);if(!t){const i=new o.default(e.id);t=new r.Pixel(i),a.set(e.id,t)}return t}t.requestPixel=async function(){return c(await s.PixelsDevices.requestDevice())},t.getPixel=async function(e){const t=a.get(e);if(t)return t;{const t=await s.PixelsDevices.getDevice(e);return t?c(t):void 0}}},749:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ActionMakeWebRequest:()=>ot,ActionPlayAnimation:()=>tt,ActionPlayAudioClip:()=>nt,ActionSpeakText:()=>at,ActionTypeValues:()=>Qe,AnimConstants:()=>p,AnimationBits:()=>N,AnimationCategoryValues:()=>l,AnimationCycle:()=>Y,AnimationFlagsValues:()=>c,AnimationGradient:()=>X,AnimationGradientPattern:()=>te,AnimationInstance:()=>K,AnimationInstanceGradient:()=>Z,AnimationInstanceGradientPattern:()=>Q,AnimationInstanceKeyframed:()=>ie,AnimationInstanceNoise:()=>se,AnimationInstanceNormals:()=>Fe,AnimationInstanceRainbow:()=>le,AnimationInstanceSequence:()=>ze,AnimationInstanceSimple:()=>pe,AnimationKeyframed:()=>re,AnimationNoise:()=>ce,AnimationNormals:()=>Ie,AnimationRainbow:()=>de,AnimationSequence:()=>Ee,AnimationSimple:()=>fe,AnimationTypeValues:()=>a,BatteryStateFlagsValues:()=>ut,Color:()=>z,Color32Utils:()=>n,ColorUtils:()=>r,ConditionBatteryState:()=>dt,ConditionConnectionState:()=>ft,ConditionCrooked:()=>Tt,ConditionFaceCompare:()=>gt,ConditionHandling:()=>kt,ConditionHelloGoodbye:()=>wt,ConditionIdle:()=>Ct,ConditionRolled:()=>Ot,ConditionRolling:()=>Bt,ConditionTypeValues:()=>ct,ConnectionStateFlagsValues:()=>ht,DataSet:()=>Rt,DiceUtils:()=>Ke,FaceCompareFlagsValues:()=>mt,GammaUtils:()=>o,HelloGoodbyeFlagsValues:()=>bt,NoiseColorOverrideTypeValues:()=>u,NormalsColorOverrideTypeValues:()=>d,PixelColorwayValues:()=>We,PixelDieTypeValues:()=>He,Profile:()=>Ze,RgbKeyframe:()=>je,RgbTrack:()=>Ve,Rule:()=>Xe,SimpleKeyframe:()=>$e,Track:()=>qe,VirtualDie:()=>Ne,facesMaskToValues:()=>Pe,getActionTypeDisplayName:()=>At,getAnimationTypeDisplayName:()=>St,getConditionTypeDisplayName:()=>Mt,getFaceCount:()=>ke,getFaceForLEDIndex:()=>we,getFaceMask:()=>Ce,getLEDCount:()=>_e,getTopFace:()=>Te});var n={};i.r(n),i.d(n,{combineColors:()=>b,faceWheel:()=>C,getBlue:()=>g,getGreen:()=>m,getRed:()=>y,interpolateColors:()=>w,interpolateIntensity:()=>T,modulateColor:()=>k,mulColors:()=>v,rainbowWheel:()=>_,toColor32:()=>f});var r={};i.r(r),i.d(r,{colorBytesToString:()=>S,colorComponentToByte:()=>A,colorToString:()=>M,desaturate:()=>R,hsvToRgb:()=>P,lerp:()=>D,rgbToHsv:()=>B,shiftHue:()=>x,sqrDistance:()=>F});var o={};i.r(o),i.d(o,{gamma:()=>L,gamma32:()=>j,gamma8:()=>E,reverseGamma:()=>$,reverseGamma8:()=>V});var s=i(48);const a={none:(0,s.GP)(0),simple:(0,s.GP)(),rainbow:(0,s.GP)(),keyframed:(0,s.GP)(),gradientPattern:(0,s.GP)(),gradient:(0,s.GP)(),noise:(0,s.GP)(),cycle:(0,s.GP)(),name:(0,s.GP)(),normals:(0,s.GP)(),sequence:(0,s.GP)()},c={none:0,traveling:(0,s.mU)(0),useLedIndices:(0,s.mU)()},l={system:(0,s.GP)(0),uniform:(0,s.GP)(),colorful:(0,s.GP)(),flashy:(0,s.GP)(),animated:(0,s.GP)()},u={none:(0,s.GP)(0),randomFromGradient:(0,s.GP)(),faceToGradient:(0,s.GP)(),faceToRainbowWheel:(0,s.GP)()},d={none:(0,s.GP)(0),faceToGradient:(0,s.GP)(),faceToRainbowWheel:(0,s.GP)()},p={maxLEDsCount:22,paletteColorFromFace:127,paletteColorFromRandom:126,faceMaskAll:4294967295,keyframeTimeResolutionMs:2,currentFaceIndex:-1};function h(e){const t=e%4;return e+(t?4-t:0)}function f(e,t=0,i=0){return"number"!=typeof e&&(t=255*e.g,i=255*e.b,e=255*e.r),e<<16|t<<8|255&i}function y(e){return e>>16&255}function m(e){return e>>8&255}function g(e){return 255&e}function v(e,t){return f(y(e)*y(t)/255,m(e)*m(t)/255,g(e)*g(t)/255)}function b(e,t){return f(Math.max(y(e),y(t)),Math.max(m(e),m(t)),Math.max(g(e),g(t)))}function w(e,t,i,n,r){const o=1024,s=(r-t)*o/(n-t);return f((y(e)*(o-s)+y(i)*s)/o,(m(e)*(o-s)+m(i)*s)/o,(g(e)*(o-s)+g(i)*s)/o)}function T(e,t,i,n,r){const o=1024,s=(r-t)*o/(n-t);return Math.floor((e*(o-s)+i*s)/o)}function k(e,t){return f(y(e)*t/255,m(e)*t/255,g(e)*t/255)}function _(e,t=255){return e<85?f(3*e*t/255,(255-3*e)*t/255,0):e<170?f((255-3*(e-=85))*t/255,0,3*e*t/255):f(0,3*(e-=170)*t/255,(255-3*e)*t/255)}function C(e,t){return _(256*e/t)}function P({h:e,s:t,v:i}){const n=Math.floor(6*e),r=6*e-n,o=i*(1-t),s=i*(1-r*t),a=i*(1-(1-r)*t);switch(n%6){case 0:return{r:i,g:a,b:o};case 1:return{r:s,g:i,b:o};case 2:return{r:o,g:i,b:a};case 3:return{r:o,g:s,b:i};case 4:return{r:a,g:o,b:i};case 5:return{r:i,g:o,b:s};default:return{r:0,g:0,b:0}}}function B({r:e,g:t,b:i}){const n=Math.max(e,t,i),r=n-Math.min(e,t,i);if(0===r)return{h:0,s:0,v:0};{let o=0;switch(n){case e:o=(t-i)/r+(t<i?6:0);break;case t:o=(i-e)/r+2;break;case i:o=(e-t)/r+4}return{h:o/6,s:r/n,v:n}}}function x({r:e,g:t,b:i},n){const r=B({r:e,g:t,b:i});return r.h=(r.h+n)%1,P(r)}function O(e){return e.toString(16).padStart(2,"0")}function S(e,t,i){return"#"+O(e)+O(t)+O(i)}function A(e){return Math.round(255*Math.min(1,Math.max(0,e)))}function M({r:e,g:t,b:i}){return S(A(e),A(t),A(i))}function R(e){return.5*(Math.min(e.r,Math.min(e.g,e.b))+Math.max(e.r,Math.max(e.g,e.b)))}function F(e,t){const i=e.r-t.r,n=e.g-t.g,r=e.b-t.b;return i*i+n*n+r*r}function D(e,t,i){return i=Math.min(1,Math.max(0,i)),{r:e.r+(t.r-e.r)*i,g:e.g+(t.g-e.g)*i,b:e.b+(t.b-e.b)*i}}class I{get rByte(){return A(this.r)}get gByte(){return A(this.g)}get bByte(){return A(this.b)}constructor(e,t,i){this.r=0,this.g=0,this.b=0,void 0!==e&&("string"==typeof e?this.setWithHex(e):"object"==typeof e?this.set(e.r,e.g,e.b):void 0===t?this.setWithValue(e):this.set(e,t,null!=i?i:0))}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}assign(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}duplicate(){return new I(this.r,this.g,this.b)}desaturate(){return R(this)}serialize(e,t=0){return e.setUint8(t++,this.rByte),e.setUint8(t++,this.gByte),e.setUint8(t++,this.bByte),[e,t]}toString(){return M(this)}toColor32(){return f(this)}set(e,t,i){return this.r=e,this.g=t,this.b=i,this}setWithBytes(e,t,i){return this.r=e/255,this.g=t/255,this.b=i/255,this}setWithValue(e){return this.setWithBytes(y(e),m(e),g(e)),this}setWithHex(e){if(e.length){const t="#"===e[0]?1:0;if(e.length===3+t)this.set(parseInt(e[t],16)/255,parseInt(e[t+1],16)/255,parseInt(e[t+2],16)/255);else{if(e.length!==6+t)throw new Error(`Invalid hexadecimal color: ${e}`);this.setWithValue(parseInt(t?e.slice(t):e,16))}}return this}static fromBytes(e,t,i){return(new I).setWithBytes(e,t,i)}static fromString(e){return(new I).setWithHex(e)}static lerp(e,t,i){return new I(D(e,t,i))}}I.black=Object.freeze(new I(0,0,0)),I.brightRed=Object.freeze(new I(1,0,0)),I.brightGreen=Object.freeze(new I(0,1,0)),I.brightBlue=Object.freeze(new I(0,0,1)),I.brightWhite=Object.freeze(new I(1,1,1)),I.brightCyan=Object.freeze(new I(0,1,1)),I.brightMagenta=Object.freeze(new I(1,0,1)),I.brightYellow=Object.freeze(new I(1,1,0)),I.brightOrange=Object.freeze(new I(1,.647,0)),I.brightPurple=Object.freeze(new I(.5,0,1)),I.red=Object.freeze(new I(.7,0,0)),I.green=Object.freeze(new I(0,.7,0)),I.blue=Object.freeze(new I(0,0,.7)),I.white=Object.freeze(new I(.7,.7,.7)),I.cyan=Object.freeze(new I(0,.7,.7)),I.magenta=Object.freeze(new I(.7,0,.7)),I.yellow=Object.freeze(new I(.7,.6,.01)),I.orange=Object.freeze(new I(.7,.453,0)),I.mediumWhite=Object.freeze(new I(.5,.5,.5)),I.faintWhite=Object.freeze(new I(.1,.1,.1)),I.dimRed=Object.freeze(new I(.35,0,0)),I.dimGreen=Object.freeze(new I(0,.35,0)),I.dimBlue=Object.freeze(new I(0,0,.35)),I.dimWhite=Object.freeze(new I(.35,.35,.35)),I.dimCyan=Object.freeze(new I(0,.35,.35)),I.dimMagenta=Object.freeze(new I(.35,0,.35)),I.dimYellow=Object.freeze(new I(.35,.3,.005)),I.dimOrange=Object.freeze(new I(.35,.226,0));const z=I;function G(e){return e<0?0:e>255?255:Math.floor(e)}function E(e){return U[G(e)]}function j(e){return f(E(y(e)),E(m(e)),E(g(e)))}function L(e){const t=E(e.rByte),i=E(e.gByte),n=E(e.bByte);return z.fromBytes(t,i,n)}function V(e){return q[G(e)]}function $(e){const t=V(e.rByte),i=V(e.gByte),n=V(e.bByte);return z.fromBytes(t,i,n)}const U=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,4,4,4,4,4,5,5,5,5,6,6,6,6,6,7,7,7,8,8,8,8,9,9,9,10,10,10,11,11,12,12,12,13,13,14,14,14,15,15,16,16,17,17,18,18,19,19,20,20,21,22,22,23,23,24,25,25,26,27,27,28,29,29,30,31,32,32,33,34,35,35,36,37,38,39,40,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,61,62,63,64,65,67,68,69,70,72,73,74,76,77,78,80,81,82,84,85,87,88,90,91,93,94,96,97,99,101,102,104,105,107,109,111,112,114,116,118,119,121,123,125,127,129,131,132,134,136,138,140,142,144,147,149,151,153,155,157,159,162,164,166,168,171,173,175,178,180,182,185,187,190,192,195,197,200,202,205,207,210,213,215,218,221,223,226,229,232,235,237,240,243,246,249,252,255],q=[0,70,80,87,92,97,101,105,108,112,114,117,119,122,124,126,128,130,132,134,135,137,138,140,141,143,144,146,147,148,149,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,170,171,172,173,174,174,175,176,177,177,178,179,180,180,181,182,182,183,184,184,185,186,186,187,188,188,189,189,190,191,191,192,192,193,194,194,195,195,196,196,197,197,198,198,199,200,200,201,201,202,202,203,203,204,204,204,205,205,206,206,207,207,208,208,209,209,210,210,210,211,211,212,212,213,213,214,214,214,215,215,216,216,216,217,217,218,218,218,219,219,220,220,220,221,221,222,222,222,223,223,223,224,224,224,225,225,226,226,226,227,227,227,228,228,228,229,229,229,230,230,230,231,231,231,232,232,232,233,233,233,234,234,234,235,235,235,236,236,236,237,237,237,237,238,238,238,239,239,239,240,240,240,241,241,241,241,242,242,242,243,243,243,243,244,244,244,245,245,245,245,246,246,246,247,247,247,247,248,248,248,248,249,249,249,249,250,250,250,251,251,251,251,252,252,252,252,253,253,253,253,254,254,254,254,255];class N{constructor(){this.palette=[],this.rgbKeyframes=[],this.rgbTracks=[],this.keyframes=[],this.tracks=[],this.animations=[]}getColor32(e,t){return f(this.getColor(e,t))}getColor(e,t){return e===p.paletteColorFromFace?new z(C(t.currentFace,t.ledCount)):e===p.paletteColorFromRandom?z.black:this.getArrayItem(this.palette,e,"color")}getPaletteSize(){return 3*this.palette.length}getRgbKeyframe(e){return this.getArrayItem(this.rgbKeyframes,e,"rgb keyframe")}getRgbKeyframeCount(){return this.rgbKeyframes.length}getKeyframe(e){return this.getArrayItem(this.keyframes,e,"keyframe")}getKeyframeCount(){return this.keyframes.length}getRgbTrack(e){return this.getArrayItem(this.rgbTracks,e,"rgb track")}getRgbTrackCount(){return this.rgbTracks.length}getTrack(e){return this.getArrayItem(this.tracks,e,"track")}getTrackCount(){return this.tracks.length}getAnimation(e){return this.getArrayItem(this.animations,e,"animation")}getAnimationCount(){return this.animations.length}computeDataSize(){return h(3*this.palette.length)+(0,s.iR)(this.rgbKeyframes)+(0,s.iR)(this.rgbTracks)+(0,s.iR)(this.keyframes)+(0,s.iR)(this.tracks)}serialize(e,t=0){for(const i of this.palette)[e,t]=i.serialize(e,t);return t=h(t),[e,t]=(0,s.qC)(this.rgbKeyframes,{dataView:e,byteOffset:t}),[e,t]=(0,s.qC)(this.rgbTracks,{dataView:e,byteOffset:t}),[e,t]=(0,s.qC)(this.keyframes,{dataView:e,byteOffset:t}),[e,t]=(0,s.qC)(this.tracks,{dataView:e,byteOffset:t}),[e,t]}getArrayItem(e,t,i){const n=e[t];if(void 0===n)throw t<0||t>=e.length?new Error(`Out of bound index for AnimationBits.${i}, got ${t} but array has ${e.length} item(s)`):new Error(`No item for AnimationBits.${i} at index ${t}`);return n}}class K{get startTime(){return this._startTime}get duration(){return this._animationPreset.duration}get animationPreset(){return this._animationPreset}get bits(){return this._animationBits}get die(){return this._virtualDie}constructor(e,t,i){this._startTime=0,this._animationPreset=e,this._animationBits=t,this._virtualDie=i}start(e){this._startTime=e}setIndices(e,t){const i=this._virtualDie.ledCount;let n=0;for(let r=0;r<i;++r)0!=(e&1<<r)&&(t[n]=r,n++);return n}setColor(e,t,i,n){const r=this._virtualDie.ledCount;let o=0;for(let s=0;s<r;++s)0!=(t&1<<s)&&(i[o]=s,n[o]=e,o++);return o}}class W extends K{get preset(){return this.animationPreset}updateLEDs(e,t,i){const n=this.preset,r=this.die.ledCount,o=e-this.startTime,s=n.duration*n.fade/510;let a=n.intensity;o<=s?a=o*n.intensity/s:o>=n.duration-s&&(a=(n.duration-o)*n.intensity/s);const c=this.bits.getRgbTrack(n.gradientTrackOffset),l=o*n.count*1e3/n.duration;let u=0;for(let e=0;e<r;++e)if(0!=(n.faceMask&1<<e)){t[u]=e;const o=(l+1e3*e*n.cyclesTimes10/(10*r))%1e3;i[u]=k(c.evaluateColor(o,this.bits,this.die),a),u++}return u}stop(e){const t=this.die.ledCount,i=this.preset;let n=0;for(let r=0;r<t;++r)0!=(i.faceMask&1<<r)&&(e[n]=r,n++);return n}}var H=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class Y{constructor(){this.type=a.cycle,this.animFlags=0,this.duration=0,this.faceMask=0,this.count=0,this.fade=0,this.intensity=128,this.cyclesTimes10=10,this.gradientTrackOffset=0}createInstance(e,t){return new W(this,e,t)}}H([(0,s.Bg)(1)],Y.prototype,"type",void 0),H([(0,s.Bg)(1)],Y.prototype,"animFlags",void 0),H([(0,s.Bg)(2)],Y.prototype,"duration",void 0),H([(0,s.Bg)(4)],Y.prototype,"faceMask",void 0),H([(0,s.Bg)(1)],Y.prototype,"count",void 0),H([(0,s.Bg)(1)],Y.prototype,"fade",void 0),H([(0,s.Bg)(1)],Y.prototype,"intensity",void 0),H([(0,s.Bg)(1)],Y.prototype,"cyclesTimes10",void 0),H([(0,s.Bg)(2)],Y.prototype,"gradientTrackOffset",void 0);class Z extends K{get preset(){return this.animationPreset}updateLEDs(e,t,i){const n=this.preset,r=e-this.startTime,o=this.bits.getRgbTrack(n.gradientTrackOffset),s=1e3*r/n.duration,a=o.evaluateColor(s,this.bits,this.die);return this.setColor(a,n.faceMask,t,i)}stop(e){return this.setIndices(this.preset.faceMask,e)}}var J=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class X{constructor(){this.type=a.gradient,this.animFlags=0,this.duration=0,this.faceMask=0,this.gradientTrackOffset=0}createInstance(e,t){return new Z(this,e,t)}}J([(0,s.Bg)(1)],X.prototype,"type",void 0),J([(0,s.Bg)(1)],X.prototype,"animFlags",void 0),J([(0,s.Bg)(2)],X.prototype,"duration",void 0),J([(0,s.Bg)(4)],X.prototype,"faceMask",void 0),J([(0,s.Bg)(2,{padding:2})],X.prototype,"gradientTrackOffset",void 0);class Q extends K{constructor(){super(...arguments),this._rgb=0}get preset(){return this.animationPreset}start(e){super.start(e),this.preset.overrideWithFace&&(this._rgb=this.bits.getColor32(p.paletteColorFromFace,this.die))}updateLEDs(e,t,i){const n=this.preset,r=this.die.ledCount,o=1e3*(e-this.startTime)/n.duration,s=this.bits.getRgbTrack(n.gradientTrackOffset);let a=0;a=n.overrideWithFace?this._rgb:s.evaluateColor(o,this.bits,this.die);let c=0;const l=[],u=[];for(let e=0;e<n.trackCount;++e){const s=this.bits.getTrack(n.tracksOffset+e).evaluate(this.bits,a,o,r,l,u);for(let e=0;e<s;++e)t[c+e]=l[e],i[c+e]=u[e];c+=s}return c}stop(e){const t=this.preset;let i=0;const n=[];for(let r=0;r<t.trackCount;++r){const o=this.bits.getRgbTrack(t.tracksOffset+r).extractLEDIndices(n);for(let t=0;t<o;++t)e[i+t]=n[t];i+=o}return i}}var ee=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class te{constructor(){this.type=a.gradientPattern,this.animFlags=0,this.duration=0,this.tracksOffset=0,this.trackCount=0,this.gradientTrackOffset=0,this.overrideWithFace=!1}createInstance(e,t){return new Q(this,e,t)}}ee([(0,s.Bg)(1)],te.prototype,"type",void 0),ee([(0,s.Bg)(1)],te.prototype,"animFlags",void 0),ee([(0,s.Bg)(2)],te.prototype,"duration",void 0),ee([(0,s.Bg)(2)],te.prototype,"tracksOffset",void 0),ee([(0,s.Bg)(2)],te.prototype,"trackCount",void 0),ee([(0,s.Bg)(2)],te.prototype,"gradientTrackOffset",void 0),ee([(0,s.Bg)(1,{padding:1})],te.prototype,"overrideWithFace",void 0);class ie extends K{get preset(){return this.animationPreset}updateLEDs(e,t,i){const n=this.preset,r=1e3*(e-this.startTime)/n.duration;let o=0;const s=[],a=[];for(let e=0;e<n.trackCount;++e){const c=this.bits.getRgbTrack(n.tracksOffset+e).evaluate(r,this.bits,this.die,s,a);for(let e=0;e<c;++e)t[o+e]=s[e],i[o+e]=a[e];o+=c}return o}stop(e){const t=this.preset;let i=0;const n=[];for(let r=0;r<t.trackCount;++r){const o=this.bits.getRgbTrack(t.tracksOffset+r).extractLEDIndices(n);for(let t=0;t<o;++t)e[i+t]=n[t];i+=o}return i}}var ne=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class re{constructor(){this.type=a.keyframed,this.animFlags=0,this.duration=0,this.tracksOffset=0,this.trackCount=0}createInstance(e,t){return new ie(this,e,t)}}function oe(){return Math.floor(4294967295*Math.random())}ne([(0,s.Bg)(1)],re.prototype,"type",void 0),ne([(0,s.Bg)(1)],re.prototype,"animFlags",void 0),ne([(0,s.Bg)(2)],re.prototype,"duration",void 0),ne([(0,s.Bg)(2)],re.prototype,"tracksOffset",void 0),ne([(0,s.Bg)(2)],re.prototype,"trackCount",void 0);class se extends K{constructor(){super(...arguments),this.nextBlinkTime=0,this.blinkStartTimes=[],this.blinkDurations=[],this.blinkColors=[],this.blinkInterValMinMs=0,this.blinkInterValDeltaMs=0,this.baseColorParam=0}get preset(){return this.animationPreset}start(e){super.start(e);const t=this.preset;this.blinkInterValMinMs=1e6/(t.blinkFrequencyTimes1000+t.blinkFrequencyVarTimes1000);const i=1e6/(t.blinkFrequencyTimes1000-t.blinkFrequencyVarTimes1000);this.blinkInterValDeltaMs=Math.max(i-this.blinkInterValMinMs,1);for(let e=0;e<p.maxLEDsCount;e++)this.blinkStartTimes[e]=0,this.blinkDurations[e]=0;this.nextBlinkTime=e+this.blinkInterValMinMs+oe()%this.blinkInterValDeltaMs,this.baseColorParam=function(e,t){switch(e){case u.faceToGradient:return 1e3*t.currentFace/t.faceCount;case u.faceToRainbowWheel:return 256*t.currentFace/t.faceCount;case u.randomFromGradient:case u.none:default:return 0}}(t.gradientColorType,this.die)}updateLEDs(e,t,i){const n=this.preset,r=this.die.ledCount,o=e-this.startTime,s=n.duration*n.fade/510,a=this.bits.getRgbTrack(n.gradientTrackOffset),c=this.bits.getRgbTrack(n.blinkTrackOffset);let l=255;if(o<=s?l=255*o/s:o>=n.duration-s&&(l=255*(n.duration-o)/s),e>=this.nextBlinkTime){let t=oe()%r;for(let e=0;0!==this.blinkDurations[t]&&e<5;++e)t=oe()%r;this.blinkDurations[t]=n.blinkDuration,this.blinkStartTimes[t]=e;let i=0;switch(n.gradientColorType){case u.randomFromGradient:i=a.evaluateColor(oe()%1e3,this.bits,this.die);break;case u.faceToGradient:{const e=Math.floor(oe()%Math.max(1,2*n.gradientColorVar))-n.gradientColorVar;let t=this.baseColorParam+e;t<0?t=0:t>1e3&&(t=1e3),i=a.evaluateColor(t,this.bits,this.die)}break;case u.faceToRainbowWheel:{const e=Math.floor(oe()%Math.max(1,2*n.gradientColorVar))-n.gradientColorVar;i=_(this.baseColorParam+255*e/1e3)}break;case u.none:default:{const e=1e3*o/n.duration;i=a.evaluateColor(e,this.bits,this.die)}}this.blinkColors[t]=i,this.nextBlinkTime=e+this.blinkInterValMinMs+oe()%this.blinkInterValDeltaMs}let d=0;for(let n=0;n<r;++n)if(this.blinkDurations[n]>0){const r=e-this.blinkStartTimes[n];if(r>this.blinkDurations[n])t[d]=n,i[d]=0,d++,this.blinkDurations[n]=0,this.blinkStartTimes[n]=0;else{const e=1e3*r/this.blinkDurations[n],o=c.evaluateColor(e,this.bits,this.die);t[d]=n,i[d]=k(v(this.blinkColors[n],o),l),d++}}return d}stop(e){return this.setIndices(p.faceMaskAll,e)}}var ae=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class ce{constructor(){this.type=a.noise,this.animFlags=0,this.duration=0,this.gradientTrackOffset=0,this.blinkTrackOffset=0,this.blinkFrequencyTimes1000=0,this.blinkFrequencyVarTimes1000=0,this.blinkDuration=0,this.fade=0,this.gradientColorType=u.none,this.gradientColorVar=0}createInstance(e,t){return new se(this,e,t)}}ae([(0,s.Bg)(1)],ce.prototype,"type",void 0),ae([(0,s.Bg)(1)],ce.prototype,"animFlags",void 0),ae([(0,s.Bg)(2)],ce.prototype,"duration",void 0),ae([(0,s.Bg)(2)],ce.prototype,"gradientTrackOffset",void 0),ae([(0,s.Bg)(2)],ce.prototype,"blinkTrackOffset",void 0),ae([(0,s.Bg)(2)],ce.prototype,"blinkFrequencyTimes1000",void 0),ae([(0,s.Bg)(2)],ce.prototype,"blinkFrequencyVarTimes1000",void 0),ae([(0,s.Bg)(2)],ce.prototype,"blinkDuration",void 0),ae([(0,s.Bg)(1)],ce.prototype,"fade",void 0),ae([(0,s.Bg)(1)],ce.prototype,"gradientColorType",void 0),ae([(0,s.Bg)(2)],ce.prototype,"gradientColorVar",void 0);class le extends K{get preset(){return this.animationPreset}updateLEDs(e,t,i){const n=this.preset,r=this.die.ledCount;let o=0;const s=n.duration*n.fade/510,a=e-this.startTime,l=a*n.count*255/n.duration%256;let u=n.intensity;a<=s?u=a*n.intensity/s:a>=n.duration-s&&(u=(n.duration-a)*n.intensity/s);let d=0;if(n.animFlags&c.traveling)for(let e=0;e<r;++e)0!=(n.faceMask&1<<e)&&(t[d]=e,i[d]=_((l+256*e*n.cyclesTimes10/(10*r))%256,u),d++);else o=_(l,u),d=this.setColor(o,n.faceMask,t,i);return d}stop(e){return this.setIndices(this.preset.faceMask,e)}}var ue=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class de{constructor(){this.type=a.rainbow,this.animFlags=0,this.duration=0,this.faceMask=0,this.count=0,this.fade=0,this.intensity=128,this.cyclesTimes10=10}createInstance(e,t){return new le(this,e,t)}}ue([(0,s.Bg)(1)],de.prototype,"type",void 0),ue([(0,s.Bg)(1)],de.prototype,"animFlags",void 0),ue([(0,s.Bg)(2)],de.prototype,"duration",void 0),ue([(0,s.Bg)(4)],de.prototype,"faceMask",void 0),ue([(0,s.Bg)(1)],de.prototype,"count",void 0),ue([(0,s.Bg)(1)],de.prototype,"fade",void 0),ue([(0,s.Bg)(1)],de.prototype,"intensity",void 0),ue([(0,s.Bg)(1)],de.prototype,"cyclesTimes10",void 0);class pe extends K{constructor(){super(...arguments),this._rgb=0}get preset(){return this.animationPreset}start(e){super.start(e),this._rgb=this.bits.getColor32(this.preset.colorIndex,this.die)}updateLEDs(e,t,i){const n=this.preset;let r=0;const o=n.duration/n.count,s=o*n.fade/510,a=(o-2*s)/2,c=(e-this.startTime)%o;return r=c<=s?w(0,0,this._rgb,s,c):c<=s+a?this._rgb:c<=2*s+a?w(this._rgb,s+a,0,2*s+a,c):0,this.setColor(r,n.faceMask,t,i)}stop(e){return this.setIndices(this.preset.faceMask,e)}}var he=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class fe{constructor(){this.type=a.simple,this.animFlags=0,this.duration=0,this.faceMask=0,this.colorIndex=0,this.count=0,this.fade=0}createInstance(e,t){return new pe(this,e,t)}}function ye(e=0,t=0,i=0){return{xTimes1000:1e3*e,yTimes1000:1e3*t,zTimes1000:1e3*i}}function me(e){const t=function(e){return Math.sqrt(1e3*function(e){return(e.xTimes1000*e.xTimes1000+e.yTimes1000*e.yTimes1000+e.zTimes1000*e.zTimes1000)/1e3}(e))}(e);e.xTimes1000=1e3*e.xTimes1000/t,e.yTimes1000=1e3*e.yTimes1000/t,e.zTimes1000=1e3*e.zTimes1000/t}function ge(e,t){return(e.xTimes1000*t.xTimes1000+e.yTimes1000*t.yTimes1000+e.zTimes1000*t.zTimes1000)/1e3}function ve(e,t){return{xTimes1000:(e.yTimes1000*t.zTimes1000-e.zTimes1000*t.yTimes1000)/1e3,yTimes1000:(e.zTimes1000*t.xTimes1000-e.xTimes1000*t.zTimes1000)/1e3,zTimes1000:(e.xTimes1000*t.yTimes1000-e.yTimes1000*t.xTimes1000)/1e3}}function be(e,t){return{xTimes1000:e.xTimes1000-t.xTimes1000,yTimes1000:e.yTimes1000-t.yTimes1000,zTimes1000:e.zTimes1000-t.zTimes1000}}function we(e,t){return"d6pipped"===e?0===t?0:t<=4?3:t<=6?1:t<=9?2:t<=14?4:5:t}function Te(e){switch(e){case"unknown":case"d10":case"d00":return 0;case"d20":return 19;case"d12":return 11;case"d8":return 7;default:return 5}}function ke(e){switch(e){case"unknown":return 0;case"d20":return 20;case"d12":return 12;case"d10":case"d00":return 10;case"d8":return 8;default:return 6}}function _e(e){switch(e){case"unknown":return 0;case"d20":return 20;case"d12":return 12;case"d10":case"d00":return 10;case"d8":return 8;case"d6pipped":return 21;default:return 6}}function Ce(e,t){if("number"==typeof e)switch(t){case"d4":switch(e){case 1:break;case 2:case 3:++e;break;default:e=6}break;case"d6pipped":return function(e){let t=0;for(let i=1;i<e;++i)t+=i;const i=Array(e);for(let n=t;n<t+e;++n)i[n-t]=(0,s.Fn)(n);return(0,s.tg)(i)}(e);case"d10":case"unknown":++e;break;case"d00":e=1+Math.round(e/10)}if("number"==typeof e){const i=e;return(0,s.hu)(i>0&&i<=32,`getFaceMask: Face value is out of range [1, 32], got ${i} for type ${t}`),1<<i-1>>>0}return e.reduce(((e,i)=>Ce(i,t)|e),0)}function Pe(e){return(0,s.YJ)(e).map((e=>e+1))}he([(0,s.Bg)(1)],fe.prototype,"type",void 0),he([(0,s.Bg)(1)],fe.prototype,"animFlags",void 0),he([(0,s.Bg)(2)],fe.prototype,"duration",void 0),he([(0,s.Bg)(4)],fe.prototype,"faceMask",void 0),he([(0,s.Bg)(2)],fe.prototype,"colorIndex",void 0),he([(0,s.Bg)(1)],fe.prototype,"count",void 0),he([(0,s.Bg)(1)],fe.prototype,"fade",void 0);const Be=[{xTimes1000:-335,yTimes1000:937,zTimes1000:-92},{xTimes1000:-352,yTimes1000:-930,zTimes1000:-98},{xTimes1000:716,yTimes1000:572,zTimes1000:-399},{xTimes1000:-253,yTimes1000:-357,zTimes1000:898},{xTimes1000:-995,yTimes1000:8,zTimes1000:93},{xTimes1000:804,yTimes1000:-9,zTimes1000:593},{xTimes1000:-396,yTimes1000:583,zTimes1000:-708},{xTimes1000:705,yTimes1000:-582,zTimes1000:-403},{xTimes1000:407,yTimes1000:571,zTimes1000:712},{xTimes1000:246,yTimes1000:-355,zTimes1000:-901},{xTimes1000:-246,yTimes1000:355,zTimes1000:901},{xTimes1000:-407,yTimes1000:-571,zTimes1000:-712},{xTimes1000:-705,yTimes1000:582,zTimes1000:403},{xTimes1000:396,yTimes1000:-583,zTimes1000:708},{xTimes1000:-804,yTimes1000:9,zTimes1000:-593},{xTimes1000:995,yTimes1000:-8,zTimes1000:-93},{xTimes1000:253,yTimes1000:357,zTimes1000:-898},{xTimes1000:-716,yTimes1000:-572,zTimes1000:399},{xTimes1000:352,yTimes1000:930,zTimes1000:98},{xTimes1000:335,yTimes1000:-937,zTimes1000:92}],xe=[{xTimes1000:-446,yTimes1000:850,zTimes1000:-276},{xTimes1000:-447,yTimes1000:525,zTimes1000:723},{xTimes1000:-447,yTimes1000:-850,zTimes1000:-276},{xTimes1000:-1e3,yTimes1000:0,zTimes1000:-0},{xTimes1000:447,yTimes1000:525,zTimes1000:-723},{xTimes1000:-447,yTimes1000:0,zTimes1000:-894},{xTimes1000:447,yTimes1000:-0,zTimes1000:894},{xTimes1000:-447,yTimes1000:-525,zTimes1000:723},{xTimes1000:1e3,yTimes1000:-0,zTimes1000:0},{xTimes1000:447,yTimes1000:850,zTimes1000:276},{xTimes1000:447,yTimes1000:-525,zTimes1000:-723},{xTimes1000:446,yTimes1000:-850,zTimes1000:276}],Oe=[{xTimes1000:-65,yTimes1000:996,zTimes1000:55},{xTimes1000:165,yTimes1000:-617,zTimes1000:768},{xTimes1000:489,yTimes1000:-8,zTimes1000:-871},{xTimes1000:-993,yTimes1000:17,zTimes1000:111},{xTimes1000:650,yTimes1000:603,zTimes1000:461},{xTimes1000:-650,yTimes1000:-603,zTimes1000:-461},{xTimes1000:993,yTimes1000:-17,zTimes1000:-111},{xTimes1000:-489,yTimes1000:8,zTimes1000:871},{xTimes1000:-165,yTimes1000:617,zTimes1000:-768},{xTimes1000:65,yTimes1000:-996,zTimes1000:-55}],Se=[{xTimes1000:-921,yTimes1000:-198,zTimes1000:-333},{xTimes1000:288,yTimes1000:897,zTimes1000:-333},{xTimes1000:-0,yTimes1000:0,zTimes1000:-1e3},{xTimes1000:-633,yTimes1000:698,zTimes1000:333},{xTimes1000:633,yTimes1000:-698,zTimes1000:-333},{xTimes1000:0,yTimes1000:-0,zTimes1000:1e3},{xTimes1000:-288,yTimes1000:-897,zTimes1000:333},{xTimes1000:921,yTimes1000:198,zTimes1000:333}],Ae=[{xTimes1000:-1e3,yTimes1000:0,zTimes1000:0},{xTimes1000:0,yTimes1000:1e3,zTimes1000:0},{xTimes1000:0,yTimes1000:0,zTimes1000:1e3},{xTimes1000:0,yTimes1000:0,zTimes1000:-1e3},{xTimes1000:0,yTimes1000:-1e3,zTimes1000:0},{xTimes1000:1e3,yTimes1000:0,zTimes1000:0}],Me=[63,68,70,72,73,75,76,77,78,79,79,80,81,82,82,83,84,84,85,86,86,87,87,88,89,89,90,90,91,91,92,92,93,93,94,94,95,95,95,96,96,97,97,98,98,98,99,99,100,100,100,101,101,102,102,102,103,103,104,104,104,105,105,105,106,106,107,107,107,108,108,108,109,109,109,110,110,110,111,111,112,112,112,113,113,113,114,114,114,115,115,115,116,116,116,117,117,117,118,118,118,119,119,119,119,120,120,120,121,121,121,122,122,122,123,123,123,124,124,124,125,125,125,126,126,126,127,127,127,127,128,128,128,129,129,129,130,130,130,131,131,131,132,132,132,133,133,133,134,134,134,135,135,135,135,136,136,136,137,137,137,138,138,138,139,139,139,140,140,140,141,141,141,142,142,142,143,143,144,144,144,145,145,145,146,146,146,147,147,147,148,148,149,149,149,150,150,150,151,151,152,152,152,153,153,154,154,154,155,155,156,156,156,157,157,158,158,159,159,159,160,160,161,161,162,162,163,163,164,164,165,165,166,167,167,168,168,169,170,170,171,172,172,173,174,175,175,176,177,178,179,181,182,184,186,191];function Re(e){return 64+Me[255&e]}class Fe extends K{constructor(){super(...arguments),this.normals=[],this.faceNormal=ye(),this.backVector=ye(),this.baseColorParam=0}get preset(){return this.animationPreset}start(e){super.start(e);const t=this.preset,i=this.die.faceCount;this.normals=function(e){switch(e){case"d20":return Be;case"d12":return xe;case"d10":case"d00":return Oe;case"d8":return Se;default:return Ae}}(this.die.dieType);const n=this.die.topFace;this.faceNormal=this.normals[n];let r=1,o=this.normals[(n+r)%i];for(;Math.abs(ge(this.faceNormal,o))>800&&r<i;)r+=1,o=Object.assign({},this.normals[(n+r)%i]);const s=ve(this.faceNormal,o);switch(me(s),this.backVector=ve(s,this.faceNormal),t.mainGradientColorType){case d.faceToGradient:this.baseColorParam=1e3*this.die.currentFace/i;break;case d.faceToRainbowWheel:this.baseColorParam=256*this.die.currentFace/i;break;case d.none:default:this.baseColorParam=0}}updateLEDs(e,t,i){const n=this.preset,r=this.die.ledCount,o=e-this.startTime,s=n.duration*n.fade/510;let a=255;o<=s?a=255*o/s:o>=n.duration-s&&(a=255*(n.duration-o)/s);const c=o*n.axisScrollSpeedTimes1000/n.duration,l=o*n.angleScrollSpeedTimes1000/n.duration,u=1e3*o/n.duration,p=this.bits.getRgbTrack(n.gradientTrackOffset),h=this.bits.getRgbTrack(n.axisGradientTrackOffset),f=this.bits.getRgbTrack(n.angleGradientTrackOffset);for(let e=0;e<r;++e){const r=we(this.die.dieType,e),o=ge(this.faceNormal,this.normals[r]),s=1e3*(Re((1275*o+1275e3)/1e4)-128)/128,g=1e3*s/n.axisScaleTimes1000+n.axisOffsetTimes1000+c,b=h.evaluateColor(g,this.bits,this.die),w=be(this.normals[r],(m=o,{xTimes1000:(y=this.faceNormal).xTimes1000*m/1e3,yTimes1000:y.yTimes1000*m/1e3,zTimes1000:y.zTimes1000*m/1e3}));me(w);let T=Re((1275*ge(this.backVector,w)+1275e3)/1e4);ge(ve(this.backVector,this.normals[r]),this.faceNormal)<0&&(T=255-T);const C=((1e3*(T-128)/128+1e3)/2+l)%1e3,P=f.evaluateColor(C,this.bits,this.die);let B=0;switch(n.mainGradientColorType){case d.faceToGradient:{const e=this.baseColorParam+s*n.mainGradientColorVar/1e3;B=p.evaluateColor(e,this.bits,this.die)}break;case d.faceToRainbowWheel:B=_((this.baseColorParam+s*n.mainGradientColorVar*256/1e6)%256);break;case d.none:default:B=p.evaluateColor(u,this.bits,this.die)}t[e]=e,i[e]=k(v(B,v(b,P)),a)}var y,m;return r}stop(e){return this.setIndices(p.faceMaskAll,e)}}var De=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class Ie{constructor(){this.type=a.normals,this.animFlags=0,this.duration=0,this.gradientTrackOffset=0,this.axisGradientTrackOffset=0,this.angleGradientTrackOffset=0,this.axisScaleTimes1000=0,this.axisOffsetTimes1000=0,this.axisScrollSpeedTimes1000=0,this.angleScrollSpeedTimes1000=0,this.fade=0,this.mainGradientColorType=d.none,this.mainGradientColorVar=0}createInstance(e,t){return new Fe(this,e,t)}}De([(0,s.Bg)(1)],Ie.prototype,"type",void 0),De([(0,s.Bg)(1)],Ie.prototype,"animFlags",void 0),De([(0,s.Bg)(2)],Ie.prototype,"duration",void 0),De([(0,s.Bg)(2)],Ie.prototype,"gradientTrackOffset",void 0),De([(0,s.Bg)(2)],Ie.prototype,"axisGradientTrackOffset",void 0),De([(0,s.Bg)(2)],Ie.prototype,"angleGradientTrackOffset",void 0),De([(0,s.Bg)(2,{numberFormat:"signed"})],Ie.prototype,"axisScaleTimes1000",void 0),De([(0,s.Bg)(2,{numberFormat:"signed"})],Ie.prototype,"axisOffsetTimes1000",void 0),De([(0,s.Bg)(2,{numberFormat:"signed"})],Ie.prototype,"axisScrollSpeedTimes1000",void 0),De([(0,s.Bg)(2,{numberFormat:"signed"})],Ie.prototype,"angleScrollSpeedTimes1000",void 0),De([(0,s.Bg)(1)],Ie.prototype,"fade",void 0),De([(0,s.Bg)(1)],Ie.prototype,"mainGradientColorType",void 0),De([(0,s.Bg)(2)],Ie.prototype,"mainGradientColorVar",void 0);class ze extends K{constructor(){super(...arguments),this._lastMillis=-1,this._animInstances=[]}get preset(){return this.animationPreset}start(e){super.start(e),this._lastMillis=-1;const t=this.preset,i=[t.animation0Offset,t.animation1Offset,t.animation2Offset,t.animation3Offset],n=[t.animation0Delay,t.animation1Delay,t.animation2Delay,t.animation3Delay];this._animInstances.length=0;for(let e=0;e<t.animationCount;e++){const t=i[e],r=n[e];this._animInstances.push({anim:this.bits.getAnimation(t).createInstance(this.bits,this.die),delay:r,started:!1})}}updateLEDs(e,t,i){const n=this.preset,r=this._lastMillis-this.startTime,o=e-this.startTime;this._lastMillis=e;let s=0;const a=Array(p.maxLEDsCount),c=Array(p.maxLEDsCount);for(let l=0;l<n.animationCount;l++){const n=this._animInstances[l].delay;if(!this._animInstances[l].started&&n>r&&n<=o&&(this._animInstances[l].anim.start(e),this._animInstances[l].started=!0),this._animInstances[l].started){a.fill(0),c.fill(0);const n=this._animInstances[l].anim.updateLEDs(e,a,c);for(let e=0;e<n;e++){const n=t.indexOf(a[e]);n>=0&&n<s?i[n]=b(i[n],c[e]):(t[s]=a[e],i[s]=c[e],++s)}}}return s}stop(){return 0}}var Ge=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class Ee{constructor(){this.type=a.sequence,this.animFlags=0,this.duration=0,this.animation0Offset=0,this.animation0Delay=0,this.animation1Offset=0,this.animation1Delay=0,this.animation2Offset=0,this.animation2Delay=0,this.animation3Offset=0,this.animation3Delay=0,this.animationCount=0}createInstance(e,t){return new ze(this,e,t)}}Ge([(0,s.Bg)(1)],Ee.prototype,"type",void 0),Ge([(0,s.Bg)(1)],Ee.prototype,"animFlags",void 0),Ge([(0,s.Bg)(2)],Ee.prototype,"duration",void 0),Ge([(0,s.Bg)(2)],Ee.prototype,"animation0Offset",void 0),Ge([(0,s.Bg)(2)],Ee.prototype,"animation0Delay",void 0),Ge([(0,s.Bg)(2)],Ee.prototype,"animation1Offset",void 0),Ge([(0,s.Bg)(2)],Ee.prototype,"animation1Delay",void 0),Ge([(0,s.Bg)(2)],Ee.prototype,"animation2Offset",void 0),Ge([(0,s.Bg)(2)],Ee.prototype,"animation2Delay",void 0),Ge([(0,s.Bg)(2)],Ee.prototype,"animation3Offset",void 0),Ge([(0,s.Bg)(2)],Ee.prototype,"animation3Delay",void 0),Ge([(0,s.Bg)(2)],Ee.prototype,"animationCount",void 0);class je{constructor(){this.timeAndColor=0}get time(){return 2*((65535&this.timeAndColor)>>7)}get colorIndex(){return 127&this.timeAndColor}getColor(e,t){return e.getColor32(this.colorIndex,t)}setTimeAndColorIndex(e,t){const i=Math.round(1e3*Math.max(0,e))/2&511;this.timeAndColor=i<<7|127&t}equals(e){return this.timeAndColor===e.timeAndColor}}!function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);o>3&&s&&Object.defineProperty(t,i,s)}([(0,s.Bg)(2)],je.prototype,"timeAndColor",void 0);var Le=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class Ve{constructor(){this.keyframesOffset=0,this.keyFrameCount=0,this.ledMask=0}getDuration(e){return e.getRgbKeyframe(this.keyframesOffset+this.keyFrameCount-1).time}getKeyframe(e,t){return(0,s.hu)(t>=0&&t<this.keyFrameCount,`Invalid key frame index: ${t} (count: ${this.keyFrameCount})`),e.getRgbKeyframe(this.keyframesOffset+t)}evaluate(e,t,i,n,r){if(0===this.keyFrameCount)return 0;const o=this.evaluateColor(e,t,i);let s=0;for(let e=0;e<p.maxLEDsCount;++e)0!=(this.ledMask&1<<e)&&(n[s]=e,r[s]=o,s++);return s}evaluateColor(e,t,i){if(0===this.keyFrameCount)return 0;let n=0;for(;n<this.keyFrameCount&&this.getKeyframe(t,n).time<e;)n++;let r=0;if(0===n)r=this.getKeyframe(t,n).getColor(t,i);else if(n===this.keyFrameCount)r=this.getKeyframe(t,n-1).getColor(t,i);else{const o=this.getKeyframe(t,n),s=o.time,a=o.getColor(t,i),c=this.getKeyframe(t,n-1),l=c.time;r=w(c.getColor(t,i),l,a,s,e)}return r}extractLEDIndices(e){let t=0;for(let i=0;i<p.maxLEDsCount;++i)0!=(this.ledMask&1<<i)&&(e[t]=i,t++);return t}equals(e){return this.keyframesOffset===e.keyframesOffset&&this.keyFrameCount===e.keyFrameCount&&this.ledMask===e.ledMask}}Le([(0,s.Bg)(2)],Ve.prototype,"keyframesOffset",void 0),Le([(0,s.Bg)(1,{padding:1})],Ve.prototype,"keyFrameCount",void 0),Le([(0,s.Bg)(4)],Ve.prototype,"ledMask",void 0);class $e{constructor(){this.timeAndIntensity=0}get time(){return 2*((65535&this.timeAndIntensity)>>7)}get intensity(){return 2*(127&this.timeAndIntensity)}setTimeAndIntensity(e,t){const i=Math.round(1e3*Math.max(0,e))/2&511,n=127&Math.floor(t/2);this.timeAndIntensity=i<<7|n}equals(e){return this.timeAndIntensity===e.timeAndIntensity}}!function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);o>3&&s&&Object.defineProperty(t,i,s)}([(0,s.Bg)(2)],$e.prototype,"timeAndIntensity",void 0);var Ue=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class qe{constructor(){this.keyframesOffset=0,this.keyFrameCount=0,this.ledMask=0}getDuration(e){return e.getRgbKeyframe(this.keyframesOffset+this.keyFrameCount-1).time}getKeyframe(e,t){return(0,s.hu)(t>=0&&t<this.keyFrameCount,`Invalid key frame index: ${t} (count: ${this.keyFrameCount})`),e.getKeyframe(this.keyframesOffset+t)}evaluate(e,t,i,n,r,o){if(0===this.keyFrameCount)return 0;const s=k(t,this.evaluateIntensity(e,i));let a=0;for(let e=0;e<n;++e)0!=(this.ledMask&1<<e)&&(r[a]=e,o[a]=s,a++);return a}evaluateIntensity(e,t){let i=0;for(;i<this.keyFrameCount&&this.getKeyframe(e,i).time<t;)i++;if(0===i)return this.getKeyframe(e,i).intensity;if(i===this.keyFrameCount)return this.getKeyframe(e,i-1).intensity;{const n=this.getKeyframe(e,i),r=n.time,o=n.intensity,s=this.getKeyframe(e,i-1),a=s.time;return T(s.intensity,a,o,r,t)}}extractLEDIndices(e){let t=0;for(let i=0;i<p.maxLEDsCount;++i)0!=(this.ledMask&1<<i)&&(e[t]=i,t++);return t}equals(e){return this.keyframesOffset===e.keyframesOffset&&this.keyFrameCount===e.keyFrameCount&&this.ledMask===e.ledMask}}Ue([(0,s.Bg)(2)],qe.prototype,"keyframesOffset",void 0),Ue([(0,s.Bg)(1,{padding:1})],qe.prototype,"keyFrameCount",void 0),Ue([(0,s.Bg)(4)],qe.prototype,"ledMask",void 0);class Ne{get currentFace(){return this.tryRoll(),this._currentFace}constructor(e="d20"){this._currentFace=0,this._lastRoll=0,this.dieType=e,this.ledCount=_e(e),this.faceCount=ke(e),this.topFace=Te(e),this.tryRoll()}tryRoll(){const e=Date.now();e-this._lastRoll>5e3&&(this._lastRoll=e,this._currentFace=Math.floor(Math.random()*this.faceCount))}}const Ke={getLEDCount(e){switch(e){case"unknown":return 0;case"d4":case"d6":case"d6fudge":return 6;case"d6pipped":return 21;case"d8":return 8;case"d10":case"d00":return 10;case"d12":return 12;case"d20":return 20;default:(0,s.vE)(e)}},getFaceCount(e){switch(e){case"unknown":return 0;case"d4":return 4;case"d6":case"d6fudge":case"d6pipped":return 6;case"d8":return 8;case"d10":case"d00":return 10;case"d12":return 12;case"d20":return 20;default:(0,s.vE)(e)}},getTopFace:e=>"d00"===e||"d10"===e?0:Ke.getFaceCount(e),estimateDieType(e){switch(e){case 4:return"d4";case 6:return"d6";case 8:return"d8";case 10:return"d10";case 12:return"d12";case 20:return"d20";case 21:return"d6pipped";default:return"unknown"}},faceFromIndex(e,t,i){switch(t){case"d4":return i?e+1:2===e?2:3===e?3:5===e?4:1;case"d10":case"unknown":return e;case"d00":return 10*e;default:return e+1}},indexFromFace(e,t,i){switch(t){case"d4":return i?e-1:2===e?2:3===e?3:4===e?5:0;case"d10":case"unknown":return e;case"d00":return Math.floor(e/10);default:return e-1}},getDieFaces(e){switch(e){case"unknown":return[];case"d4":return(0,s.w6)(1,5);case"d6":case"d6pipped":case"d6fudge":return(0,s.w6)(1,7);case"d8":return(0,s.w6)(1,9);case"d10":return(0,s.w6)(0,10);case"d00":return(0,s.w6)(0,100,10);case"d12":return(0,s.w6)(1,13);case"d20":return(0,s.w6)(1,21);default:(0,s.vE)(e)}},mapFaceForAnimation:(e,t)=>1+Ke.indexFromFace(e,t)},We={unknown:(0,s.GP)(0),onyxBlack:(0,s.GP)(),hematiteGrey:(0,s.GP)(),midnightGalaxy:(0,s.GP)(),auroraSky:(0,s.GP)(),clear:(0,s.GP)(),custom:255},He={unknown:(0,s.GP)(0),d4:(0,s.GP)(),d6:(0,s.GP)(),d8:(0,s.GP)(),d10:(0,s.GP)(),d00:(0,s.GP)(),d12:(0,s.GP)(),d20:(0,s.GP)(),d6pipped:(0,s.GP)(),d6fudge:(0,s.GP)()};var Ye=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class Ze{constructor(){this.rulesOffset=0,this.rulesCount=0}}Ye([(0,s.Bg)(2)],Ze.prototype,"rulesOffset",void 0),Ye([(0,s.Bg)(2)],Ze.prototype,"rulesCount",void 0);var Je=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class Xe{constructor(){this.condition=0,this.actionOffset=0,this.actionCount=0,this.actionCountPadding=0}}Je([(0,s.Bg)(2)],Xe.prototype,"condition",void 0),Je([(0,s.Bg)(2)],Xe.prototype,"actionOffset",void 0),Je([(0,s.Bg)(2)],Xe.prototype,"actionCount",void 0),Je([(0,s.Bg)(2)],Xe.prototype,"actionCountPadding",void 0);const Qe={none:(0,s.GP)(0),playAnimation:(0,s.GP)(),playAudioClip:(0,s.GP)(),makeWebRequest:(0,s.GP)(),speakText:(0,s.GP)()};var et=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class tt{constructor(){this.type=Qe.playAnimation,this.animIndex=0,this.faceIndex=0,this.loopCount=0}}et([(0,s.Bg)(1)],tt.prototype,"type",void 0),et([(0,s.Bg)(1)],tt.prototype,"animIndex",void 0),et([(0,s.Bg)(1,{numberFormat:"signed"})],tt.prototype,"faceIndex",void 0),et([(0,s.Bg)(1)],tt.prototype,"loopCount",void 0);var it=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class nt{constructor(){this.type=Qe.playAudioClip,this._unused=0,this.actionId=0}}it([(0,s.Bg)(1)],nt.prototype,"type",void 0),it([(0,s.Bg)(1)],nt.prototype,"_unused",void 0),it([(0,s.Bg)(2)],nt.prototype,"actionId",void 0);var rt=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class ot{constructor(){this.type=Qe.makeWebRequest,this._unused=0,this.actionId=0}}rt([(0,s.Bg)(1)],ot.prototype,"type",void 0),rt([(0,s.Bg)(1)],ot.prototype,"_unused",void 0),rt([(0,s.Bg)(2)],ot.prototype,"actionId",void 0);var st=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class at{constructor(){this.type=Qe.speakText,this._unused=0,this.actionId=0}}st([(0,s.Bg)(1)],at.prototype,"type",void 0),st([(0,s.Bg)(1)],at.prototype,"_unused",void 0),st([(0,s.Bg)(2)],at.prototype,"actionId",void 0);const ct={none:(0,s.GP)(0),helloGoodbye:(0,s.GP)(),handling:(0,s.GP)(),rolling:(0,s.GP)(),faceCompare:(0,s.GP)(),crooked:(0,s.GP)(),connection:(0,s.GP)(),battery:(0,s.GP)(),idle:(0,s.GP)(),rolled:(0,s.GP)()};var lt=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};const ut={ok:(0,s.mU)(0),low:(0,s.mU)(),charging:(0,s.mU)(),done:(0,s.mU)(),badCharging:(0,s.mU)(),error:(0,s.mU)()};class dt{constructor(){this.type=ct.battery,this.flags=0,this.repeatPeriodMs=0}}lt([(0,s.Bg)(1)],dt.prototype,"type",void 0),lt([(0,s.Bg)(1)],dt.prototype,"flags",void 0),lt([(0,s.Bg)(2)],dt.prototype,"repeatPeriodMs",void 0);var pt=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};const ht={connected:(0,s.mU)(0),disconnected:(0,s.mU)()};class ft{constructor(){this.type=ct.connection,this.flags=0}}pt([(0,s.Bg)(1)],ft.prototype,"type",void 0),pt([(0,s.Bg)(1,{padding:2})],ft.prototype,"flags",void 0);var yt=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};const mt={less:(0,s.mU)(0),equal:(0,s.mU)(),greater:(0,s.mU)()};class gt{constructor(){this.type=ct.faceCompare,this.faceIndex=0,this.flags=0}}yt([(0,s.Bg)(1)],gt.prototype,"type",void 0),yt([(0,s.Bg)(1)],gt.prototype,"faceIndex",void 0),yt([(0,s.Bg)(1,{padding:1})],gt.prototype,"flags",void 0);var vt=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};const bt={hello:(0,s.mU)(0),goodbye:(0,s.mU)()};class wt{constructor(){this.type=ct.helloGoodbye,this.flags=0}}vt([(0,s.Bg)(1)],wt.prototype,"type",void 0),vt([(0,s.Bg)(1,{padding:2})],wt.prototype,"flags",void 0);class Tt{constructor(){this.type=ct.crooked}}!function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);o>3&&s&&Object.defineProperty(t,i,s)}([(0,s.Bg)(1,{padding:3})],Tt.prototype,"type",void 0);class kt{constructor(){this.type=ct.handling}}!function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);o>3&&s&&Object.defineProperty(t,i,s)}([(0,s.Bg)(1,{padding:3})],kt.prototype,"type",void 0);var _t=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class Ct{constructor(){this.type=ct.idle,this.repeatPeriodMs=0}}_t([(0,s.Bg)(1,{padding:1})],Ct.prototype,"type",void 0),_t([(0,s.Bg)(2)],Ct.prototype,"repeatPeriodMs",void 0);var Pt=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class Bt{constructor(){this.type=ct.rolling,this.repeatPeriodMs=0}}Pt([(0,s.Bg)(1,{padding:1})],Bt.prototype,"type",void 0),Pt([(0,s.Bg)(2)],Bt.prototype,"repeatPeriodMs",void 0);var xt=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};class Ot{constructor(){this.type=ct.rolled,this.faceMask=0}}function St(e){switch(e){case"none":return;case"simple":return{name:"Simple Flashes",order:0};case"rainbow":return{name:"Colorful Rainbow",order:1};case"keyframed":return{name:"Colored Design",order:3};case"gradientPattern":return{name:"Mixed Design",order:4};case"gradient":return{name:"Simple Gradient",order:2};case"noise":return{name:"Noise",order:5};case"normals":return{name:"Normals",order:6};case"sequence":return{name:"Sequence",order:7};case"cycle":case"name":throw new Error(`getAnimationTypeDisplayName: unsupported animation type: ${e}`);default:(0,s.vE)(e,`Unknown animation type: ${e}`)}}function At(e){switch(e){case"none":return;case"playAnimation":return{name:"Trigger Pattern",order:0};case"playAudioClip":return{name:"Play Audio Clip",order:1};case"makeWebRequest":return{name:"Make Web Request",order:2};case"speakText":return{name:"Speak Text",order:3};default:(0,s.vE)(e,`Unknown action type: ${e}`)}}function Mt(e){switch(e){case"none":return;case"helloGoodbye":return{name:"Pixel wakes up / sleeps",order:0};case"handling":return{name:"Pixel is picked up",order:1};case"rolling":return{name:"Pixel is rolling",order:2};case"faceCompare":return{name:"Pixel roll is...",order:3};case"crooked":return{name:"Pixel is crooked",order:4};case"connection":return{name:"Bluetooth Event...",order:5};case"battery":return{name:"Battery Event...",order:6};case"idle":return{name:"Pixel is idle for...",order:7};case"rolled":return{name:"Pixel roll is one of...",order:8};default:(0,s.vE)(e,`Unknown condition type: ${e}`)}}xt([(0,s.Bg)(1,{padding:3})],Ot.prototype,"type",void 0),xt([(0,s.Bg)(4)],Ot.prototype,"faceMask",void 0);class Rt{get animationBits(){return this._animationBits}get animations(){return this._animationBits.animations}get conditions(){return this._conditions}get actions(){return this._actions}get rules(){return this._rules}get brightness(){return this._brightness}set brightness(e){this._brightness=e}get profile(){return this._profile}set profile(e){this._profile=e}constructor(e){this._conditions=[],this._actions=[],this._rules=[],this._profile=new Ze,this._brightness=255,this._animationBits=null!=e?e:new N}computeDataSetByteSize(){return this._animationBits.computeDataSize()+h(2*this.animations.length)+(0,s.iR)(this.animations)+h(2*this._conditions.length)+(0,s.iR)(this._conditions)+h(2*this._actions.length)+(0,s.iR)(this._actions)+(0,s.iR)(this._rules)+(this._profile?(0,s.iR)(this._profile):0)+1}toSingleAnimationByteArray(){(0,s.hu)(1===this.animations.length,"Need exactly one animation"),(0,s.hu)(this._animationBits.palette.length<128,"Palette has more than 127 colors: "+this._animationBits.palette.length);const e=this._animationBits.computeDataSize()+(0,s.iR)(this.animations[0]),[t,i]=this._animationBits.serialize(new DataView(new ArrayBuffer(e)));return(0,s.qC)(this.animations[0],{dataView:t,byteOffset:i}),new Uint8Array(t.buffer)}toAnimationsByteArray(){(0,s.hu)(this.animations.length>0,"No animations"),(0,s.hu)(this._animationBits.palette.length<128,"Palette has more than 127 colors: "+this._animationBits.palette.length);const e=this._animationBits.computeDataSize()+h(2*this.animations.length)+(0,s.iR)(this.animations);let[t,i]=this._animationBits.serialize(new DataView(new ArrayBuffer(e))),n=0;return this.animations.forEach(((e,r)=>{t.setUint16(i+2*r,n,!0),n+=(0,s.iR)(e)})),i+=h(2*this.animations.length),[t,i]=(0,s.qC)(this.animations,{dataView:t,byteOffset:i}),new Uint8Array(t.buffer)}toByteArray(){const e=this.computeDataSetByteSize(),[t]=this.serialize(new DataView(new ArrayBuffer(e)));return new Uint8Array(t.buffer)}serialize(e,t=0){(0,s.hu)(this._animationBits.palette.length<128,"Palette has more than 127 colors: "+this._animationBits.palette.length),[e,t]=this._animationBits.serialize(e);let i=0;this.animations.forEach(((n,r)=>{e.setUint16(t+2*r,i,!0),i+=(0,s.iR)(n)})),t+=h(2*this.animations.length),[e,t]=(0,s.qC)(this.animations,{dataView:e,byteOffset:t});let n=0;this._conditions.forEach(((i,r)=>{e.setUint16(t+2*r,n,!0),n+=(0,s.iR)(i)})),t+=h(2*this._conditions.length),[e,t]=(0,s.qC)(this._conditions,{dataView:e,byteOffset:t});let r=0;return this._actions.forEach(((i,n)=>{e.setUint16(t+2*n,r,!0),r+=(0,s.iR)(i)})),t+=h(2*this._actions.length),[e,t]=(0,s.qC)(this._actions,{dataView:e,byteOffset:t}),[e,t]=(0,s.qC)(this._rules,{dataView:e,byteOffset:t}),this._profile&&([e,t]=(0,s.qC)(this._profile,{dataView:e,byteOffset:t})),[e,t]}static computeHash(e){return(0,s.yh)(e)}}},754:(e,t,i)=>{"use strict";i.r(t),i.d(t,{BatteryLevel:()=>te,Blink:()=>X,BlinkId:()=>be,BulkData:()=>V,BulkDataAck:()=>$,BulkSetup:()=>L,Constants:()=>n,CustomDesignAndColorNameChunk:()=>A,DebugLog:()=>H,DieInfoChunk:()=>S,DieNameChunk:()=>M,Discharge:()=>ve,GenericPixelMessage:()=>B,IAmADie:()=>D,LegacyIAmADie:()=>I,MessageTypeValues:()=>m,NotifyUser:()=>re,NotifyUserAck:()=>oe,Pixel:()=>Be,PixelBatteryControllerModeValues:()=>E,PixelBatteryControllerStateValues:()=>ee,PixelBatteryStateValues:()=>Q,PixelBleUuids:()=>xe,PixelChipModelValues:()=>x,PixelConnectCancelledError:()=>a,PixelConnectError:()=>o,PixelConnectIdMismatchError:()=>c,PixelConnectTimeoutError:()=>s,PixelEmptyNameError:()=>p,PixelError:()=>r,PixelIncompatibleMessageError:()=>d,PixelInfoNotifier:()=>Ce,PixelPowerOperationValues:()=>de,PixelRollStateValues:()=>z,PixelSession:()=>Oe,PixelWaitForMessageDisconnectError:()=>u,PixelWaitForMessageTimeoutError:()=>l,PlayInstantAnimation:()=>ye,PlayProfileAnimation:()=>Te,PowerOperation:()=>pe,RemoteAction:()=>Y,RequestRssi:()=>ie,RequestTelemetry:()=>J,RollState:()=>G,Rssi:()=>ne,SetBatteryControllerMode:()=>ge,SetDesignAndColor:()=>le,SetName:()=>ue,SettingsInfoChunk:()=>R,StatusInfoChunk:()=>F,StoreValue:()=>se,StoreValueAck:()=>ce,StoreValueResultValues:()=>ae,Telemetry:()=>j,TelemetryRequestModeValues:()=>Z,Temperature:()=>me,TransferAnimationSet:()=>U,TransferAnimationSetAck:()=>q,TransferInstantAnimationSet:()=>he,TransferInstantAnimationSetAck:()=>fe,TransferInstantAnimationsSetAckTypeValues:()=>K,TransferTest:()=>we,TransferTestAnimationSet:()=>N,TransferTestAnimationSetAck:()=>W,VersionInfoChunk:()=>O,deserializeMessage:()=>P,getMessageType:()=>k,getMessageTypeValue:()=>T,instantiateMessage:()=>_,repeatConnect:()=>Ae,serializeMessage:()=>C,toFullUuid:()=>Me});const n={minMtu:23,maxMtu:517,connectionTimeout:1e4,defaultRequestTimeout:1e4,ackMessageTimeout:5e3,maxMessageSize:100,maxNameByteSize:31,maxAdvertisedNameByteSize:13,apiVersion:256,compatApiVersion:256};class r extends Error{constructor(e,t,i){const n=i&&i.code;n&&(t+=` (${n})`),super(`Pixel ${e.name}: ${t}`),this.name="PixelError",this.pixel=e,this.description=t,this.cause=i}}class o extends r{constructor(e,t){const i=t instanceof Error;super(e,"string"==typeof t?t:i&&t instanceof r?`Connection error, ${t.description}`:i?`Connection error, ${t.message}`:`Unknown connection error, ${JSON.stringify(t)}`,i?t:void 0),this.name="PixelConnectError"}}class s extends o{constructor(e,t){super(e,`Connection timeout after ${t} ms`),this.name="PixelConnectTimeoutError"}}class a extends o{constructor(e){super(e,`Connection cancelled (current state is ${e.status})`),this.name="PixelConnectCancelledError"}}class c extends o{constructor(e,t){super(e,"Identification mismatch, expecting "+e.pixelId.toString(16).padStart(8,"0")+" but got "+t.toString(16).padStart(8,"0")),this.name="PixelIdMismatchError"}}class l extends r{constructor(e,t,i){super(e,`Timeout of ${t}ms waiting for message ${i}`),this.name="PixelMessageTimeoutError"}}class u extends r{constructor(e,t){super(e,`Disconnected while waiting for message ${t}`),this.name="PixelMessageConnectStatusError"}}class d extends o{constructor(e,t,i,n,r){super(e,`Message ${t} cannot be send, firmware ${"firmware"===r?"compat. ":""} API version is ${n} but library ${"library"===r?"compat. ":""} API version is ${i}`),this.name="PixelConnectIncompatibleFirmwareError"}}class p extends o{constructor(e){super(e,"New Pixel name must have at least one character"),this.name="PixelEmptyNameError"}}var h=i(749),f=i(48),y=function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};const m={none:(0,f.GP)(0),whoAreYou:(0,f.GP)(),iAmADie:(0,f.GP)(),rollState:(0,f.GP)(),telemetry:(0,f.GP)(),bulkSetup:(0,f.GP)(),bulkSetupAck:(0,f.GP)(),bulkData:(0,f.GP)(),bulkDataAck:(0,f.GP)(),transferAnimationSet:(0,f.GP)(),transferAnimationSetAck:(0,f.GP)(),transferAnimationSetFinished:(0,f.GP)(),transferSettings:(0,f.GP)(),transferSettingsAck:(0,f.GP)(),transferSettingsFinished:(0,f.GP)(),transferTestAnimationSet:(0,f.GP)(),transferTestAnimationSetAck:(0,f.GP)(),transferTestAnimationSetFinished:(0,f.GP)(),debugLog:(0,f.GP)(),playAnimation:(0,f.GP)(),playAnimationEvent:(0,f.GP)(),stopAnimation:(0,f.GP)(),remoteAction:(0,f.GP)(),requestRollState:(0,f.GP)(),requestAnimationSet:(0,f.GP)(),requestSettings:(0,f.GP)(),requestTelemetry:(0,f.GP)(),programDefaultAnimationSet:(0,f.GP)(),programDefaultAnimationSetFinished:(0,f.GP)(),blink:(0,f.GP)(),blinkAck:(0,f.GP)(),requestDefaultAnimationSetColor:(0,f.GP)(),defaultAnimationSetColor:(0,f.GP)(),requestBatteryLevel:(0,f.GP)(),batteryLevel:(0,f.GP)(),requestRssi:(0,f.GP)(),rssi:(0,f.GP)(),calibrate:(0,f.GP)(),calibrateFace:(0,f.GP)(),notifyUser:(0,f.GP)(),notifyUserAck:(0,f.GP)(),testHardware:(0,f.GP)(),storeValue:(0,f.GP)(),storeValueAck:(0,f.GP)(),setTopLevelState:(0,f.GP)(),programDefaultParameters:(0,f.GP)(),programDefaultParametersFinished:(0,f.GP)(),setDesignAndColor:(0,f.GP)(),setDesignAndColorAck:(0,f.GP)(),setCurrentBehavior:(0,f.GP)(),setCurrentBehaviorAck:(0,f.GP)(),setName:(0,f.GP)(),setNameAck:(0,f.GP)(),powerOperation:(0,f.GP)(),exitValidation:(0,f.GP)(),transferInstantAnimationSet:(0,f.GP)(),transferInstantAnimationSetAck:(0,f.GP)(),transferInstantAnimationSetFinished:(0,f.GP)(),playInstantAnimation:(0,f.GP)(),stopAllAnimations:(0,f.GP)(),requestTemperature:(0,f.GP)(),temperature:(0,f.GP)(),setBatteryControllerMode:(0,f.GP)(),_unused:(0,f.GP)(),discharge:(0,f.GP)(),blinkId:(0,f.GP)(),blinkIdAck:(0,f.GP)(),transferTest:(0,f.GP)(),transferTestAck:(0,f.GP)(),transferTestFinished:(0,f.GP)(),clearSettings:(0,f.GP)(),clearSettingsAck:(0,f.GP)(),testBulkSend:(0,f.GP)(),testBulkReceive:(0,f.GP)(),setAllLEDsToColor:(0,f.GP)(),attractMode:(0,f.GP)(),printNormals:(0,f.GP)(),printA2DReadings:(0,f.GP)(),lightUpFace:(0,f.GP)(),setLEDToColor:(0,f.GP)(),debugAnimationController:(0,f.GP)()},g=[],v=new Map,b=new Map;function w(e){const t=m[e];return(0,f.hu)(t,`No Pixel message type value for ${e}`),t}function T(e){return"function"==typeof e?function(e){var t;if(!v){const e=v;for(const t of ke())e.set(t,(new t).type)}return null!==(t=v.get(e))&&void 0!==t?t:m.none}(e):"string"==typeof e?w(e):e.type}function k(e){if("string"==typeof e)return e;{const t="number"==typeof e?e:e.type,i=function(e){if(!g.length){const e=g;for(const[t,i]of Object.entries(m))e[i]=t}return g[e]}(t);if(i)return i;throw Error(`getMessageName: ${t} is not a value in MessageTypeValues`)}}function _(e){const t=w(e),i=function(e){if(!b.size){const e=b;for(const t of ke())e.set((new t).type,t)}return b.get(e)}(t);return i?new i:new B(t)}function C(e){if("object"==typeof e){const t=e,[i]=(0,f.qC)(t);return(0,f.hu)(i.byteLength>0,"Got empty buffer from deserialization"),(0,f.hu)(i.getUint8(0)===T(t),`Unexpected message type, got ${i.getUint8(0)} instead of ${T(t)}`),i.buffer}{const t="number"==typeof e?e:m[e];return(0,f.hu)(t,`No Pixel message value for ${e}`),Uint8Array.of(t)}}function P(e){if(!e.byteLength)throw new f.TH("Can't deserialize an empty buffer");const t=e.getUint8(0);if(1===e.byteLength)return k(t);{const i=_(k(t)),n=(0,f.vB)(i,e);return n!==e.byteLength&&console.warn(`The last ${e.byteLength-n} bytes were not read while deserializing message of type ${i.type}`),(0,f.hu)(i.type===t,`Incorrect message type after deserializing ${i.type} but expecting ${t}`),i}}class B{constructor(e){this.type=e}}y([(0,f.Bg)(1)],B.prototype,"type",void 0);const x={unknown:(0,f.GP)(0),nRF52810:(0,f.GP)()};class O{constructor(){this.chunkSize=(0,f.iR)(this),this.firmwareVersion=0,this.buildTimestamp=0,this.settingsVersion=0,this.compatStandardApiVersion=0,this.compatExtendedApiVersion=0,this.compatManagementApiVersion=0}}y([(0,f.Bg)(1)],O.prototype,"chunkSize",void 0),y([(0,f.Bg)(2)],O.prototype,"firmwareVersion",void 0),y([(0,f.Bg)(4)],O.prototype,"buildTimestamp",void 0),y([(0,f.Bg)(2)],O.prototype,"settingsVersion",void 0),y([(0,f.Bg)(2)],O.prototype,"compatStandardApiVersion",void 0),y([(0,f.Bg)(2)],O.prototype,"compatExtendedApiVersion",void 0),y([(0,f.Bg)(2)],O.prototype,"compatManagementApiVersion",void 0);class S{constructor(){this.chunkSize=(0,f.iR)(this),this.pixelId=0,this.chipModel=x.unknown,this.dieType=h.PixelDieTypeValues.unknown,this.ledCount=0,this.colorway=h.PixelColorwayValues.unknown}}y([(0,f.Bg)(1)],S.prototype,"chunkSize",void 0),y([(0,f.Bg)(4)],S.prototype,"pixelId",void 0),y([(0,f.Bg)(1)],S.prototype,"chipModel",void 0),y([(0,f.Bg)(1)],S.prototype,"dieType",void 0),y([(0,f.Bg)(1)],S.prototype,"ledCount",void 0),y([(0,f.Bg)(1)],S.prototype,"colorway",void 0);class A{constructor(){this.chunkSize=0,this.name=""}}y([(0,f.Bg)(1)],A.prototype,"chunkSize",void 0),y([(0,f.Bg)(0,{terminator:!0})],A.prototype,"name",void 0);class M{constructor(){this.chunkSize=0,this.name=""}}y([(0,f.Bg)(1)],M.prototype,"chunkSize",void 0),y([(0,f.Bg)(0,{terminator:!0})],M.prototype,"name",void 0);class R{constructor(){this.chunkSize=(0,f.iR)(this),this.profileDataHash=0,this.availableFlash=0,this.totalUsableFlash=0}}y([(0,f.Bg)(1)],R.prototype,"chunkSize",void 0),y([(0,f.Bg)(4)],R.prototype,"profileDataHash",void 0),y([(0,f.Bg)(4)],R.prototype,"availableFlash",void 0),y([(0,f.Bg)(4)],R.prototype,"totalUsableFlash",void 0);class F{constructor(){this.chunkSize=(0,f.iR)(this),this.batteryLevelPercent=0,this.batteryState=Q.ok,this.rollState=z.unknown,this.currentFaceIndex=0}}y([(0,f.Bg)(1)],F.prototype,"chunkSize",void 0),y([(0,f.Bg)(1)],F.prototype,"batteryLevelPercent",void 0),y([(0,f.Bg)(1)],F.prototype,"batteryState",void 0),y([(0,f.Bg)(1)],F.prototype,"rollState",void 0),y([(0,f.Bg)(1)],F.prototype,"currentFaceIndex",void 0);class D{constructor(){this.type=m.iAmADie,this.versionInfo=new O,this.dieInfo=new S,this.customDesignAndColorName=new A,this.dieName=new M,this.settingsInfo=new R,this.statusInfo=new F}}y([(0,f.Bg)(1)],D.prototype,"type",void 0);class I{constructor(){this.type=m.iAmADie,this.ledCount=0,this.colorway=h.PixelColorwayValues.unknown,this.dieType=h.PixelDieTypeValues.unknown,this.dataSetHash=0,this.pixelId=0,this.availableFlashSize=0,this.buildTimestamp=0,this.rollState=z.unknown,this.currentFaceIndex=0,this.batteryLevelPercent=0,this.batteryState=Q.ok}}I.expectedSize=22,y([(0,f.Bg)(1)],I.prototype,"type",void 0),y([(0,f.Bg)(1)],I.prototype,"ledCount",void 0),y([(0,f.Bg)(1)],I.prototype,"colorway",void 0),y([(0,f.Bg)(1)],I.prototype,"dieType",void 0),y([(0,f.Bg)(4)],I.prototype,"dataSetHash",void 0),y([(0,f.Bg)(4)],I.prototype,"pixelId",void 0),y([(0,f.Bg)(2)],I.prototype,"availableFlashSize",void 0),y([(0,f.Bg)(4)],I.prototype,"buildTimestamp",void 0),y([(0,f.Bg)(1)],I.prototype,"rollState",void 0),y([(0,f.Bg)(1)],I.prototype,"currentFaceIndex",void 0),y([(0,f.Bg)(1)],I.prototype,"batteryLevelPercent",void 0),y([(0,f.Bg)(1)],I.prototype,"batteryState",void 0);const z={unknown:(0,f.GP)(0),onFace:(0,f.GP)(),handling:(0,f.GP)(),rolling:(0,f.GP)(),crooked:(0,f.GP)()};class G{constructor(){this.type=m.rollState,this.state=z.unknown,this.faceIndex=0}}y([(0,f.Bg)(1)],G.prototype,"type",void 0),y([(0,f.Bg)(1)],G.prototype,"state",void 0),y([(0,f.Bg)(1)],G.prototype,"faceIndex",void 0);const E={default:(0,f.GP)(0),forceDisableCharging:(0,f.GP)(),forceEnableCharging:(0,f.GP)()};class j{constructor(){this.type=m.telemetry,this.accXTimes1000=0,this.accYTimes1000=0,this.accZTimes1000=0,this.faceConfidenceTimes1000=0,this.timeMs=0,this.rollState=z.unknown,this.faceIndex=0,this.batteryLevelPercent=0,this.batteryState=Q.ok,this.batteryControllerState=ee.ok,this.voltageTimes50=0,this.vCoilTimes50=0,this.rssi=0,this.channelIndex=0,this.mcuTemperatureTimes100=0,this.batteryTemperatureTimes100=0,this.internalChargeState=!1,this.batteryControllerMode=E.default,this.ledCurrent=0}}y([(0,f.Bg)(1)],j.prototype,"type",void 0),y([(0,f.Bg)(2,{numberFormat:"signed"})],j.prototype,"accXTimes1000",void 0),y([(0,f.Bg)(2,{numberFormat:"signed"})],j.prototype,"accYTimes1000",void 0),y([(0,f.Bg)(2,{numberFormat:"signed"})],j.prototype,"accZTimes1000",void 0),y([(0,f.Bg)(4,{numberFormat:"signed"})],j.prototype,"faceConfidenceTimes1000",void 0),y([(0,f.Bg)(4)],j.prototype,"timeMs",void 0),y([(0,f.Bg)(1)],j.prototype,"rollState",void 0),y([(0,f.Bg)(1)],j.prototype,"faceIndex",void 0),y([(0,f.Bg)(1)],j.prototype,"batteryLevelPercent",void 0),y([(0,f.Bg)(1)],j.prototype,"batteryState",void 0),y([(0,f.Bg)(1)],j.prototype,"batteryControllerState",void 0),y([(0,f.Bg)(1)],j.prototype,"voltageTimes50",void 0),y([(0,f.Bg)(1)],j.prototype,"vCoilTimes50",void 0),y([(0,f.Bg)(1,{numberFormat:"signed"})],j.prototype,"rssi",void 0),y([(0,f.Bg)(1)],j.prototype,"channelIndex",void 0),y([(0,f.Bg)(2)],j.prototype,"mcuTemperatureTimes100",void 0),y([(0,f.Bg)(2)],j.prototype,"batteryTemperatureTimes100",void 0),y([(0,f.Bg)(1)],j.prototype,"internalChargeState",void 0),y([(0,f.Bg)(1)],j.prototype,"batteryControllerMode",void 0),y([(0,f.Bg)(1)],j.prototype,"ledCurrent",void 0);class L{constructor(){this.type=m.bulkSetup,this.size=0}}y([(0,f.Bg)(1)],L.prototype,"type",void 0),y([(0,f.Bg)(2)],L.prototype,"size",void 0);class V{constructor(){this.type=m.bulkData,this.size=0,this.offset=0}}y([(0,f.Bg)(1)],V.prototype,"type",void 0),y([(0,f.Bg)(1)],V.prototype,"size",void 0),y([(0,f.Bg)(2)],V.prototype,"offset",void 0),y([(0,f.Bg)(n.maxMessageSize)],V.prototype,"data",void 0);class ${constructor(){this.type=m.bulkDataAck,this.offset=0}}y([(0,f.Bg)(1)],$.prototype,"type",void 0),y([(0,f.Bg)(2)],$.prototype,"offset",void 0);class U{constructor(){this.type=m.transferAnimationSet,this.paletteSize=0,this.rgbKeyFrameCount=0,this.rgbTrackCount=0,this.keyFrameCount=0,this.trackCount=0,this.animationCount=0,this.animationSize=0,this.conditionCount=0,this.conditionSize=0,this.actionCount=0,this.actionSize=0,this.ruleCount=0,this.brightness=0}}y([(0,f.Bg)(1)],U.prototype,"type",void 0),y([(0,f.Bg)(2)],U.prototype,"paletteSize",void 0),y([(0,f.Bg)(2)],U.prototype,"rgbKeyFrameCount",void 0),y([(0,f.Bg)(2)],U.prototype,"rgbTrackCount",void 0),y([(0,f.Bg)(2)],U.prototype,"keyFrameCount",void 0),y([(0,f.Bg)(2)],U.prototype,"trackCount",void 0),y([(0,f.Bg)(2)],U.prototype,"animationCount",void 0),y([(0,f.Bg)(2)],U.prototype,"animationSize",void 0),y([(0,f.Bg)(2)],U.prototype,"conditionCount",void 0),y([(0,f.Bg)(2)],U.prototype,"conditionSize",void 0),y([(0,f.Bg)(2)],U.prototype,"actionCount",void 0),y([(0,f.Bg)(2)],U.prototype,"actionSize",void 0),y([(0,f.Bg)(2)],U.prototype,"ruleCount",void 0),y([(0,f.Bg)(1)],U.prototype,"brightness",void 0);class q{constructor(){this.type=m.transferAnimationSetAck,this.result=0}}y([(0,f.Bg)(1)],q.prototype,"type",void 0),y([(0,f.Bg)(1)],q.prototype,"result",void 0);class N{constructor(){this.type=m.transferTestAnimationSet,this.paletteSize=0,this.rgbKeyFrameCount=0,this.rgbTrackCount=0,this.keyFrameCount=0,this.trackCount=0,this.animationCount=0,this.animationSize=0,this.hash=0}}y([(0,f.Bg)(1)],N.prototype,"type",void 0),y([(0,f.Bg)(2)],N.prototype,"paletteSize",void 0),y([(0,f.Bg)(2)],N.prototype,"rgbKeyFrameCount",void 0),y([(0,f.Bg)(2)],N.prototype,"rgbTrackCount",void 0),y([(0,f.Bg)(2)],N.prototype,"keyFrameCount",void 0),y([(0,f.Bg)(2)],N.prototype,"trackCount",void 0),y([(0,f.Bg)(2)],N.prototype,"animationCount",void 0),y([(0,f.Bg)(2)],N.prototype,"animationSize",void 0),y([(0,f.Bg)(4)],N.prototype,"hash",void 0);const K={download:(0,f.GP)(0),upToDate:(0,f.GP)(),noMemory:(0,f.GP)()};class W{constructor(){this.type=m.transferTestAnimationSetAck,this.ackType=K.download}}y([(0,f.Bg)(1)],W.prototype,"type",void 0),y([(0,f.Bg)(1)],W.prototype,"ackType",void 0);class H{constructor(){this.type=m.debugLog,this.message=""}}y([(0,f.Bg)(1)],H.prototype,"type",void 0),y([(0,f.Bg)(0,{terminator:!0})],H.prototype,"message",void 0);class Y{constructor(){this.type=m.remoteAction,this.actionId=0}}y([(0,f.Bg)(1)],Y.prototype,"type",void 0),y([(0,f.Bg)(2)],Y.prototype,"actionId",void 0);const Z={off:(0,f.GP)(0),once:(0,f.GP)(),automatic:(0,f.GP)()};class J{constructor(){this.type=m.requestTelemetry,this.requestMode=Z.off,this.minInterval=0}}y([(0,f.Bg)(1)],J.prototype,"type",void 0),y([(0,f.Bg)(1)],J.prototype,"requestMode",void 0),y([(0,f.Bg)(2)],J.prototype,"minInterval",void 0);class X{constructor(){this.type=m.blink,this.count=0,this.duration=0,this.color=0,this.faceMask=h.AnimConstants.faceMaskAll,this.fade=0,this.loopCount=1}}y([(0,f.Bg)(1)],X.prototype,"type",void 0),y([(0,f.Bg)(1)],X.prototype,"count",void 0),y([(0,f.Bg)(2)],X.prototype,"duration",void 0),y([(0,f.Bg)(4)],X.prototype,"color",void 0),y([(0,f.Bg)(4)],X.prototype,"faceMask",void 0),y([(0,f.Bg)(1)],X.prototype,"fade",void 0),y([(0,f.Bg)(1)],X.prototype,"loopCount",void 0);const Q={ok:(0,f.GP)(0),low:(0,f.GP)(),charging:(0,f.GP)(),done:(0,f.GP)(),badCharging:(0,f.GP)(),error:(0,f.GP)()},ee={unknown:(0,f.GP)(0),ok:(0,f.GP)(),empty:(0,f.GP)(),low:(0,f.GP)(),transitionOn:(0,f.GP)(),transitionOff:(0,f.GP)(),badCharging:(0,f.GP)(),error:(0,f.GP)(),chargingLow:(0,f.GP)(),charging:(0,f.GP)(),cooldown:(0,f.GP)(),trickle:(0,f.GP)(),done:(0,f.GP)(),lowTemp:(0,f.GP)(),highTemp:(0,f.GP)()};class te{constructor(){this.type=m.batteryLevel,this.levelPercent=0,this.state=Q.ok}}y([(0,f.Bg)(1)],te.prototype,"type",void 0),y([(0,f.Bg)(1)],te.prototype,"levelPercent",void 0),y([(0,f.Bg)(1)],te.prototype,"state",void 0);class ie{constructor(){this.type=m.requestRssi,this.requestMode=Z.off,this.minInterval=0}}y([(0,f.Bg)(1)],ie.prototype,"type",void 0),y([(0,f.Bg)(1)],ie.prototype,"requestMode",void 0),y([(0,f.Bg)(2)],ie.prototype,"minInterval",void 0);class ne{constructor(){this.type=m.rssi,this.value=0}}y([(0,f.Bg)(1)],ne.prototype,"type",void 0),y([(0,f.Bg)(1,{numberFormat:"signed"})],ne.prototype,"value",void 0);class re{constructor(){this.type=m.notifyUser,this.timeoutSec=0,this.ok=!1,this.cancel=!1,this.message=""}}y([(0,f.Bg)(1)],re.prototype,"type",void 0),y([(0,f.Bg)(1)],re.prototype,"timeoutSec",void 0),y([(0,f.Bg)(1)],re.prototype,"ok",void 0),y([(0,f.Bg)(1)],re.prototype,"cancel",void 0),y([(0,f.Bg)(n.maxMessageSize-4)],re.prototype,"message",void 0);class oe{constructor(){this.type=m.notifyUserAck,this.okCancel=!1}}y([(0,f.Bg)(1)],oe.prototype,"type",void 0),y([(0,f.Bg)(1)],oe.prototype,"okCancel",void 0);class se{constructor(){this.type=m.storeValue,this.value=0}}y([(0,f.Bg)(1)],se.prototype,"type",void 0),y([(0,f.Bg)(4)],se.prototype,"value",void 0);const ae={success:(0,f.GP)(0),unknownError:(0,f.GP)(),storeFull:(0,f.GP)(),invalidRange:(0,f.GP)(),notPermitted:(0,f.GP)()};class ce{constructor(){this.type=m.storeValueAck,this.result=0,this.index=ae.success}}y([(0,f.Bg)(1)],ce.prototype,"type",void 0),y([(0,f.Bg)(1)],ce.prototype,"result",void 0),y([(0,f.Bg)(1)],ce.prototype,"index",void 0);class le{constructor(){this.type=m.setDesignAndColor,this.dieType=0,this.colorway=0}}y([(0,f.Bg)(1)],le.prototype,"type",void 0),y([(0,f.Bg)(1)],le.prototype,"dieType",void 0),y([(0,f.Bg)(1)],le.prototype,"colorway",void 0);class ue{constructor(){this.type=m.setName,this.name=""}}y([(0,f.Bg)(1)],ue.prototype,"type",void 0),y([(0,f.Bg)(n.maxNameByteSize+1)],ue.prototype,"name",void 0);const de={turnOff:(0,f.GP)(0),reset:(0,f.GP)(),sleep:(0,f.GP)()};class pe{constructor(){this.type=m.powerOperation,this.operation=de.sleep}}y([(0,f.Bg)(1)],pe.prototype,"type",void 0),y([(0,f.Bg)(1)],pe.prototype,"operation",void 0);class he{constructor(){this.type=m.transferInstantAnimationSet,this.paletteSize=0,this.rgbKeyFrameCount=0,this.rgbTrackCount=0,this.keyFrameCount=0,this.trackCount=0,this.animationCount=0,this.animationSize=0,this.hash=0}}y([(0,f.Bg)(1)],he.prototype,"type",void 0),y([(0,f.Bg)(2)],he.prototype,"paletteSize",void 0),y([(0,f.Bg)(2)],he.prototype,"rgbKeyFrameCount",void 0),y([(0,f.Bg)(2)],he.prototype,"rgbTrackCount",void 0),y([(0,f.Bg)(2)],he.prototype,"keyFrameCount",void 0),y([(0,f.Bg)(2)],he.prototype,"trackCount",void 0),y([(0,f.Bg)(2)],he.prototype,"animationCount",void 0),y([(0,f.Bg)(2)],he.prototype,"animationSize",void 0),y([(0,f.Bg)(4)],he.prototype,"hash",void 0);class fe{constructor(){this.type=m.transferInstantAnimationSetAck,this.ackType=K.download}}y([(0,f.Bg)(1)],fe.prototype,"type",void 0),y([(0,f.Bg)(1)],fe.prototype,"ackType",void 0);class ye{constructor(){this.type=m.playInstantAnimation,this.animation=0,this.faceIndex=0,this.loopCount=1}}y([(0,f.Bg)(1)],ye.prototype,"type",void 0),y([(0,f.Bg)(1)],ye.prototype,"animation",void 0),y([(0,f.Bg)(1)],ye.prototype,"faceIndex",void 0),y([(0,f.Bg)(1)],ye.prototype,"loopCount",void 0);class me{constructor(){this.type=m.temperature,this.mcuTemperatureTimes100=0,this.batteryTemperatureTimes100=0}}y([(0,f.Bg)(1)],me.prototype,"type",void 0),y([(0,f.Bg)(2)],me.prototype,"mcuTemperatureTimes100",void 0),y([(0,f.Bg)(2)],me.prototype,"batteryTemperatureTimes100",void 0);class ge{constructor(){this.type=m.setBatteryControllerMode,this.mode=E.default}}y([(0,f.Bg)(1)],ge.prototype,"type",void 0),y([(0,f.Bg)(1)],ge.prototype,"mode",void 0);class ve{constructor(){this.type=m.discharge,this.currentMA=0}}y([(0,f.Bg)(1)],ve.prototype,"type",void 0),y([(0,f.Bg)(1)],ve.prototype,"currentMA",void 0);class be{constructor(){this.type=m.blinkId,this.brightness=0,this.loopCount=1}}y([(0,f.Bg)(1)],be.prototype,"type",void 0),y([(0,f.Bg)(1)],be.prototype,"brightness",void 0),y([(0,f.Bg)(1)],be.prototype,"loopCount",void 0);class we{constructor(){this.type=m.transferTest,this.size=0}}y([(0,f.Bg)(1)],we.prototype,"type",void 0),y([(0,f.Bg)(2,{padding:1})],we.prototype,"size",void 0);class Te{constructor(){this.type=m.playAnimation,this.animationIndex=0,this.remapToFace=0,this.loopCount=1}}function ke(){return[I,G,j,L,V,$,U,q,N,W,H,Y,X,te,ie,ne,re,oe,se,ce,le,ue,pe,he,fe,ye,me,ge,ve,be,we]}y([(0,f.Bg)(1)],Te.prototype,"type",void 0),y([(0,f.Bg)(1)],Te.prototype,"animationIndex",void 0),y([(0,f.Bg)(1)],Te.prototype,"remapToFace",void 0),y([(0,f.Bg)(1)],Te.prototype,"loopCount",void 0);var _e=i(699);class Ce{constructor(){this._infoEvEmitter=(0,f.W2)()}addPropertyListener(e,t){this._infoEvEmitter.addListener(e,t)}removePropertyListener(e,t){this._infoEvEmitter.removeListener(e,t)}emitPropertyEvent(e){this._infoEvEmitter.emit(e,this)}}function Pe(e){return e===Q.charging||e===Q.done}Ce.MutablePropsList=["name","ledCount","colorway","dieType","firmwareDate","rssi","batteryLevel","isCharging","rollState","currentFace","currentFaceIndex"];class Be extends Ce{get logMessages(){return this._logMessages}set logMessages(e){this._logMessages=e}get logMessagesSerializedData(){return this._logData}set logMessagesSerializedData(e){this._logData=e}get logger(){return this._logFunc}set logger(e){this._logFunc=e}get status(){return this._status}get isReady(){return"ready"===this._status}get systemId(){return this._info.systemId}get pixelId(){return this._info.pixelId}get name(){var e;return this._info.name.length?this._info.name:null!==(e=this._session.pixelName)&&void 0!==e?e:""}get ledCount(){return this._info.ledCount}get colorway(){return this._info.colorway}get dieType(){return this._info.dieType}get dieFaceCount(){return h.DiceUtils.getFaceCount(this.dieType)}get firmwareDate(){return this._info.firmwareDate}get rssi(){return this._info.rssi}get batteryLevel(){return this._info.batteryLevel}get isCharging(){return this._info.isCharging}get rollState(){return this._info.rollState}get currentFace(){return this._info.currentFace}get currentFaceIndex(){return this._info.currentFaceIndex}constructor(e,t){var i,n,r,o,s;super(),this._evEmitter=(0,f.W2)(),this._msgEvEmitter=new _e.EventEmitter,this._logFunc=console.log,this._logMessages=!1,this._logData=!1,this._session=e,this._status="disconnected",this._info={systemId:e.systemId,pixelId:null!==(i=null==t?void 0:t.pixelId)&&void 0!==i?i:0,name:"",ledCount:null!==(n=null==t?void 0:t.ledCount)&&void 0!==n?n:0,colorway:null!==(r=null==t?void 0:t.colorway)&&void 0!==r?r:"unknown",dieType:null!==(o=null==t?void 0:t.dieType)&&void 0!==o?o:"unknown",firmwareDate:null!==(s=null==t?void 0:t.firmwareDate)&&void 0!==s?s:new Date(0),rssi:0,batteryLevel:0,isCharging:!1,rollState:"unknown",currentFace:0,currentFaceIndex:0},this._info.ledCount&&"unknown"===this._info.dieType&&(this._info.dieType=h.DiceUtils.estimateDieType(this._info.ledCount)),this._versions={firmwareVersion:0,settingsVersion:0,compatStandardApiVersion:0,compatExtendedApiVersion:0,compatManagementApiVersion:0},e.setConnectionEventListener((({connectionStatus:e})=>{"connected"===e||"ready"===e?this._updateStatus("connecting"):this._updateStatus("failedToConnect"===e?"disconnected":e)}));const a=e=>{this._updateRssi(e.value)};this.addMessageListener("rssi",a);const c=e=>{const t=e;this._updateBattery(t.levelPercent,Pe(t.state))};this.addMessageListener("batteryLevel",c);const l=e=>{var t;const i=e;this._updateRoll(null!==(t=(0,f.ZO)(i.state,z))&&void 0!==t?t:"unknown",i.faceIndex)};this.addMessageListener("rollState",l);const u=e=>{const t=e;this._evEmitter.emit("userMessage",{message:t.message,withCancel:t.cancel,response:e=>this.sendMessage((0,f.v3)(new oe,{okCancel:e}))})};this.addMessageListener("notifyUser",u);const d=e=>{const t=e;this._evEmitter.emit("remoteAction",t.actionId)};this.addMessageListener("remoteAction",d),this._disposeFunc=()=>{e.setConnectionEventListener(void 0),this.removeMessageListener("rssi",a),this.removeMessageListener("batteryLevel",c),this.removeMessageListener("rollState",l),this.removeMessageListener("notifyUser",u),this.removeMessageListener("remoteAction",d)}}_dispose(){this._disposeFunc()}updateInfo(e){"disconnected"===this.status&&this.pixelId===e.pixelId&&(e.name&&this._updateName(e.name),e.ledCount&&e.ledCount>0&&!this.ledCount&&this._updateLedCount(e.ledCount),e.colorway&&"unknown"!==e.colorway&&"unknown"===this.colorway&&this._updateColorway(e.colorway),e.dieType&&"unknown"!==e.dieType&&"unknown"===this.dieType&&this._updateDieType(e.dieType),e.firmwareDate&&e.firmwareDate.getTime()>0&&this._updateFirmwareDate(e.firmwareDate.getTime()),void 0!==e.rssi&&e.rssi<0&&this._updateRssi(e.rssi),(void 0===e.batteryLevel||e.batteryLevel>=0&&e.batteryLevel<=100)&&this._updateBattery(e.batteryLevel,e.isCharging),void 0!==e.rollState&&void 0!==e.currentFaceIndex&&e.currentFaceIndex>=0&&e.currentFaceIndex<this.dieFaceCount&&this._updateRoll(e.rollState,e.currentFaceIndex))}async connect(e=0){let t=!1;const i=e>0&&setTimeout((()=>{t=!0,this._session.disconnect().catch((()=>{}))}),e);try{if(await this._session.connect(),"connecting"===this.status){this._updateStatus("identifying");try{await this._internalSetup(),"identifying"===this.status&&(this._updateStatus("ready"),this._evEmitter.emit("battery",{level:this._info.batteryLevel,isCharging:this._info.isCharging}))}catch(e){try{console.log(this._tagLogString(`Disconnecting after getting error: ${e}`)),await this._session.disconnect()}catch(e){}throw e}}else"identifying"===this.status&&await new Promise((e=>{const t=i=>{"identifying"!==i&&(this.removeEventListener("status",t),e())};this.addEventListener("status",t)}));if("ready"!==this.status)throw new a(this)}catch(i){throw t?new s(this,e):i instanceof o?i:new o(this,i)}finally{i&&clearTimeout(i)}return this}async disconnect(){return await this._session.disconnect(),this}addEventListener(e,t){this._evEmitter.addListener(e,t)}removeEventListener(e,t){this._evEmitter.removeListener(e,t)}addMessageListener(e,t){this._msgEvEmitter.addListener(`${e}Message`,t)}removeMessageListener(e,t){this._msgEvEmitter.removeListener(`${e}Message`,t)}waitForMessage(e,t=n.ackMessageTimeout){return new Promise(((i,n)=>{let r;const o=e=>{r(),i(e)};this.addMessageListener(e,o);const s=t=>{"disconnecting"!==t&&"disconnected"!==t||(r(),n(new u(this,e)))};let a;this.addEventListener("status",s),a=setTimeout((()=>{a=void 0,r(),n(new l(this,t,e))}),t),r=()=>{a&&clearTimeout(a),this.removeMessageListener(e,o),this.removeEventListener("status",s)}}))}async sendMessage(e,t=!1){if(this._logMessages){const t=k(e);this._log(`Sending message ${t} (${m[t]})`)}const i=this._versions.firmwareVersion;if(i>0&&n.compatApiVersion>i)throw new d(this,k(e),n.compatApiVersion,i,"library");const r=this._versions.compatStandardApiVersion;if(r>0&&n.apiVersion<r)throw new d(this,k(e),n.apiVersion,r,"firmware");const o=C(e);this._logData&&this._logArray(o),await this._session.writeValue(o,t),this._evEmitter.emit("messageSend",e)}async sendAndWaitForResponse(e,t,i=n.ackMessageTimeout){return(await Promise.all([this.waitForMessage(t,i),this.sendMessage(e)]))[0]}async sendAndWaitForTypedResponse(e,t,i=n.ackMessageTimeout){return await this.sendAndWaitForResponse(e,k((new t).type),i)}async rename(e){if(!e.length)throw new p(this);await this.sendAndWaitForResponse((0,f.v3)(new ue,{name:e}),"setNameAck"),this._updateName(e)}async startCalibration(){await this.sendMessage("calibrate")}async reportRssi(e,t=5e3){await this.sendMessage((0,f.v3)(new ie,{requestMode:e?Z.automatic:Z.off,minInterval:t}))}async queryRssi(){return(await this.sendAndWaitForResponse((0,f.v3)(new ie,{requestMode:Z.once}),"rssi")).value}async turnOff(){await this.sendMessage((0,f.v3)(new pe,{operation:de.turnOff}),!0)}async blink(e,t){var i,n,r,o,s;const a=(0,f.v3)(new X,{color:h.Color32Utils.toColor32(e),count:null!==(i=null==t?void 0:t.count)&&void 0!==i?i:1,duration:null!==(n=null==t?void 0:t.duration)&&void 0!==n?n:1e3,fade:255*(null!==(r=null==t?void 0:t.fade)&&void 0!==r?r:0),faceMask:null!==(o=null==t?void 0:t.faceMask)&&void 0!==o?o:h.AnimConstants.faceMaskAll,loopCount:null!==(s=null==t?void 0:t.loopCount)&&void 0!==s?s:1});await this.sendAndWaitForResponse(a,"blinkAck")}async stopAllAnimations(){await this.sendMessage("stopAllAnimations")}async transferDataSet(e,t){const i=e=>{try{this._evEmitter.emit("dataTransfer",{progress:e}),null==t||t(e)}catch(e){console.log(this._tagLogString(`Error in transfer progress callback: ${e}`))}};try{i(0);const t=(0,f.v3)(new U,{paletteSize:e.animationBits.getPaletteSize(),rgbKeyFrameCount:e.animationBits.getRgbKeyframeCount(),rgbTrackCount:e.animationBits.getRgbTrackCount(),keyFrameCount:e.animationBits.getKeyframeCount(),trackCount:e.animationBits.getTrackCount(),animationCount:e.animations.length,animationSize:e.animations.reduce(((e,t)=>e+(0,f.iR)(t)),0),conditionCount:e.conditions.length,conditionSize:e.conditions.reduce(((e,t)=>e+(0,f.iR)(t)),0),actionCount:e.actions.length,actionSize:e.actions.reduce(((e,t)=>e+(0,f.iR)(t)),0),ruleCount:e.rules.length,brightness:e.brightness});if(!(await this.sendAndWaitForTypedResponse(t,q)).result){const t=e.computeDataSetByteSize();throw new r(this,`Not enough memory to transfer ${t} bytes`)}{const t=e.toByteArray();(0,f.hu)(t.length===e.computeDataSetByteSize(),"Incorrect computation of computeDataSetByteSize()");const n=h.DataSet.computeHash(t),r=(n>>>0).toString(16).toUpperCase().padStart(8,"0");this._log(`Ready to receive dataset, byte array should be ${t.length} bytes and hash 0x${r}`),await this.uploadBulkDataWithAck("transferAnimationSetFinished",t,i),this._evEmitter.emit("profileHash",n)}}catch(e){throw i(-1),e}}async playTestAnimation(e,t){(0,f.hu)(e.animations.length>=1,"No animation in DataSet"),null==t||t(0);const i=e.toAnimationsByteArray(),n=h.DataSet.computeHash(i),o=(0,f.v3)(new N,{paletteSize:e.animationBits.getPaletteSize(),rgbKeyFrameCount:e.animationBits.getRgbKeyframeCount(),rgbTrackCount:e.animationBits.getRgbTrackCount(),keyFrameCount:e.animationBits.getKeyframeCount(),trackCount:e.animationBits.getTrackCount(),animationCount:e.animations.length,animationSize:e.animations.reduce(((e,t)=>e+(0,f.iR)(t)),0),hash:n}),s=await this.sendAndWaitForTypedResponse(o,W);switch(s.ackType){case K.download:{const e=(n>>>0).toString(16).toUpperCase().padStart(8,"0");this._log(`Ready to receive test dataset, byte array should be: ${i.length} bytes and hash 0x${e}`),await this.uploadBulkDataWithAck("transferTestAnimationSetFinished",i,t)}break;case K.upToDate:this._log("Test animation is already up-to-date");break;default:throw new r(this,`Got unknown ackType: ${s.ackType}`)}}async transferInstantAnimations(e,t){(0,f.hu)(e.animations.length>=1,"No animation in DataSet"),null==t||t(0);const i=e.toAnimationsByteArray(),n=h.DataSet.computeHash(i),o=(0,f.v3)(new he,{paletteSize:e.animationBits.getPaletteSize(),rgbKeyFrameCount:e.animationBits.getRgbKeyframeCount(),rgbTrackCount:e.animationBits.getRgbTrackCount(),keyFrameCount:e.animationBits.getKeyframeCount(),trackCount:e.animationBits.getTrackCount(),animationCount:e.animations.length,animationSize:e.animations.reduce(((e,t)=>e+(0,f.iR)(t)),0),hash:n}),s=await this.sendAndWaitForTypedResponse(o,fe);switch(s.ackType){case K.download:{const e=(n>>>0).toString(16).toUpperCase().padStart(8,"0");this._log(`Ready to receive instant animations, byte array should be: ${i.length} bytes and hash 0x${e}`),await this.uploadBulkDataWithAck("transferInstantAnimationSetFinished",i,t)}break;case K.upToDate:this._log("Instant animations are already up-to-date");break;default:throw new r(this,`Got unknown ackType: ${s.ackType}`)}}async playInstantAnimation(e){await this.sendMessage((0,f.v3)(new ye,{animation:e}))}_tagLogString(e){return`[${function(){const e=e=>e.toString().padStart(2,"0"),t=new Date;return e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+"."+t.getMilliseconds().toString().padStart(3,"0")}()} - ${this.name}] ${e}`}_log(e){this._logFunc&&this._logFunc(this._tagLogString((null==e?void 0:e.type)?JSON.stringify(e):String(e)))}_logArray(e){this._logFunc&&this._logFunc(this._tagLogString(`${[...new Uint8Array(e)].map((e=>(e>>>0).toString(16).padStart(2,"0"))).join(":")}`))}async _internalSetup(){var e,t,i;let n;for(n in this._versions)this._versions[n]=0;await this._session.subscribe((e=>this._onValueChanged(e))),this._log("Waiting on identification message");const r=await this.sendAndWaitForResponse("whoAreYou","iAmADie"),s=null!==(e=r.pixelId)&&void 0!==e?e:null===(t=r.dieInfo)||void 0===t?void 0:t.pixelId;if(!s)throw new o(this,"Got an empty Pixel id");if(this._info.pixelId){if(this._info.pixelId!==s)throw new c(this,s)}else this._info.pixelId=s,this.emitPropertyEvent("pixelId");const a=e=>{var t,i,n;this._updateLedCount(e.ledCount),this._updateColorway(null!==(t=(0,f.ZO)(e.colorway,h.PixelColorwayValues))&&void 0!==t?t:"unknown");const r=null!==(i=(0,f.ZO)(e.dieType,h.PixelDieTypeValues))&&void 0!==i?i:"unknown";this._updateDieType("unknown"!==r?r:h.DiceUtils.estimateDieType(this.ledCount)),this._updateFirmwareDate(1e3*e.buildTimestamp),this._updateBattery(e.batteryLevelPercent,Pe(e.batteryState)),this._updateRoll(null!==(n=(0,f.ZO)(e.rollState,z))&&void 0!==n?n:"unknown",e.currentFaceIndex,{skipEvents:!0})};if(r instanceof I){a(r);const e=256;this._versions.firmwareVersion=e,this._versions.settingsVersion=e,this._versions.compatStandardApiVersion=e,this._versions.compatExtendedApiVersion=e,this._versions.compatManagementApiVersion=e}else{for(n in a(Object.assign(Object.assign(Object.assign({},r.dieInfo),r.versionInfo),r.statusInfo)),this._versions)this._versions[n]=r.versionInfo[n];this._updateName(r.dieName.name)}const l=null!==(i=r.dataSetHash)&&void 0!==i?i:r.settingsInfo.profileDataHash;this._evEmitter.emit("profileHash",l)}_updateStatus(e){e!==this._status&&(this._status=e,this._log(`Status changed to ${e}`),this._evEmitter.emit("status",e))}_updateName(e){e.length&&e!==this._info.name&&(this._info.name=e,this.emitPropertyEvent("name"))}_updateLedCount(e){this._info.ledCount!==e&&(this._info.ledCount=e,this.emitPropertyEvent("ledCount"))}_updateColorway(e){this._info.colorway!==e&&(this._info.colorway=e,this.emitPropertyEvent("colorway"))}_updateDieType(e){this._info.dieType!==e&&(this._info.dieType=e,this.emitPropertyEvent("dieType"))}_updateFirmwareDate(e){e&&e!==this._info.firmwareDate.getTime()&&(this._info.firmwareDate=new Date(e),this.emitPropertyEvent("firmwareDate"))}_updateRssi(e){e&&e!==this._info.rssi&&(this._info.rssi=e,this.emitPropertyEvent("rssi"),this._evEmitter.emit("rssi",e))}_updateBattery(e,t){const i=void 0!==e&&this._info.batteryLevel!==e,n=void 0!==t&&this._info.isCharging!==t;i&&(this._info.batteryLevel=e,this.emitPropertyEvent("batteryLevel")),n&&(this._info.isCharging=t,this.emitPropertyEvent("isCharging")),(i||n)&&this._evEmitter.emit("battery",{level:null!=e?e:this.batteryLevel,isCharging:null!=t?t:this.isCharging})}_createRollEvent(e,t){return"d4"===this.dieType&&(1!==t&&4!==t||(t=h.DiceUtils.indexFromFace(this.currentFace>0?this.currentFace:1,"d4"),"onFace"===e&&(e="crooked"))),{state:e,face:h.DiceUtils.faceFromIndex(t,this.dieType),faceIndex:t}}_updateRoll(e,t,i){const n=this._createRollEvent(e,t),r=this._info.rollState!==n.state,o=this._info.currentFaceIndex!==n.faceIndex,s=this._info.currentFace!==n.face;if(this._info.rollState=n.state,this._info.currentFaceIndex=n.faceIndex,this._info.currentFace=n.face,r&&this.emitPropertyEvent("rollState"),o&&this.emitPropertyEvent("currentFaceIndex"),s&&this.emitPropertyEvent("currentFace"),!(null==i?void 0:i.skipEvents)){const e="onFace"===n.state?n.face:void 0;this._evEmitter.emit("rollState",n),void 0!==e&&this._evEmitter.emit("roll",e)}}_onValueChanged(e){try{this._logData&&this._logArray(e.buffer);const t=e.byteLength&&e.getUint8(0)===m.iAmADie&&e.byteLength!==I.expectedSize?this._deserializeImADie(e):P(e);if(t){const e=k(t);this._logMessages&&(this._log(`Received message ${e} (${m[e]})`),"object"==typeof t&&this._log(t)),this._evEmitter.emit("message",t),this._msgEvEmitter.emit(`${e}Message`,t)}else this._log("Received invalid message")}catch(e){this._log(`Message deserialization error: ${e}`)}}_deserializeImADie(e){(0,f.hu)(e.getUint8(0)===m.iAmADie);const t=new D;let i=1;for(const[n,r]of Object.entries(t))if("type"!==n){(0,f.hu)("object"==typeof r&&"chunkSize"in r);const t=e.getUint8(i);r.chunkSize>0&&t!==r.chunkSize&&console.log(this._tagLogString(`Received IAmADie '${n}' chunk of size ${t} but expected ${r.chunkSize} bytes`)),(0,f.vB)(r,new DataView(e.buffer,e.byteOffset+i,0===r.chunkSize?t:Math.min(t,r.chunkSize)),{allowSkipLastProps:!0}),i+=t}return t}async uploadBulkDataWithAck(e,t,i,o="percent"){let s,a=!1;const c=()=>{a=!0,s&&(s(),s=void 0)};this.addMessageListener(e,c);try{await this._uploadBulkData(t,i,o),this._log("Done sending dataset, waiting for Pixel to finish programming");const e=new Promise(((e,t)=>{if(a)e();else{const i=setTimeout((()=>{t(new r(this,"Timeout waiting on device to confirm programming"))}),n.ackMessageTimeout);s=()=>{clearTimeout(i),e()}}}));await e,this._log("Programming done")}finally{this.removeMessageListener(e,c)}}async _uploadBulkData(e,t,i="percent"){let r=e.byteLength;this._log(`Sending ${r} bytes of bulk data`);const o=new L;o.size=r,await this.sendAndWaitForResponse(o,"bulkSetupAck"),this._log("Ready for receiving data");let s=0,a=0;const c=new V;for(;r>0;)if(c.offset=a,c.size=Math.min(r,n.maxMessageSize),c.data=e.slice(a,a+c.size),await this.sendAndWaitForResponse(c,"bulkDataAck"),r-=c.size,a+=c.size,t){const n="percent"===i?Math.round(100*a/e.byteLength):a;n>s&&(t(n),s=n)}this._log("Finished sending bulk data")}}const xe={service:"6e400001-b5a3-f393-e0a9-e50e24dcca9e",notifyCharacteristic:"6e400001-b5a3-f393-e0a9-e50e24dcca9e",writeCharacteristic:"6e400002-b5a3-f393-e0a9-e50e24dcca9e",dfuService:65113};class Oe{constructor(e){this._systemId=e,this._lastConnStatus="disconnected"}get systemId(){return this._systemId}get lastConnectionStatus(){return this._lastConnStatus}setConnectionEventListener(e){this._connStatusCb=e}_notifyConnectionEvent(e){var t;this._lastConnStatus!==e&&(this._lastConnStatus=e,null===(t=this._connStatusCb)||void 0===t||t.call(this,{systemId:this._systemId,connectionStatus:e}))}}async function Se(e,t,i,n){var r,o,s;try{const e=await i();null===(r=null==n?void 0:n.onResolved)||void 0===r||r.call(n,e)}catch(r){if(0===e)throw null===(s=null==n?void 0:n.onRejected)||void 0===s||s.call(n,r),r;null===(o=null==n?void 0:n.onWillRetry)||void 0===o||o.call(n,t,e,r),await(0,f.gw)(t),await Se(e-1,2*t,i,n)}}async function Ae(e,t){var i;await Se(null!==(i=null==t?void 0:t.retries)&&void 0!==i?i:2,2e3,e.connect.bind(e),t)}function Me(e){return(4294967295&e).toString(16).padStart(8,"0")+"-0000-1000-8000-00805f9b34fb"}},48:(e,t,i)=>{"use strict";i.d(t,{TH:()=>g,hu:()=>r,vE:()=>o,yh:()=>s,Fn:()=>O,YJ:()=>B,iR:()=>w,tg:()=>x,W2:()=>c,gw:()=>l,vB:()=>P,mU:()=>h,GP:()=>d,ZO:()=>S,w6:()=>A,v3:()=>f,Bg:()=>v,qC:()=>C});class n extends Error{constructor(e){super(e),this.name="AssertionError"}}function r(e,t){if(!e)throw new n(null!=t?t:`Assertion failed with value ${e}`)}function o(e,t){r(!1,null!=t?t:"assertNever() called")}function s(e){let t=5381;for(let i=0;i<e.length;++i)t=33*t^e[i];return t}var a=i(699);function c(){return new a.EventEmitter}async function l(e,t){return new Promise(((i,n)=>{if(null==t?void 0:t.aborted)n(new Error(`Call to delay(${e}) aborted on start`));else{const r=()=>{clearTimeout(o),n(new Error(`Call to delay(${e}) aborted before timeout`))};null==t||t.addEventListener("abort",r);const o=setTimeout((()=>{null==t||t.removeEventListener("abort",r),i()}),e)}}))}let u=0;function d(e){return void 0!==e&&(u=e),u++}let p=0;function h(e){void 0!==e&&(p=e);const t=1<<p;return p+=1,t}function f(e,t){return Object.assign(e,function(e){for(const t of Object.keys(e))void 0===e[t]&&delete e[t];return e}(t))}i(605);class y extends Error{constructor(e,t){super(e),this.name="DecodeUtf8Error",this.decodedString=t}}const m=Symbol.for("PixelsAnimationSerializable");class g extends Error{constructor(e){super(e),this.name="SerializationError"}}function v(e,t){return function(i,n){const r=Reflect.getMetadata(m,i),o={propertyKey:n,size:e,options:t};r?r.push(o):Reflect.defineMetadata(m,[o],i)}}function b(e){return Reflect.getMetadata(m,e)}function w(e){var t,i;return Array.isArray(e)?e.reduce(((e,t)=>e+w(t)),0):null!==(i=null===(t=b(e))||void 0===t?void 0:t.reduce(((e,t)=>{var i,n,r,o;if((null===(i=t.options)||void 0===i?void 0:i.nullTerminated)||(null===(n=null==t?void 0:t.options)||void 0===n?void 0:n.terminator))throw new g("Dynamic size");return e+t.size+(null!==(o=null===(r=t.options)||void 0===r?void 0:r.padding)&&void 0!==o?o:0)}),0))&&void 0!==i?i:0}function T(e,t){const i=b(e);if(!(null==i?void 0:i.length))throw new g("Object has no serializable property");for(const n of i){const i=e[n.propertyKey],r=i instanceof ArrayBuffer||i&&i.buffer instanceof ArrayBuffer;if("number"!=typeof i&&"bigint"!=typeof i&&"boolean"!=typeof i&&"string"!=typeof i&&!r)throw new g(Array.isArray(i)?"Invalid property type, got an array, use an 'ArrayBuffer' instead":`Invalid property type, got ${typeof i} for ${n.propertyKey} but expected number or bigint`);if(!t(n,i))break}}function k(e,t){const i=Number(e);let n,r;switch(t){case"int8":n=-128,r=127;break;case"uint8":n=0,r=255;break;case"int16":n=-32768,r=32767;break;case"uint16":n=0,r=65535;break;case"int32":n=-2147483648,r=2147483647;break;case"uint32":n=0,r=4294967295}if(n&&r){if(i<n)throw new g(`Value ${i} too small to fit in a ${t}`);if(i>r)throw new g(`Value ${i} too big to fit in a ${t}`)}return i}function _(e,t,i=0){if(Array.isArray(e)){const n={dataView:t,byteOffset:i};for(const t of e){const[e,i]=C(t,n);n.dataView=e,n.byteOffset=i}return[n.dataView,n.byteOffset]}return T(e,((e,n)=>{var r,o,s,a,c,l,u,d,p,h;let f;var y;if("string"==typeof n?f=(y=n,new Uint8Array(function(e){const t=[];for(let i=0;i<e.length;i++){const n=e.codePointAt(i);n<128?t.push(n):n<2048?t.push(192|n>>6,128|63&n):n<65536?t.push(224|n>>12,128|n>>6&63,128|63&n):(i++,t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return t}(y))).buffer:n instanceof ArrayBuffer?f=n:n.buffer&&n.buffer instanceof ArrayBuffer&&(f=n.buffer),f){const u=f.byteLength+("string"==typeof n?1:0);if(!(null===(r=e.options)||void 0===r?void 0:r.nullTerminated)&&!(null===(o=e.options)||void 0===o?void 0:o.terminator)&&e.size<u)throw new g(`Serialized value for \`${e.propertyKey}\` takes ${u} bytes but prop size is ${e.size}`);const d=new Uint8Array(f),p=(null===(s=e.options)||void 0===s?void 0:s.nullTerminated)||(null===(a=e.options)||void 0===a?void 0:a.terminator)?d.byteLength:Math.min(d.byteLength,e.size);for(let e=0;e<p;++e)t.setUint8(i,d[e]),++i;if(!(null===(c=e.options)||void 0===c?void 0:c.nullTerminated)&&!(null===(l=e.options)||void 0===l?void 0:l.terminator))for(let n=p;n<e.size;++n)t.setUint8(i,0),++i}else{const r="float"===(null===(u=e.options)||void 0===u?void 0:u.numberFormat),o="signed"===(null===(d=e.options)||void 0===d?void 0:d.numberFormat);!function(e,t,i,n,r,o){switch(n){case 1:r?e.setInt8(t,k(i,"int8")):e.setUint8(t,k(i,"uint8"));break;case 2:r?e.setInt16(t,k(i,"int16"),!0):e.setUint16(t,k(i,"uint16"),!0);break;case 4:o?e.setFloat32(t,k(i,"float32"),!0):r?e.setInt32(t,k(i,"int32"),!0):e.setInt32(t,k(i,"uint32"),!0);break;case 8:if(!o)throw new g("BigInt not supported");e.setFloat64(t,k(i,"float64"),!0);break;default:throw new g(`Invalid property size, got ${n} but expected 1, 2, 4, or 8`)}}(t,i,n,e.size,o,r),i+=e.size+(null!==(h=null===(p=e.options)||void 0===p?void 0:p.padding)&&void 0!==h?h:0)}return!0})),[t,i]}function C(e,t){var i;if(null==t?void 0:t.dataView)return _(e,t.dataView,null!==(i=t.byteOffset)&&void 0!==i?i:0);{const t=w(e),[i,n]=_(e,new DataView(new ArrayBuffer(t)));return r(n===i.buffer.byteLength,`Incorrect offset after serialization, got ${n} but expected ${i.buffer.byteLength}`),[i,n]}}function P(e,t,i){return function(e,t,i){function n(e,t,i,n){if("boolean"!=typeof n||"number"!=typeof i&&"bigint"!=typeof i){if(typeof i!=typeof n)throw new g(`Type mismatch, deserialized a ${typeof i} but but expected a ${typeof n}`)}else i=Boolean(i);e[t.propertyKey]=i}let r=0;return T(e,((o,s)=>{var a,c,l,u,d,p,h,f,m,v,b;if((null==i?void 0:i.allowSkipLastProps)&&r===t.byteLength)return!1;if(!(null===(a=o.options)||void 0===a?void 0:a.nullTerminated)&&!(null===(c=o.options)||void 0===c?void 0:c.terminator)&&r+o.size>t.byteLength)throw new g(`Not enough bytes for deserializing \`${o.propertyKey}\` of size ${o.size}`);if(Array.isArray(e))throw new g("Array type not supported for deserialization");if("string"==typeof s){const i=t.byteOffset+r;if(!(null===(l=o.options)||void 0===l?void 0:l.nullTerminated)&&!(null===(u=o.options)||void 0===u?void 0:u.terminator)&&i+o.size>t.buffer.byteLength)throw new g(`Unexpected property size, got ${o.size} but there are only ${t.buffer.byteLength-i} left`);const a=t.buffer.slice(i,(null===(d=o.options)||void 0===d?void 0:d.nullTerminated)?function(e,t){for(let i=t;i<e.byteLength;++i)if(!e.getUint8(i))return i;throw new g("Data is not null terminated")}(t,r)-1:(null===(p=o.options)||void 0===p?void 0:p.terminator)?t.byteOffset+t.byteLength:i+o.size);try{n(e,o,function(e){let t=0,i="";for(;t<e.length;){let n=e[t++];if(!n)break;if(n>127)if(n>191&&n<224){if(t>=e.length)throw new y("Incomplete 2-bytes sequence",i);n=(31&n)<<6|63&e[t++]}else if(n>223&&n<240){if(t+1>=e.length)throw new y("Incomplete 3-bytes sequence",i);n=(15&n)<<12|(63&e[t++])<<6|63&e[t++]}else{if(!(n>239&&n<248))throw new y(`Unknown multibyte start 0x${n.toString(16)} at index ${t-1}`,i);if(t+2>=e.length)throw new y("Incomplete 4-bytes sequence",i);n=(7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++]}if(n<=65535)i+=String.fromCharCode(n);else{if(!(n<=1114111))throw new y(`Code point 0x${n.toString(16)} exceeds UTF-16 reach`,i);n-=65536,i+=String.fromCharCode(n>>10|55296),i+=String.fromCharCode(1023&n|56320)}}return i}(new Uint8Array(a)),s)}catch(t){if(!(t instanceof y))throw new g(null!==(h=null==t?void 0:t.message)&&void 0!==h?h:String(t));n(e,o,t.decodedString,s),console.warn(`Error decoding string for \`${o.propertyKey}\`: ${t}`)}r+=a.byteLength}else{const i="float"===(null===(f=o.options)||void 0===f?void 0:f.numberFormat),a="signed"===(null===(m=o.options)||void 0===m?void 0:m.numberFormat),c=function(e,t,i,n,r){switch(i){case 1:return n?e.getInt8(t):e.getUint8(t);case 2:return n?e.getInt16(t,!0):e.getUint16(t,!0);case 4:return r?e.getFloat32(t,!0):n?e.getInt32(t,!0):e.getUint32(t,!0);case 8:if(r)return e.getFloat64(t,!0);throw new g("BigInt not supported");default:throw new g(`Invalid property size, got ${i} but expected 1, 2, 4, or 8`)}}(t,r,o.size,a,i);n(e,o,c,s),r+=o.size}return r+=null!==(b=null===(v=o.options)||void 0===v?void 0:v.padding)&&void 0!==b?b:0,!0})),r}(e,t,i)}function B(e){const t=[];if((e=Math.floor(null!=e?e:0))>0){let i=e.toString(2),n=0;for(;i.length;)"1"===i.at(-1)&&t.push(n),i=i.substring(0,i.length-1),++n}return t}function x(e){return e.reduce(((e,t)=>(r(t<2147483648,`combineFlags: Flag value greater or equal to 2^31, can't combine using OR operator, got ${t}`),e|t)),0)}function O(e){return r(e<53,`bitIndexToFlag: Bit index greater than maximum precision of 64 bits floating-point numbers (52 bits mantissa), got ${e}`),Math.pow(2,e)}function S(e,t){for(const[i,n]of Object.entries(t))if(n===e)return i}function A(e,t,i){let n=e;void 0===t&&(t=e,n=0),i||(i=1);let r=(t-n)/i;r<0&&(r=-r,i=-i);const o=Array(Math.floor(r));let s=n,a=0;for(;a<r;)o[a]=s,s+=i,a+=1;return o}},605:(e,t,i)=>{var n;!function(e){!function(t){var n="object"==typeof globalThis?globalThis:"object"==typeof i.g?i.g:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(e){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}(),r=o(e);function o(e,t){return function(i,n){Object.defineProperty(e,i,{configurable:!0,writable:!0,value:n}),t&&t(i,n)}}void 0!==n.Reflect&&(r=o(n.Reflect,r)),function(e,t){var i=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,a={__proto__:[]}instanceof Array,c=!s&&!a,l={create:s?function(){return $(Object.create(null))}:a?function(){return $({__proto__:null})}:function(){return $({})},has:c?function(e,t){return i.call(e,t)}:function(e,t){return t in e},get:c?function(e,t){return i.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),d="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:function(){var e={},t=[],i=function(){function e(e,t,i){this._index=0,this._keys=e,this._values=t,this._selector=i}return e.prototype["@@iterator"]=function(){return this},e.prototype[o]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var i=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:i,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var i=this._find(e,!0);return this._values[i]=t,this},t.prototype.delete=function(t){var i=this._find(t,!1);if(i>=0){for(var n=this._keys.length,r=i+1;r<n;r++)this._keys[r-1]=this._keys[r],this._values[r-1]=this._values[r];return this._keys.length--,this._values.length--,D(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new i(this._keys,this._values,n)},t.prototype.values=function(){return new i(this._keys,this._values,r)},t.prototype.entries=function(){return new i(this._keys,this._values,s)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[o]=function(){return this.entries()},t.prototype._find=function(e,t){if(!D(this._cacheKey,e)){this._cacheIndex=-1;for(var i=0;i<this._keys.length;i++)if(D(this._keys[i],e)){this._cacheIndex=i;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function n(e,t){return e}function r(e,t){return t}function s(e,t){return[e,t]}}(),p="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:function(){function e(){this._map=new d}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[o]=function(){return this.keys()},e}(),h="function"==typeof WeakMap?WeakMap:function(){var e=16,t=l.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=o(e,!1);return void 0!==t&&l.has(t,this._key)},e.prototype.get=function(e){var t=o(e,!1);return void 0!==t?l.get(t,this._key):void 0},e.prototype.set=function(e,t){return o(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=o(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var e;do{e="@@WeakMap@@"+a()}while(l.has(t,e));return t[e]=!0,e}function o(e,t){if(!i.call(e,n)){if(!t)return;Object.defineProperty(e,n,{value:l.create()})}return e[n]}function s(e,t){for(var i=0;i<t;++i)e[i]=255*Math.random()|0;return e}function a(){var t=function(e){if("function"==typeof Uint8Array){var t=new Uint8Array(e);return"undefined"!=typeof crypto?crypto.getRandomValues(t):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(t):s(t,e),t}return s(new Array(e),e)}(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var i="",n=0;n<e;++n){var r=t[n];4!==n&&6!==n&&8!==n||(i+="-"),r<16&&(i+="0"),i+=r.toString(16).toLowerCase()}return i}}(),f=n?Symbol.for("@reflect-metadata:registry"):void 0,y=function(){var e;return!P(f)&&x(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[f]),P(e)&&(e=function(){var e,i,n,r;P(f)||void 0===t.Reflect||f in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=function(e){var t=e.defineMetadata,i=e.hasOwnMetadata,n=e.getOwnMetadata,r=e.getOwnMetadataKeys,o=e.deleteMetadata,s=new h;return{isProviderFor:function(e,t){var i=s.get(e);return!(P(i)||!i.has(t))||!!r(e,t).length&&(P(i)&&(i=new p,s.set(e,i)),i.add(t),!0)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:n,OrdinaryOwnMetadataKeys:r,OrdinaryDeleteMetadata:o}}(t.Reflect));var o=new h,s={registerProvider:a,getProvider:l,setProvider:y};return s;function a(t){if(!Object.isExtensible(s))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case P(i):i=t;break;case i===t:break;case P(n):n=t;break;case n===t:break;default:void 0===r&&(r=new p),r.add(t)}}function c(t,o){if(!P(i)){if(i.isProviderFor(t,o))return i;if(!P(n)){if(n.isProviderFor(t,o))return i;if(!P(r))for(var s=z(r);;){var a=E(s);if(!a)return;var c=G(a);if(c.isProviderFor(t,o))return j(s),c}}}if(!P(e)&&e.isProviderFor(t,o))return e}function l(e,t){var i,n=o.get(e);return P(n)||(i=n.get(t)),P(i)?(P(i=c(e,t))||(P(n)&&(n=new d,o.set(e,n)),n.set(t,i)),i):i}function u(e){if(P(e))throw new TypeError;return i===e||n===e||!P(r)&&r.has(e)}function y(e,t,i){if(!u(i))throw new Error("Metadata provider not registered.");var n=l(e,t);if(n!==i){if(!P(n))return!1;var r=o.get(e);P(r)&&(r=new d,o.set(e,r)),r.set(t,i)}return!0}}()),!P(f)&&x(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,f,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}(),m=function(e){var t=new h,i={isProviderFor:function(e,i){var n=t.get(e);return!P(n)&&n.has(i)},OrdinaryDefineOwnMetadata:function(e,t,i,r){n(i,r,!0).set(e,t)},OrdinaryHasOwnMetadata:function(e,t,i){var r=n(t,i,!1);return!P(r)&&S(r.has(e))},OrdinaryGetOwnMetadata:function(e,t,i){var r=n(t,i,!1);if(!P(r))return r.get(e)},OrdinaryOwnMetadataKeys:function(e,t){var i=[],r=n(e,t,!1);if(P(r))return i;for(var o=z(r.keys()),s=0;;){var a=E(o);if(!a)return i.length=s,i;var c=G(a);try{i[s]=c}catch(e){try{j(o)}finally{throw e}}s++}},OrdinaryDeleteMetadata:function(e,i,r){var o=n(i,r,!1);if(P(o))return!1;if(!o.delete(e))return!1;if(0===o.size){var s=t.get(i);P(s)||(s.delete(r),0===s.size&&t.delete(s))}return!0}};return y.registerProvider(i),i;function n(n,r,o){var s=t.get(n),a=!1;if(P(s)){if(!o)return;s=new d,t.set(n,s),a=!0}var c=s.get(r);if(P(c)){if(!o)return;if(c=new d,s.set(r,c),!e.setProvider(n,r,i))throw s.delete(r),a&&t.delete(n),new Error("Wrong provider for target.")}return c}}(y);function g(e,t,i){if(v(e,t,i))return!0;var n=L(t);return!B(n)&&g(e,n,i)}function v(e,t,i){var n=V(t,i,!1);return!P(n)&&S(n.OrdinaryHasOwnMetadata(e,t,i))}function b(e,t,i){if(v(e,t,i))return w(e,t,i);var n=L(t);return B(n)?void 0:b(e,n,i)}function w(e,t,i){var n=V(t,i,!1);if(!P(n))return n.OrdinaryGetOwnMetadata(e,t,i)}function T(e,t,i,n){V(i,n,!0).OrdinaryDefineOwnMetadata(e,t,i,n)}function k(e,t){var i=_(e,t),n=L(e);if(null===n)return i;var r=k(n,t);if(r.length<=0)return i;if(i.length<=0)return r;for(var o=new p,s=[],a=0,c=i;a<c.length;a++){var l=c[a];o.has(l)||(o.add(l),s.push(l))}for(var u=0,d=r;u<d.length;u++)l=d[u],o.has(l)||(o.add(l),s.push(l));return s}function _(e,t){var i=V(e,t,!1);return i?i.OrdinaryOwnMetadataKeys(e,t):[]}function C(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function P(e){return void 0===e}function B(e){return null===e}function x(e){return"object"==typeof e?null!==e:"function"==typeof e}function O(e,t){switch(C(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var i=3===t?"string":5===t?"number":"default",n=I(e,r);if(void 0!==n){var o=n.call(e,i);if(x(o))throw new TypeError;return o}return function(e,t){if("string"===t){var i=e.toString;if(R(i)&&!x(r=i.call(e)))return r;if(R(n=e.valueOf)&&!x(r=n.call(e)))return r}else{var n;if(R(n=e.valueOf)&&!x(r=n.call(e)))return r;var r,o=e.toString;if(R(o)&&!x(r=o.call(e)))return r}throw new TypeError}(e,"default"===i?"number":i)}function S(e){return!!e}function A(e){var t=O(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function M(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function R(e){return"function"==typeof e}function F(e){return"function"==typeof e}function D(e,t){return e===t||e!=e&&t!=t}function I(e,t){var i=e[t];if(null!=i){if(!R(i))throw new TypeError;return i}}function z(e){var t=I(e,o);if(!R(t))throw new TypeError;var i=t.call(e);if(!x(i))throw new TypeError;return i}function G(e){return e.value}function E(e){var t=e.next();return!t.done&&t}function j(e){var t=e.return;t&&t.call(e)}function L(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===u)return t;if(t!==u)return t;var i=e.prototype,n=i&&Object.getPrototypeOf(i);if(null==n||n===Object.prototype)return t;var r=n.constructor;return"function"!=typeof r||r===e?t:r}function V(e,t,i){var n=y.getProvider(e,t);if(!P(n))return n;if(i){if(y.setProvider(e,t,m))return m;throw new Error("Illegal state.")}}function $(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,i,n){if(P(i)){if(!M(e))throw new TypeError;if(!F(t))throw new TypeError;return function(e,t){for(var i=e.length-1;i>=0;--i){var n=(0,e[i])(t);if(!P(n)&&!B(n)){if(!F(n))throw new TypeError;t=n}}return t}(e,t)}if(!M(e))throw new TypeError;if(!x(t))throw new TypeError;if(!x(n)&&!P(n)&&!B(n))throw new TypeError;return B(n)&&(n=void 0),function(e,t,i,n){for(var r=e.length-1;r>=0;--r){var o=(0,e[r])(t,i,n);if(!P(o)&&!B(o)){if(!x(o))throw new TypeError;n=o}}return n}(e,t,i=A(i),n)})),e("metadata",(function(e,t){return function(i,n){if(!x(i))throw new TypeError;if(!P(n)&&!function(e){switch(C(e)){case 3:case 4:return!0;default:return!1}}(n))throw new TypeError;T(e,t,i,n)}})),e("defineMetadata",(function(e,t,i,n){if(!x(i))throw new TypeError;return P(n)||(n=A(n)),T(e,t,i,n)})),e("hasMetadata",(function(e,t,i){if(!x(t))throw new TypeError;return P(i)||(i=A(i)),g(e,t,i)})),e("hasOwnMetadata",(function(e,t,i){if(!x(t))throw new TypeError;return P(i)||(i=A(i)),v(e,t,i)})),e("getMetadata",(function(e,t,i){if(!x(t))throw new TypeError;return P(i)||(i=A(i)),b(e,t,i)})),e("getOwnMetadata",(function(e,t,i){if(!x(t))throw new TypeError;return P(i)||(i=A(i)),w(e,t,i)})),e("getMetadataKeys",(function(e,t){if(!x(e))throw new TypeError;return P(t)||(t=A(t)),k(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!x(e))throw new TypeError;return P(t)||(t=A(t)),_(e,t)})),e("deleteMetadata",(function(e,t,i){if(!x(t))throw new TypeError;if(P(i)||(i=A(i)),!x(t))throw new TypeError;P(i)||(i=A(i));var n=V(t,i,!1);return!P(n)&&n.OrdinaryDeleteMetadata(e,t,i)}))}(r,n),void 0===n.Reflect&&(n.Reflect=e)}()}(n||(n={}))}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,i),o.exports}return i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(368)})()));